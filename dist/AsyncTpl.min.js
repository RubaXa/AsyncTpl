(function(H,x){function q(f,j){D[f.replace(E,"")]=j}function p(f){return D[f.replace(E,"")]}var E=/^.+\//,D={};q("fs",{readFile:function(f,j,n){jQuery.ajax({url:f,type:"get",dataType:"text",isLocal:!0,success:function(f){n(null,f)}})},readFileSync:function(f){return jQuery.ajax({url:f,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(f){function j(c,f,b,h){if(!(this instanceof j))return new j(c,f,b,h);if("number"===typeof c)switch(h=b,
b=f,f=c,f){case j.TEXT_NODE:c="<text>";break;case j.CDATA_NODE:c="<cdata>";break;case j.COMMENT_NODE:c="<comment>";break;case j.CUSTOM_NODE:c="<custom>"}else c=c.toLowerCase(),c.match(n)&&(this.ns=RegExp.$1,c=RegExp.$2);this.name=c;this.type=f;this.value=b;this.attributes=h||{};this.childNodes=[]}var n=/^([^:]+):(.+)/,g={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21,VAR_NODE:22},b={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,
input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,wbr:!0};j.prototype={constructor:j,attr:function(c,b){if(this.attributes[c])return this.attributes[c].value;f.exception('Tag "'+this.name+'", attribute "'+(b||c)+'" is missing',this.__line,this.__file)},attrAny:function(c,b){f.each(c.split(" "),function(c){b=b||this.attributes[c]},this);return b},removeAttr:function(c){delete this.attributes[c]},c:function(c,f,b,h){return this.clone(c,f,j.COMPILER_NODE,b,h)},clone:function(c,b,h,g,o){b=j(b,this.type,
b.value);b.ns=c;b.type=h;b.__line=this.__line;b.__file=this.__file;b.__open=!o;b.__close=!!o;f.each(g,function(a,i){b.attributes[i]=j(i,j.ATTRIBUTE_NODE,a)});return b},isShort:function(){return!0===b[this.name]}};for(var h in g)j[h]=j.prototype[h]=g[h];j.findClosureIdx=function(c,b,f){if(!b.__close)for(var f=f|0,h=c.length,g=0,a;f<h;f++)if(a=c[f],b.name==a.name&&(g+=a.__close?-1:1,a.__close&&1>g))return f};"undefined"!==typeof q?q("./Node",j):module.exports=j})(p("./utils"));(function(f,j){function n(a){return i[a]}
function g(a){if(!(this instanceof g))return new g(a);var e=[],d=[],i,b,c=!0,f=!0,h=!1,m=this;m.done=function(a){c&&a!==j&&(h?a(b):e.push(a));return m};m.fail=function(a){f&&a!==j&&(h?a(b):d.push(a));return m};m.then=function(a,r){return m.done(a).fail(r)};m.reject=function(a){c=!1;h=!0;for(b=a;d.length;)d.shift()(a);return m};m.resolve=function(a){f=!1;h=!0;for(b=a;e.length;)e.shift()(a);return m};m.promise=function(){i===j&&(i={done:m.done,fail:m.fail,then:m.then,promise:m.promise});return i};a!==
j&&a(m)}var b=Object.prototype.toString,h=String.prototype.trim,c=/^#/,k=[].slice,l=/^\s+/,m=/\s+$/,o=/[&<>"]/g,a=/'/g,i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},d="undefined"!==typeof console&&console,e={Array:function(a){a=a||[];a.map=a.map||function(a){for(var r=[],e=0,d=this.length;e<d;e++)r.push(a(this[e]));return r};a.add=function(a,r,e){a.__order=~~e;r===j?this.push(a):0==r?this.unshift(a):this.splice(r,0,a);return this};a.addOrder=function(a,r){return this.add(a,j,r)};a.addMulti=function(a,
r){a.length&&this.splice.apply(this,[r,0].concat(a));return this};a.order=function(){this.sort(function(a,r){return a.__order-r.__order});return this};return a},$:function(a){return"string"==typeof a?document.getElementById(a.replace(c,"")):a},sizeof:function(a){var d=0;if(a&&(e.isArray(a)||"object"==typeof a))"length"in a?d=a.length:e.each(a,function(){d++});return d},isArray:function(a){return"[object Array]"==b.call(a)},uniqId:function(){return(new Date).getTime()+""+Math.round(1E3*Math.random())},
ns:function(a,d,i){var d=d.split("."),b=d.pop();e.each(d,function(e){a[e]||(a[e]={});a=a[e]});a[b]=i},escape:function(a){return"string"===typeof a&&o.test(a)?a.replace(o,n):a},addslashes:function(e){return e.replace(a,"\\'")},log:d&&"object"==typeof d.log?Function.prototype.call.bind(d.log,d):function(){d&&d.log.apply(d,arguments)},exception:function(a,e,d){throw{message:a,line:e,file:d};},error:function(a,d,i){a="Error: "+a.message+" in "+(a.file||i)+" on line "+(a.line||d);e.log(a);return a},keys:function(a){var d=
[];Object.keys?d=Object.keys(a):e.each(a,function(a){d.push(a)});return d},each:function(a,e,d){if(a)if(a.forEach)a.forEach(e,d);else if("length"in a&&0 in a)for(var i=0,b=a.length;i<b;i++)e.call(d,a[i],i,a);else for(i in a)a.hasOwnProperty(i)&&e.call(d,a[i],i,a)},cycle:function(a,e,d){for(;a<=e;a++)d(a)},trim:h?function(a){return h.call(a)}:function(a){return(""+a).replace(l,"").replace(m,"")},extend:function(a){a=a||{};e.each(arguments,function(d,i){0<i&&e.each(d,function(e,d){a[d]=e})});return a},
indexOf:function(a,e){if(a.indexOf)return a.indexOf(e);for(var d=0,i=a.length;d<i;d++)if(a[d]===e)return d;return-1},inherit:function(a,d,i,b){if(2===arguments.length){var c=function(){};c.prototype=d.prototype;a.prototype=new c;a.prototype.self=a;a.prototype.constructor=a;e.each(d,function(d,e){a[e]=d})}else return d.prototype[i].apply(a,b)},defer:g,load:function(a,d,i,b){var c=e.defer();d?f.readFile(a,i||"utf-8",function(a,d){c[a?"reject":"resolve"](a||d)}):c.resolve(p("fs").readFileSync(a,i||"utf-8"));
return c.done(b).promise()},mtime:function(a){return f?+Date.parse(f.lstatSync(a).mtime):0},writeFile:function(a,d,e){f&&f.writeFileSync(a,d,e)},getJSON:function(a,d,i){var b=e.defer();if(f)try{b.resolve(JSON.parse(f.readFileSync(a,d)))}catch(c){b.reject()}return b.fail(function(){i(!0)}).done(function(a){i(!1,a)}).promise()}};g.prototype={constructor:g};g.when=function(a){var d=g(),i=[];a instanceof g?i.push.apply(i,arguments):i=a;var b=0,c=i.length,f=function(){++b==c&&d.resolve()};e.each(i,function(a){a.done(f)});
c||d.resolve();return d.promise()};Function.prototype.bind===j&&(Function.prototype.bind=function(a){var d=k.call(arguments,1),e=this;return function(){return e.apply(a,d.concat(k.call(arguments,0)))}});"undefined"!==typeof q?q("./utils",e):module.exports=e})(p("fs"));(function(f,j,n){function g(b,c){this._file=c;this._opts=j.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},b);this._opts.tags&&(this._opts.tags=" "+this._opts.tags+" ")}function b(b){var c=(b+"").split(""),
a=0,i={};this.pos=function(){for(var d=a;d--&&"\n"!=c[d];);return a-d+1};this.line=function(){for(var d=1,e=a;e--;)"\n"==c[e]&&d++;return d};this.peek=function(d){return c[a+(d||0)]};this.lex=function(d){return c.slice(a,a+d).join("")};this.match=function(a){var e=this.lex(a.length)===a;this.lastMatch=e?a:null;this.lastMatchLength=e?a.length:0;return e};this.next=function(d){"string"===typeof d&&(d=d.length);a+=d||1;return this};this.save=function(d){i[d]=a;return this};this.load=function(d){a=i[d];
return this};this.length=function(){return c.length-a};this.getStr=function(){for(var a,e="",i=this.peek(),b=1;a=this.peek();)if(this.next(),e+=a,"\\"==a)b++;else{if(i==a&&!(b%2))return e.substring(1,e.length-1);b=0}};this.substr=function(d,e){return c.slice(d,e||a).join("")};this.extract=function(a,e){this.save("extract");e!==n&&this.next(e);for(var i="",b;b=this.peek();){if(this.match(a))return this.next(a),i;i+=b;this.next()}this.load("extract");return null}}var h=/['"]/,c=/^[\s\r\n\t]+$/,k=/^([$a-z][\da-z\s:>]|\/\w)$/i,
l=/[a-z\d:-]/i;g.prototype={constructor:g,parse:function(g){var o,a="",i=j.Array(),d,e=this._opts,r=e.tags,B=e.left,I=e.right,J=e.c_open,p=e.c_close,q=B.length,F=0;!e.firstLine&&/^\s*<\?xml/.test(g)&&(g=j.trim(g.replace(/^[^>]+>\n?/,"")),F=1);g=new b(g);a:for(;o=g.peek();){if(g.match(J))o=g.extract(p,g.lastMatchLength),null!==o&&i.push(f(f.COMMENT_NODE,o));else if(g.match("<![CDATA["))o=g.extract("]]\>",g.lastMatchLength),null!==o&&i.push(f(f.CDATA_NODE,o));else if(g.match(B))if(k.test(g.peek(q)+
g.peek(q+1))){o="/"==g.next(B).peek()?(g.next(),!0):!1;d=g;var y=r,A=I,t,z=d;t=void 0;for(var s="";t=z.peek();)if(l.test(t))s+=t,z.next();else break;t=s;var s=void 0,w=z=!1,x={},u="",v=void 0;if(d.length()){d.save("attrs");y=!y||-1<y.indexOf(" "+t+" ");c:for(;s=d.peek();)if(y&&l.test(s))for(u="";s=d.peek();)if(d.match(A)||c.test(s)){x[u]=f(u,f.ATTRIBUTE_NODE);continue c}else if("="==s){if(h.test(d.peek(1)))v=d.next().getStr();else{for(v="";(s=d.next().peek())&&!c.test(s)&&!d.match(A);)v+=s;v=""==
v?n:v}x[u]=f(u,f.ATTRIBUTE_NODE,v);continue c}else u+=s,d.next();else if(d.match(A)){w=!0;z="/"==d.peek(-1);d.next(A);break}else y||(u+=s),d.next();w?(d=y?f(t,f.ELEMENT_NODE,"",x):f(t,f.ELEMENT_NODE,"",u),d.__close=z):(d.load("attrs"),d=f(f.TEXT_NODE,t))}else d=f(f.TEXT_NODE,t);(!e.trim||!c.test(a))&&""!=a&&i.push(f(f.TEXT_NODE,a));a="";d.type!=f.TEXT_NODE&&(d.__open=!o,d.__close=d.__close||o,d.__empty=d.__open&&d.__close);i.push(d)}else{a+=o;g.next();continue a}else a+=o,g.next();0==g.length()&&
""!=a&&i.push(f(f.TEXT_NODE,a));i.length&&(d=i[i.length-1],d.__line||(d.__line=g.line()+F,d.__file=this._file))}return i},build:function(b){for(var c=[],a,i,d=this.left,e=this.right;i=b.shift();){switch(i.type){case f.TEXT_NODE:case f.CDATA_NODE:a=i.value;break;case f.ELEMENT_NODE:a=d+(!i.__empty&&i.__close?"/":"")+i.name;j.each(i.attributes,function(e){a+=" "+e.name+(e.value!==n?'="'+e.value+'"':"")});a+=(i.__empty?" /":"")+e;break;case f.CUSTOM_NODE:a=d+(i.__close?"/":"")+i.name+i.value+e}""!=a&&
(c.push(a),a="")}return c.join("")},rebuild:function(b){return this.build(this.parse(b))}};"undefined"!==typeof q?q("./Parser",g):module.exports=g})(p("./Node"),p("./utils"));(function(f){function j(f){this._opts=f||{useWith:!1}}j.prototype={constructor:j,compile:function(j){function g(){var c="",g=0,j=h.length,a,i;if(j){for(;g<j;g++){i=typeof h[g];if(a!=i||"string"!=i)a&&(c+="string"==a?"',":","),c+="string"==i?"'":"";c+="string"==i?f.addslashes(h[g]):h[g][0];a=i}"string"==i&&(c+="'");b.push("__buf.w("+
c.replace(/\r/g,"").replace(/\n/g,"\\n")+");");h=[]}}var b=[],h=[],c,k="undef,undefined,__XIF,__XVAL,__XFOR,__XATTR".split(",");for(c="";c=j.shift();)c.type&&c.type==c.VAR_NODE?~f.indexOf(k,c.name)||k.push(c.name):c.__break?(g(),b.push(c.value)):"value"==c.name?(g(),c=" try{__buf.v("+c.value,b.push(c+")}catch(e){} ")):"string"==typeof c||c.type==c.TEXT_NODE||c.type==c.CDATA_NODE?h.push(c.value||c):(g(),b.push(c.value));g();this._opts.useWith?(c="with( ctx ){ ",b.push(" } ")):c="'use strict';/*global ctx, __buf, utils*/";
c+="var "+k.join(",")+"";b=";if(ctx.__part!==undef)__buf.off();"+b.join("")+" __buf.end();";b=c+b;return new Function("ctx, __buf, __utils",b)}};"undefined"!==typeof q?q("./Compiler",j):module.exports=j})(p("./utils"));(function(f,j){function n(f,b){this._data="";this._pullLen=0;this._active=!0;this._stream=b;this._callback=f}n.prototype={constructor:n,on:function(){this._active=!0},off:function(){this._active=!1},v:function(g){this._active&&g!==j&&(this._data+=f.escape(g))},w:function(f){this._active&&
(this._data+=f)},write:function(f){if(this._active)if(1<arguments.length){var b="",h=arguments,c=h.length,j=0;switch(c){case 9:b=h[8]+b;case 8:b=h[7]+b;case 7:b=h[6]+b;case 6:b=h[5]+b;case 5:b=h[4]+b;case 4:b=h[3]+b;case 3:b=h[2]+b;case 2:this._data+=h[0]+h[1]+b;break;default:for(c=h.length;j<c;)this._data+=h[j++]}}else this._data+=f},cycle:function(){this._active&&f.cycle.apply(f,arguments)},each:function(){this._active&&f.each.apply(f,arguments)},block:function(f,b,h){this.w(this.getBlock(f,b,h))},
blockLabel:function(f,b,h){this._active&&(h!==j&&this.setBlock(f,h,!0),this._blocks===j&&(this._chunks=[],this._blocks=[],this._attrs=[]),f=this._chunks.push(this._data,f)-1,this._blocks.push(f),b!==j&&(this._attrs[f]=b),this._data="")},setBlock:function(f,b,h){this._block===j&&(this._block={});if(!0!==h||this._block[f]===j)this._block[f]=b},getBlock:function(f,b,h){this._block[f]!==j&&(h=this._block[f]);return h!==j?(f=new n,f._block=this._block,h(f,b),f.toStr()):""},pullSync:function(f,b,h){this.pull(f,
b,h)},pull:function(g,b,h){this._pull===j&&(this._pull={});if(this._pull[b]===j){var c=f.defer(),k=function(){this._pullLen--;setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[b]=c.then(k,k);try{g[b](function(b,f){c[b?"reject":"resolve"](b||f)})}catch(l){c.reject(!0)}}h!==j&&this._pull[b].then(function(b){h(null,b)},function(b){h(b)});return this._pull[b].promise()},end:function(){this._stream&&(this._callback(this._data),this._data="");if(0===this._pullLen){if(this._blocks!==
j){for(var f=this._blocks,b=this._chunks,h=this._attrs,c=b.length,k=f.length,l;k--;)l=f[k],b[l]=this.getBlock(b[l],h[l]);f=b[--c];for(k=c;k--;)f=b[k]+f;this._data=f+this._data}this._callback(this._data);this._stream&&this._callback(null)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof q?q("./Buffer",n):module.exports=n})(p("./utils"));(function(f,j,n,g,b,h){function c(a,i){this.__lego(a,i)}var k={},l={},m={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',
loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'},o=/^(.+)\s+as\s+(?:(.+)\s*=>\s*)?([^$]+)/i;
c.fn=c.prototype={self:c,constructor:c,__lego:function(a,i){"string"!=typeof a&&(i=a,a=h);this._opts=this._defaults(i||{});this._data={};this._files={};this._listeners={};this._string=h;this._filename=a},_defaults:function(a){return f.extend({ns:this.self.NS,left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,rootDir:this.self.ROOT_DIR,compileDir:this.self.COMPILE_DIR,async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,
safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING,blockMode:this.self.BLOCK_MODE,debug:this.self.DEBUG},a)},_uniqKey:function(a){var i=this._opts;return i.left+i.right+i.trim+i.stream+a},_compile:function(a,i){var d=a===h?Math.random():this._uniqKey(a);if(k[d]!==h)k[d].done(function(a){this._tpl=a}.bind(this));else if(!this._tpl&&(a===h||k[d]===h)){var e=f.defer(),b={};k[d]=e.promise();this._load(a,function(d){d?(this._tpl=d,e.resolve(this._tpl)):(this._compiler||(this._compiler=new g(this._opts)),
this._parse(this._opts.rootDir+a,b,function(d){this._tpl=this._compiler.compile(d);this._save(a,b);e.resolve(this._tpl)}.bind(this),b))}.bind(this))}k[d].done(i)},_parse:function(a,i,d){this._parser===h&&(this._parser=new n(this._opts,a));var e=this._opts,b=f.defer(),c=[],j=function(d){for(var e=[],j=a.replace(/\/[\s%|\w\._-]+$/,"/"),g,k,l=0,d=this._parser.parse(d);l in d;){this._pre(d[l],l,d);l++}try{for(;g=d.shift();){this._prepare(g,d,c);g.prev=this.__node;k=this._trans(g,d,c);this.__node=g;k!==
null&&g.type!=g.COMMENT_NODE&&c.push(k);g.name=="include"&&e.push(this._parse(j+g.value,i).done(function(a,d){c[a-1]=d}.bind(this,c.length)))}}catch(m){e=[];c=[f.error(m)]}this.__node=h;f.defer.when(e).done(function(){b.resolve(this._normalizeStack(c))}.bind(this))}.bind(this);this._string!==h?j(this._string||"[[undefined]]"):(i[a]||(i[a]=f.mtime(a)),this.self.load(a,e.async,e.encoding,j));return b.done(d).promise()},_normalizeStack:function(a){for(var b=[],d;d=a.shift();)"string"!=typeof d&&d[0]?
a=d.concat(a):b.push(d);return b},_save:function(a,b){this._opts.compileDir&&f.writeFile(this._opts.compileDir+a+".json",JSON.stringify({includes:b,template:this._tpl.toString()}),this._opts.encoding)},_load:function(a,b){var d=this._opts,e=!0,c=f.defer();d.compileDir?f.getJSON(d.compileDir+a+".json",d.encoding,function(a,d){a?c.resolve(!1):(f.each(d.includes,function(a,d){f.mtime(d)!=a&&(e=!1)}),c.resolve(e&&(new Function("return "+d.template))()))}):c.resolve(!1);return c.done(b).promise()},_try:function(a,
b,d){b||(a&&a.__line?(b=a,a=a.value):b={});return"try{"+a+"}catch(_){"+(this._opts.debug&&b.__line?"__utils.error(_,"+b.__line+',"'+b.__file+'");':"")+(d!==h?"return "+d:"")+"}"},_pre:function(a,b,d){function e(d){return a.c.apply(a,[c].concat(d))}var c=this._opts.ns,h=j.findClosureIdx(d,a,b),g=f.Array(),k=f.Array(),l=f.Array(),m=f.Array();f.each(a.attributes,function(d,b){if(d.ns==c)switch(a.removeAttr(b),b=d.name,b){case "if":case "tag-if":var e=["if",{test:d.value}],f=["if",0,1];"if"==b?(g.addOrder(e,
0),m.addOrder(f,5)):(g.addOrder(e,3),k.addOrder(f,2),l.addOrder(["if",{test:d.value}],3),m.addOrder(["if",0,1],2));break;case "set":g.addOrder(["set",{name:d.value}],1);m.addOrder(["set",0,1],4);break;case "get":k.addOrder(["get",{name:d.value}],3);l.addOrder(["get",0,1],1);break;case "foreach":case "inner-foreach":var e=d.value.match(o),f={iterate:e[1]},i=["foreach",f],h=["foreach",0,1];e[2]&&(f.index=e[2]);f.as=e[3];"foreach"==b?(g.addOrder(i,2),m.addOrder(h,3)):(k.addOrder(i,5),l.addOrder(h,0))}},
this);d.addMulti(m.order().map(e),h+1);d.addMulti(l.order().map(e),h);d.addMulti(k.order().map(e),b+1);d.addMulti(g.order().map(e),b)},_prepare:function(a,b){var d=b[0],e=d&&d.name;if(d&&("attrs"==e||"attributes"==e))a.__openTag=!0},_trans:function(a,b){var d=[],e,c=a.attributes;if(this._opts.ns==a.ns||!a.ns)switch(a.name){case "script":e=" "+this._try(b.shift().value,a)+" ";b.shift();break;case "if":e=a.__close?"}":"__XIF=false;"+this._try("__XIF=("+a.value+")",a)+"if(__XIF){";break;case "else":e=
"}"+a.name+"{";break;case "elseif":case "else if":e="}else if("+this.safe(a.value,a)+"){";break;case "for":case "cycle":case "foreach":a.__break=!0;a.__close?a.value="});":(e="",c.to?e="__buf.cycle("+a.attr("from")+", "+a.attr("to")+", function ("+(c.key||c.item||{value:""}).value+"){":(c.item&&(e=c.item.value),c.key&&(e+=(""==e?"__v,":",")+c.key.value),e="__XFOR=0;"+this._try("__XFOR="+a.attr("from",c._from),a)+"__buf.each(__XFOR, function ("+e+"){"));break;case "pull":if(a.__close)e="__buf.w('</span>');";
else{var g={id:f.uniqId(),name:a.attr("name"),as:c.as&&a.attr("value")||a.attr("name"),async:!!c.async,error:c.error&&a.attr("error")||"err"};this._pullStack||(this._pullStack=[]);this._pullStack.push(g);e="__buf.w('<span id=\""+g.id+"\">');";c.async?e+='__buf.pull(ctx,"'+g.name+'");':(e+='__buf.pullSync(ctx,"'+g.name+'",function('+g.error+","+g.as+"){",b.push({value:"});",type:a.ELEMENT_NODE}))}break;case "assign":e=a.attr("name").split(".");g=e.shift();"ctx"==g?e='__utils.ns(ctx,"'+e.join(".")+
'",':(b.push(j(g,j.VAR_NODE)),e=0<e.length?"if("+g+"===undef)"+g+"={};"+("__utils.ns("+g+',"'+e.join(".")+'",'):g+"=(");e=c.type&&"string"!=c.type?e+a.attr("value"):e+("'"+f.addslashes(a.attr("value"))+"'");e+=");";break;case "get":var g=[],k,l;if(c.attrs)l=c.attrs.value;else for(k in c)"name"!=k&&"attrs-name"!=k&&g.push(this._try("a."+k+"="+a.attr(k),a));a.__empty?e='__buf.#method#("'+a.attr("name")+'",#attrs#);':a.__close?e="});":1==this._opts.blockMode?e='__buf.#method#("'+a.attr("name")+'",#attrs#,function (__buf,'+
(c["attrs-name"]&&c["attrs-name"].value||"attrs")+"){":(e='__buf.#method#("'+a.attr("name")+'",#attrs#)',l=b.shift().value,b.shift());l?(g.length&&console.log("WARNING: Can't use block attributes at block mode == 2"),e='__XATTR="";'+this._try("__XATTR="+l,a)+e,g="__XATTR"):g=g.length?"(function(a){"+g.join("")+" return a})({})":"undef";e=e.replace("#attrs#",g).replace("#method#",this._opts.stream||this.blockLevel?"block":"blockLabel");break;case "set":if("set"==b[0].name&&b[0].__close)return b.shift(),
null;this.blockLevel=(this.blockLevel|0)+(a.__close?-1:1);a.__close?e="});":(e="",c.test&&(e+="if("+this.safe(a.attr("test"),a)+")"),e+='__buf.setBlock("'+a.attr("name")+'",function(__buf,'+(c["attrs-name"]&&a.attr("attrs-name")||"attrs")+"){");break;case "fail":case "loading":case "success":g=this._pullStack[this._pullStack.length-1];if("loading"==a.name)return null;e=a.__close?"}":"if("+("fail"==a.name?"":"!")+g.error+"){";g.async&&(e=a.__close?e+('__buf.w(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,
g.id).replace("%name",a.name)+"'); });"):'__buf.pull(ctx,"'+g.name+'",function('+g.error+","+g.as+"){__buf.w('<span id=\""+a.name+g.id+'" style="display: none">\');'+e);break;case "part":a.__close?e='if(ctx.__part=="'+this.__parts.pop()+'")__buf.off();':(e='if(ctx.__part=="'+a.attr("name")+'")__buf.on();',this.__parts||(this.__parts=[]),this.__parts.push(a.attr("name")));break;case "space":a.type=a.TEXT_NODE;e=" ";break;case "text":a.type=a.TEXT_NODE;c.value?e=a.attr("value"):(e=b.shift().value,b.shift());
break;case "attrs":case "attributes":if(a.__close)e="",a.type=a.TEXT_NODE,b[0].__close&&!b[0].__empty&&b[0].isShort()&&(b.shift(),e+="/"),e+=this._opts.right;else return(!a.prev||a.prev.type!=a.ELEMENT_NODE||a.prev.__close)&&f.exception("<"+this._opts.ns+":"+a.name+"/> must be the first child",a.__line,a.__file),null;break;case "attr":case "attribute":a.type=a.TEXT_NODE;e=a.__close?'"':" "+a.attr("name")+'="';break;case "closure":if(a.__close)e="})("+this.__closure.shift().join(",")+");";else{g=[];
l=[];e="(function(";this.__closure=this.__closure||[];for(k in c)l.push(k),g.push(this.safe(a.attr(k),a));e+=l.join(",")+"){";this.__closure.push(g)}break;default:e=this._myNode(a.name,a,c),e!==h&&(a.type=a.TEXT_NODE,f.isArray(e)&&(d=e,e=h))}e!==h&&(a.value=e);return d.length?d:a},_myNode:function(a,b,d){if(l[a])return l[a].call(this,b,d);if(l._)return l._.call(this,b,d)},fetch:function(a,c){c===h&&(c=a,a=h);this._tpl===h?this._compile(this._filename,this.fetch.bind(this,a,c)):this._tpl(a||{},new b(c,
this._opts.stream),f)},loadString:function(a){this._string=f.trim(a);this._compile();return this},on:function(a,b){this._listeners[a]=b;return this},set:function(a,b){"string"==typeof a?this._data[a]=b:this._data=a||{};return this},safe:function(a,b,d){if(!b||!b.__line)d=b,b=h;return this._opts.safeMode?"(function(){"+this._try("return "+a,b,'""')+"})"+(d?"":"()"):a},escape:function(a,b){return this._opts.escape?"__utils.escape("+this.safe(a,b)+")":this.safe(a,b)}};c._files={};c.load=function(a,b,
d,c){return(this._files[a]||(this._files[a]=f.load(a,b,d))).done(c)};c.NS="xtpl";c.LEFT="<";c.RIGHT=">";c.C_OPEN="<\!--";c.C_CLOSE="--\>";c.TRIM=!0;c.ASYNC=!0;c.STREAM=!1;c.ESCAPE=!0;c.SAFE_MODE=!0;c.ENCODING="utf-8";c.BLOCK_MODE=1;c.DEBUG=!0;c.ROOT_DIR="";c.COMPILE_DIR="";c.fetch=function(a,b,d){var c=new this(a),g=f.defer(),h="";c.fetch(b,function(a){null===a||!c._opts.stream?g.resolve(c._opts.stream?h:a):h+=a});d&&g.done(d);return g.promise()};c.fromString=function(a,b){return(new this(b)).loadString(a)};
c.tags=function(a){f.each(a,function(a,b){l[b]=a});return this};c.tags({doctype:function(a,b){return m[b.mode&&b.mode.value]||m.def}});c.engine=function(a){"string"==typeof a&&(a=p("./"+a));var b=this.fn;b._super={};f.each(a.statics,function(a,b){this[b]=a},this);f.each(a.fn,function(a,c){var f=b[c];f&&(b._super[c]=f);b[c]=a});return c};"undefined"!==typeof q?q("./AsyncTpl",c):module.exports=c})(p("./utils"),p("./Node"),p("./Parser"),p("./Compiler"),p("./Buffer"));(function(f,j){var n={},g=/\{\*|\*\}/g;
n.fn={_defaults:function(b){return this._super._defaults.call(this,f.extend(b||{},{firstLine:!1}))},_build:function(b,h){var c=[];"string"==typeof b&&(b={name:"a"});!b.__empty&&b.__close?c.push("</"+b.name+">"):(c.push("<"+b.name),f.each(h,function(b){c.push(" "+b.name+'="');for(var b=b.value.split(g),f=0,h=b.length;f<h;f++)f%2?c.push({name:"value",value:b[f],__escape:!0}):""!==b[f]&&c.push(b[f]);c.push('"')},this),b.__openTag||c.push(b.__empty?"/>":">"));return c},_trans:function(b,g,c){var k=[],
l,m=b.attributes;if(b.ns!=this._opts.ns)b.type==b.ELEMENT_NODE&&(k=this._build(b,m));else switch(b.name){case "if":l=b.__close?"":b.attr("test");break;case "choose":this.__choose=b.__open?1:0;break;case "when":l=b.__close?"}":(1==this.__choose?"":" else ")+"if("+this.safe(b.attr("test"),b)+"){";this.__choose++;break;case "otherwise":l=b.__close?"}":" else {";break;case "foreach":m={_from:"iterate",from:m.iterate||m.from,key:m.index,item:m.as,to:m.to};break;case "value":l=g.shift().value;g.shift();
break;case "include":l=b.attr("src");break;case "comment":b.type=b.TEXT_NODE;b.__empty?l="":(l="<\!--"+g.shift().value+"--\>",g.shift());break;case "template":return null}l!==j&&(f.isArray(l)?k=l:b.value=l);b.attributes=m;return k.length?k:this._super._trans.call(this,b,g,c)}};"undefined"!==typeof q?q("./XML",n):module.exports=n})(p("./utils"));var G=p("AsyncTpl");G.get=p;H.AsyncTpl=G;var w={},C=p("utils");AsyncTpl.fetch=function(f,j,n,g){"string"!=typeof j&&(g=n,n=j,j=x);if(w[f]===x)if("#"==f.charAt(0)){var b=
C.$(f)||{innerHTML:"[[#"+f+" \u2014 not found]]"};w[f]=new this;w[f].loadString(b.innerHTML)}else w[f]=new this(f);var h=C.defer();w[f].fetch(n,function(b){h.resolve(b===x?"":b)});j&&h.done(function(b){var f=C.$(j);if(f)f.innerHTML=b});return h.promise().done(g)};"undefined"!=typeof jQuery&&(jQuery.tpl=function(f){AsyncTpl.engine(f);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(f,j){jQuery.tpl("XML").fetch(f,this[0],j);return this})})(this);
