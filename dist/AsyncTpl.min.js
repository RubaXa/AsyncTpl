(function(I,w){function p(b,i){E[b.replace(F,"")]=i}function o(b){return E[b.replace(F,"")]}var F=/^.+\//,E={};p("fs",{readFile:function(b,i,l){jQuery.ajax({url:b,type:"get",dataType:"text",isLocal:!0,success:function(b){l(null,b)}})},readFileSync:function(b){return jQuery.ajax({url:b,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(b){function i(f,b,c,h){if(!(this instanceof i))return new i(f,b,c,h);if("number"===typeof f)switch(h=c,
c=b,b=f,b){case i.TEXT_NODE:f="<text>";break;case i.CDATA_NODE:f="<cdata>";break;case i.COMMENT_NODE:f="<comment>";break;case i.CUSTOM_NODE:f="<custom>"}else f=f.toLowerCase(),f.match(l)&&(this.ns=RegExp.$1,f=RegExp.$2);this.name=f;this.type=b;this.value=c;this.attributes=h||{};this.childNodes=[]}var l=/^([^:]+):(.+)/,g={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21,VAR_NODE:22},c={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,
input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,wbr:!0};i.prototype={constructor:i,attr:function(f,c){if(this.attributes[f])return this.attributes[f].value;b.exception('Tag "'+this.name+'", attribute "'+(c||f)+'" is missing',this.__line,this.__file)},removeAttr:function(f){delete this.attributes[f]},c:function(f,b,c,h){return this.clone(f,b,i.COMPILER_NODE,c,h)},clone:function(f,c,h,g,n){c=i(c,this.type,c.value);c.ns=f;c.type=h;c.__line=this.__line;c.__file=this.__file;c.__open=!n;c.__close=
!!n;b.each(g,function(a,j){c.attributes[j]=i(j,i.ATTRIBUTE_NODE,a)});return c},isShort:function(){return!0===c[this.name]}};for(var h in g)i[h]=i.prototype[h]=g[h];i.findClosureIdx=function(c,b,h){if(!b.__close)for(var h=h|0,g=c.length,i=0,a;h<g;h++)if(a=c[h],b.name==a.name&&(i+=a.__close?-1:1,a.__close&&1>i))return h};"undefined"!==typeof p?p("./Node",i):module.exports=i})(o("./utils"));(function(b,i){function l(a){return j[a]}function g(a){if(!(this instanceof g))return new g(a);var e=[],d=[],j,
c,b=!0,f=!0,h=!1;this.done=function(a){b&&a!==i&&(h?a(c):e.push(a));return this}.bind(this);this.fail=function(a){f&&a!==i&&(h?a(c):d.push(a));return this}.bind(this);this.then=function(a,q){return this.done(a).fail(q)}.bind(this);this.reject=function(a){b=!1;h=!0;for(c=a;d.length;)d.shift()(a);return this}.bind(this);this.resolve=function(a){f=!1;h=!0;for(c=a;e.length;)e.shift()(a);return this}.bind(this);this.promise=function(){j===i&&(j={done:this.done,fail:this.fail,then:this.then,promise:this.promise});
return j}.bind(this);a!==i&&a(this)}var c=Object.prototype.toString,h=String.prototype.trim,f=/^#/,k=[].slice,m=/^\s+/,z=/\s+$/,n=/[&<>"]/g,a=/'/g,j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},d="undefined"!==typeof console&&console,e={Array:function(a){a=a||[];a.map=a.map||function(a){for(var q=[],e=0,d=this.length;e<d;e++)q.push(a(this[e]));return q};a.add=function(a,q,e){a.__order=~~e;q===i?this.push(a):0==q?this.unshift(a):this.splice(q,0,a);return this};a.addOrder=function(a,q){return this.add(a,
i,q)};a.addMulti=function(a,q){a.length&&this.splice.apply(this,[q,0].concat(a));return this};a.order=function(){this.sort(function(a,q){return a.__order-q.__order});return this};return a},$:function(a){return"string"==typeof a?document.getElementById(a.replace(f,"")):a},sizeof:function(a){var d=0;if(a&&(e.isArray(a)||"object"==typeof a))"length"in a?d=a.length:e.each(a,function(){d++});return d},isArray:function(a){return"[object Array]"==c.call(a)},uniqId:function(){return(new Date).getTime()+""+
Math.round(1E3*Math.random())},ns:function(a,d,j){var d=d.split("."),c=d.pop();e.each(d,function(d){a[d]||(a[d]={});a=a[d]});a[c]=j},escape:function(a){return"string"===typeof a&&n.test(a)?a.replace(n,l):a},addslashes:function(d){return d.replace(a,"\\'")},log:d&&"object"==typeof d.log?Function.prototype.call.bind(d.log,d):function(){d&&d.log.apply(d,arguments)},exception:function(a,d,e){throw{message:a,line:d,file:e};},error:function(a,d,e){a="Error: "+a.message+" in "+(a.file||e)+" on line "+(a.line||
d);this.log(a);return a},keys:function(a){var d=[];Object.keys?d=Object.keys(a):e.each(a,function(a){d.push(a)});return d},each:function(a,d,e){if(a)if(a.forEach)a.forEach(d,e);else if("length"in a&&0 in a)for(var j=0,c=a.length;j<c;j++)d.call(e,a[j],j,a);else for(j in a)a.hasOwnProperty(j)&&d.call(e,a[j],j,a)},cycle:function(a,d,e){for(;a<=d;a++)e(a)},trim:h?function(a){return h.call(a)}:function(a){return(""+a).replace(m,"").replace(z,"")},extend:function(a){a=a||{};this.each(arguments,function(d,
e){0<e&&this.each(d,function(d,e){a[e]=d})},this);return a},indexOf:function(a,d){if(a.indexOf)return a.indexOf(d);for(var e=0,j=a.length;e<j;e++)if(a[e]===d)return e;return-1},inherit:function(a,d,j,c){if(2===arguments.length){var b=function(){};b.prototype=d.prototype;a.prototype=new b;a.prototype.self=a;a.prototype.constructor=a;e.each(d,function(d,e){a[e]=d})}else return d.prototype[j].apply(a,c)},defer:g,load:function(a,d,e,j){var c=this.defer();d?b.readFile(a,e||"utf-8",function(a,d){c[a?"reject":
"resolve"](a||d)}):c.resolve(o("fs").readFileSync(a,e||"utf-8"));return c.done(j).promise()},mtime:function(a){return b?+Date.parse(b.lstatSync(a).mtime):0},writeFile:function(a,d,e){b&&b.writeFileSync(a,d,e)},getJSON:function(a,d,j){var c=e.defer();if(b)try{c.resolve(JSON.parse(b.readFileSync(a,d)))}catch(f){c.reject()}return c.fail(function(){j(!0)}).done(function(a){j(!1,a)}).promise()}};g.prototype={constructor:g};g.when=function(a){var d=g(),j=[];a instanceof g?j.push.apply(j,arguments):j=a;
var c=0,b=j.length,f=function(){++c==b&&d.resolve()};e.each(j,function(a){a.done(f)});b||d.resolve();return d.promise()};Function.prototype.bind===i&&(Function.prototype.bind=function(a){var d=k.call(arguments,1),e=this;return function(){return e.apply(a,d.concat(k.call(arguments,0)))}});"undefined"!==typeof p?p("./utils",e):module.exports=e})(o("fs"));(function(b,i,l){function g(c,b){this._file=b;this._opts=i.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},
c);this._opts.tags&&(this._opts.tags=" "+this._opts.tags+" ")}function c(c){var b=(c+"").split(""),a=0,j={};this.pos=function(){for(var d=a;d--&&"\n"!=b[d];);return a-d+1};this.line=function(){for(var d=1,e=a;e--;)"\n"==b[e]&&d++;return d};this.peek=function(d){return b[a+(d||0)]};this.lex=function(d){return b.slice(a,a+d).join("")};this.match=function(a){var e=this.lex(a.length)===a;this.lastMatch=e?a:null;this.lastMatchLength=e?a.length:0;return e};this.next=function(d){"string"===typeof d&&(d=
d.length);a+=d||1;return this};this.save=function(d){j[d]=a;return this};this.load=function(d){a=j[d];return this};this.length=function(){return b.length-a};this.getStr=function(){for(var a,e="",j=this.peek(),c=1;a=this.peek();)if(this.next(),e+=a,"\\"==a)c++;else{if(j==a&&!(c%2))return e.substring(1,e.length-1);c=0}};this.substr=function(d,e){return b.slice(d,e||a).join("")};this.extract=function(a,e){this.save("extract");e!==l&&this.next(e);for(var j="",c;c=this.peek();){if(this.match(a))return this.next(a),
j;j+=c;this.next()}this.load("extract");return null}}var h=/['"]/,f=/^[\s\r\n\t]+$/,k=/^([$a-z][\da-z\s:>]|\/\w)$/i,m=/[a-z\d:-]/i;g.prototype={constructor:g,parse:function(g){var n,a="",j=i.Array(),d,e=this._opts,q=e.tags,B=e.left,C=e.right,J=e.c_open,o=e.c_close,p=B.length,G=0;!e.firstLine&&/^\s*<\?xml/.test(g)&&(g=i.trim(g.replace(/^[^>]+>\n?/,"")),G=1);g=new c(g);a:for(;n=g.peek();){if(g.match(J))n=g.extract(o,g.lastMatchLength),null!==n&&j.push(b(b.COMMENT_NODE,n));else if(g.match("<![CDATA["))n=
g.extract("]]\>",g.lastMatchLength),null!==n&&j.push(b(b.CDATA_NODE,n));else if(g.match(B))if(k.test(g.peek(p)+g.peek(p+1))){n="/"==g.next(B).peek()?(g.next(),!0):!1;d=g;var x=q,A=C,s,y=d;s=void 0;for(var r="";s=y.peek();)if(m.test(s))r+=s,y.next();else break;s=r;var r=void 0,v=y=!1,w={},t="",u=void 0;if(d.length()){d.save("attrs");x=!x||-1<x.indexOf(" "+s+" ");c:for(;r=d.peek();)if(x&&m.test(r))for(t="";r=d.peek();)if(d.match(A)||f.test(r)){w[t]=b(t,b.ATTRIBUTE_NODE);continue c}else if("="==r){if(h.test(d.peek(1)))u=
d.next().getStr();else{for(u="";(r=d.next().peek())&&!f.test(r)&&!d.match(A);)u+=r;u=""==u?l:u}w[t]=b(t,b.ATTRIBUTE_NODE,u);continue c}else t+=r,d.next();else if(d.match(A)){v=!0;y="/"==d.peek(-1);d.next(A);break}else x||(t+=r),d.next();v?(d=x?b(s,b.ELEMENT_NODE,"",w):b(s,b.ELEMENT_NODE,"",t),d.__close=y):(d.load("attrs"),d=b(b.TEXT_NODE,s))}else d=b(b.TEXT_NODE,s);(!e.trim||!f.test(a))&&""!=a&&j.push(b(b.TEXT_NODE,a));a="";d.type!=b.TEXT_NODE&&(d.__open=!n,d.__close=d.__close||n,d.__empty=d.__open&&
d.__close);j.push(d)}else{a+=n;g.next();continue a}else a+=n,g.next();0==g.length()&&""!=a&&j.push(b(b.TEXT_NODE,a));j.length&&(d=j[j.length-1],d.__line||(d.__line=g.line()+G,d.__file=this._file))}return j},build:function(c){for(var f=[],a,j,d=this.left,e=this.right;j=c.shift();){switch(j.type){case b.TEXT_NODE:case b.CDATA_NODE:a=j.value;break;case b.ELEMENT_NODE:a=d+(!j.__empty&&j.__close?"/":"")+j.name;i.each(j.attributes,function(d){a+=" "+d.name+(d.value!==l?'="'+d.value+'"':"")});a+=(j.__empty?
" /":"")+e;break;case b.CUSTOM_NODE:a=d+(j.__close?"/":"")+j.name+j.value+e}""!=a&&(f.push(a),a="")}return f.join("")},rebuild:function(c){return this.build(this.parse(c))}};"undefined"!==typeof p?p("./Parser",g):module.exports=g})(o("./Node"),o("./utils"));(function(b){function i(b){this._opts=b||{useWith:!1}}i.prototype={constructor:i,compile:function(i){function g(){var f="",g=0,i=h.length,a,j;if(i){for(;g<i;g++){j=typeof h[g];if(a!=j||"string"!=j)a&&(f+="string"==a?"',":","),f+="string"==j?"'":
"";f+="string"==j?b.addslashes(h[g]):h[g][0];a=j}"string"==j&&(f+="'");c.push("__buf.w("+f.replace(/\r/g,"").replace(/\n/g,"\\n")+");");h=[]}}for(var c=["","",""],h=[],f,k=["undef","undefined"];f=i.shift();)f.type&&f.type==f.VAR_NODE?~b.indexOf(k,f.name)||k.push(f.name):f.__break?(g(),c.push(f.value)):"value"==f.name?f.__escape?(g(),c.push(" try{__buf.v("+f.value+")}catch(e){} ")):h.push([f.value]):"string"==typeof f||f.type==f.TEXT_NODE||f.type==f.CDATA_NODE?h.push(f.value||f):(g(),c.push(f.value));
g();this._opts.useWith?(c[0]="with( ctx ){ ",c.push(" } ")):c[0]="'use strict';/*global ctx, __buf, utils*/";c[1]="var "+k.join(",");c[2]=";if(ctx.__part!==undef)__buf.off();";c=c.join("")+" __buf.end();";return new Function("ctx, __buf, __utils",c)}};"undefined"!==typeof p?p("./Compiler",i):module.exports=i})(o("./utils"));(function(b,i){function l(b,c){this._data="";this._pullLen=0;this._active=!0;this._stream=c;this._callback=b}l.prototype={constructor:l,on:function(){this._active=!0},off:function(){this._active=
!1},v:function(g){this._active&&g!==i&&(this._data+=b.escape(g));return this},w:function(b){if(this._active)if(1<arguments.length){var c="",h=arguments,f=h.length,i=0;switch(f){case 9:c=h[8]+c;case 8:c=h[7]+c;case 7:c=h[6]+c;case 6:c=h[5]+c;case 5:c=h[4]+c;case 4:c=h[3]+c;case 3:c=h[2]+c;case 2:this._data+=h[0]+h[1]+c;break;default:for(f=h.length;i<f;)this._data+=h[i++]}}else this._data+=b;return this},cycle:function(){this._active&&b.cycle.apply(b,arguments)},each:function(){this._active&&b.each.apply(b,
arguments)},block:function(b,c,h){this.w(this.getBlock(b,c,h))},blockLabel:function(b,c,h){this._active&&(h!==i&&this.setBlock(b,h,!0),this._blocks===i&&(this._chunks=[],this._blocks=[],this._attrs=[]),b=this._chunks.push(this._data,b)-1,this._blocks.push(b),c!==i&&(this._attrs[b]=c),this._data="")},setBlock:function(b,c,h){this._block===i&&(this._block={});if(!0!==h||this._block[b]===i)this._block[b]=c},getBlock:function(b,c,h){this._block[b]!==i&&(h=this._block[b]);return h!==i?(b=new l,b._block=
this._block,h(b,c),b.toStr()):""},pullSync:function(b,c,h){this.pull(b,c,h)},pull:function(g,c,h){this._pull===i&&(this._pull={});if(this._pull[c]===i){var f=b.defer(),k=function(){this._pullLen--;setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[c]=f.then(k,k);try{g[c](function(b,c){f[b?"reject":"resolve"](b||c)})}catch(m){f.reject(!0)}}h!==i&&this._pull[c].then(function(b){h(null,b)},function(b){h(b)});return this._pull[c].promise()},end:function(){this._stream&&(this._callback(this._data),
this._data="");if(0===this._pullLen){if(this._blocks!==i){for(var b=this._blocks,c=this._chunks,h=this._attrs,f=c.length,k=b.length,m;k--;)m=b[k],c[m]=this.getBlock(c[m],h[m]);b=c[--f];for(k=f;k--;)b=c[k]+b;this._data=b+this._data}this._callback(this._data);this._stream&&this._callback(null)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof p?p("./Buffer",l):module.exports=l})(o("./utils"));(function(b,i,l,g,c,h){function f(a,b){this.__lego(a,
b)}var k={},m={},z={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'},n=/^(.+)\s+as\s+(?:(.+)\s*=>\s*)?([^$]+)/i;f.fn=f.prototype={self:f,constructor:f,__lego:function(a,b){"string"!=typeof a&&(b=a,a=h);this._opts=this._defaults(b||{});this._data={};this._files={};this._listeners={};this._string=h;this._filename=a},_defaults:function(a){return b.extend({ns:this.self.NS,left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,
rootDir:this.self.ROOT_DIR,compileDir:this.self.COMPILE_DIR,async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING,blockMode:this.self.BLOCK_MODE,debug:this.self.DEBUG},a)},_uniqKey:function(a){var b=this._opts;return b.left+b.right+b.trim+b.stream+a},_compile:function(a,c){var d=a===h?Math.random():this._uniqKey(a);if(k[d]!==h)k[d].done(function(a){this._tpl=a}.bind(this));else if(!this._tpl&&(a===h||k[d]===h)){var e=b.defer(),
f={};k[d]=e.promise();this._load(a,function(d){d?(this._tpl=d,e.resolve(this._tpl)):(this._compiler||(this._compiler=new g(this._opts)),this._parse(this._opts.rootDir+a,f,function(d){this._tpl=this._compiler.compile(d);this._save(a,f);e.resolve(this._tpl)}.bind(this),f))}.bind(this))}k[d].done(c)},_parse:function(a,c,d){this._parser===h&&(this._parser=new l(this._opts,a));var e=this._opts,f=b.defer(),i=[],g=function(d){for(var e=[],g=a.replace(/\/[\s%|\w\._-]+$/,"/"),k,m,l=0,d=this._parser.parse(d);l in
d;){this._pre(d[l],l,d);l++}try{for(;k=d.shift();){this._prepare(k,d,i);k.prev=this.__node;m=this._trans(k,d,i);this.__node=k;m!==null&&k.type!=k.COMMENT_NODE&&i.push(m);k.name=="include"&&e.push(this._parse(g+k.value,c).done(function(a,d){i[a-1]=d}.bind(this,i.length)))}}catch(C){e=[];i=[b.error(C)]}this.__node=h;b.defer.when(e).done(function(){f.resolve(this._normalizeStack(i))}.bind(this))}.bind(this);this._string!==h?g(this._string||"[[undefined]]"):(c[a]||(c[a]=b.mtime(a)),this.self.load(a,e.async,
e.encoding,g));return f.done(d).promise()},_normalizeStack:function(a){for(var b=[],d;d=a.shift();)"string"!=typeof d&&d[0]?a=d.concat(a):b.push(d);return b},_save:function(a,c){this._opts.compileDir&&b.writeFile(this._opts.compileDir+a+".json",JSON.stringify({includes:c,template:this._tpl.toString()}),this._opts.encoding)},_load:function(a,c){var d=this._opts,e=!0,f=b.defer();d.compileDir?b.getJSON(d.compileDir+a+".json",d.encoding,function(a,d){a?f.resolve(!1):(b.each(d.includes,function(a,d){b.mtime(d)!=
a&&(e=!1)}),f.resolve(e&&(new Function("return "+d.template))()))}):f.resolve(!1);return f.done(c).promise()},_try:function(a,b,d){b||(a&&a.__line?(b=a,a=a.value):b={});return"try{"+a+"}catch(_){"+(this._opts.debug&&b.__line?"__utils.error(_,"+b.__line+',"'+b.__file+'");':"")+(d!==h?"return "+d:"")+"}"},_pre:function(a,c,d){function e(d){return a.c.apply(a,[f].concat(d))}var f=this._opts.ns,h=i.findClosureIdx(d,a,c),g=b.Array(),k=b.Array(),m=b.Array(),l=b.Array();b.each(a.attributes,function(d,b){if(d.ns==
f)switch(a.removeAttr(b),b=d.name,b){case "if":case "tag-if":var e=["if",{test:d.value}],c=["if",0,1];"if"==b?(g.addOrder(e,0),l.addOrder(c,5)):(g.addOrder(e,3),k.addOrder(c,2),m.addOrder(["if",{test:d.value}],3),l.addOrder(["if",0,1],2));break;case "set":g.addOrder(["set",{name:d.value}],1);l.addOrder(["set",0,1],4);break;case "get":k.addOrder(["get",{name:d.value}],3);m.addOrder(["get",0,1],1);break;case "foreach":case "inner-foreach":var e=d.value.match(n),c={iterate:e[1]},j=["foreach",c],h=["foreach",
0,1];e[2]&&(c.index=e[2]);c.as=e[3];"foreach"==b?(g.addOrder(j,2),l.addOrder(h,3)):(k.addOrder(j,5),m.addOrder(h,0))}},this);d.addMulti(l.order().map(e),h+1);d.addMulti(m.order().map(e),h);d.addMulti(k.order().map(e),c+1);d.addMulti(g.order().map(e),c)},_prepare:function(a,b){var d=b[0],e=d&&d.name;if(d&&("attrs"==e||"attributes"==e))a.__openTag=!0},_trans:function(a,c){var d=[],e,f=a.attributes;if(this._opts.ns==a.ns||!a.ns)switch(a.name){case "script":e=" "+this._try(c.shift().value,a)+" ";c.shift();
break;case "if":e=a.__close?"}":"if("+this.safe(a.value,a)+"){";break;case "else":e="}"+a.name+"{";break;case "elseif":case "else if":e="}else if("+this.safe(a.value,a)+"){";break;case "for":case "cycle":case "foreach":a.__break=!0;a.__close?a.value="});":(e="",f.to?e="__buf.cycle("+a.attr("from")+", "+a.attr("to")+", function ("+(f.key||f.item||{value:""}).value+"){":(f.item&&(e=f.item.value),f.key&&(e+=(""==e?"__v,":",")+f.key.value),e="__buf.each("+this.safe(a.attr("from",f._from),a)+", function ("+
e+"){"));break;case "pull":if(a.__close)e="__buf.w('</span>');";else{var g={id:b.uniqId(),name:a.attr("name"),as:f.as&&a.attr("value")||a.attr("name"),async:!!f.async,error:f.error&&a.attr("error")||"err"};this._pullStack||(this._pullStack=[]);this._pullStack.push(g);e="__buf.w('<span id=\""+g.id+"\">');";f.async?e+='__buf.pull(ctx,"'+g.name+'");':(e+='__buf.pullSync(ctx,"'+g.name+'",function('+g.error+","+g.as+"){",c.push({value:"});",type:a.ELEMENT_NODE}))}break;case "assign":e=a.attr("name").split(".");
g=e.shift();"ctx"==g?e='__utils.ns(ctx,"'+e.join(".")+'",':(c.push(i(g,i.VAR_NODE)),e=0<e.length?"if("+g+"===undef)"+g+"={};"+("__utils.ns("+g+',"'+e.join(".")+'",'):g+"=(");e=f.type&&"string"!=f.type?e+a.attr("value"):e+("'"+b.addslashes(a.attr("value"))+"'");e+=");";break;case "get":var g=[],k,m;if(f.attrs)m=f.attrs.value;else for(k in f)"name"!=k&&"attrs-name"!=k&&g.push(this._try("a."+k+"="+a.attr(k),a));a.__empty?e='__buf.#method#("'+a.attr("name")+'",#attrs#);':a.__close?e="});":1==this._opts.blockMode?
e='__buf.#method#("'+a.attr("name")+'",#attrs#,function (__buf,'+(f["attrs-name"]&&f["attrs-name"].value||"attrs")+"){":(e='__buf.#method#("'+a.attr("name")+'",#attrs#)',m=c.shift().value,c.shift());m?(g.length&&console.log("WARNING: Can't use block attributes at block mode == 2"),g=this.safe(m,a)):g=g.length?"(function(a){"+g.join("")+" return a})({})":"undef";e=e.replace("#attrs#",g).replace("#method#",this._opts.stream||this.blockLevel?"block":"blockLabel");break;case "set":if("set"==c[0].name&&
c[0].__close)return c.shift(),null;this.blockLevel=(this.blockLevel|0)+(a.__close?-1:1);a.__close?e="});":(e="",f.test&&(e+="if("+this.safe(a.attr("test"),a)+")"),e+='__buf.setBlock("'+a.attr("name")+'",function(__buf,'+(f["attrs-name"]&&a.attr("attrs-name")||"attrs")+"){");break;case "fail":case "loading":case "success":g=this._pullStack[this._pullStack.length-1];if("loading"==a.name)return null;e=a.__close?"}":"if("+("fail"==a.name?"":"!")+g.error+"){";g.async&&(e=a.__close?e+('__buf.w(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,
g.id).replace("%name",a.name)+"'); });"):'__buf.pull(ctx,"'+g.name+'",function('+g.error+","+g.as+"){__buf.w('<span id=\""+a.name+g.id+'" style="display: none">\');'+e);break;case "part":a.__close?e='if(ctx.__part=="'+this.__parts.pop()+'")__buf.off();':(e='if(ctx.__part=="'+a.attr("name")+'")__buf.on();',this.__parts||(this.__parts=[]),this.__parts.push(a.attr("name")));break;case "space":a.type=a.TEXT_NODE;e=" ";break;case "text":a.type=a.TEXT_NODE;f.value?e=a.attr("value"):(e=c.shift().value,c.shift());
break;case "attrs":case "attributes":if(a.__close)e="",a.type=a.TEXT_NODE,c[0].__close&&!c[0].__empty&&c[0].isShort()&&(c.shift(),e+="/"),e+=this._opts.right;else return(!a.prev||a.prev.type!=a.ELEMENT_NODE||a.prev.__close)&&b.exception("<"+this._opts.ns+":"+a.name+"/> must be the first child",a.__line,a.__file),null;break;case "attr":case "attribute":a.type=a.TEXT_NODE;e=a.__close?'"':" "+a.attr("name")+'="';break;case "closure":if(a.__close)e="})("+this.__closure.shift().join(",")+");";else{g=[];
m=[];e="(function(";this.__closure=this.__closure||[];for(k in f)m.push(k),g.push(this.safe(a.attr(k),a));e+=m.join(",")+"){";this.__closure.push(g)}break;default:e=this._myNode(a.name,a,f),e!==h&&(a.type=a.TEXT_NODE,b.isArray(e)&&(d=e,e=h))}e!==h&&(a.value=e);return d.length?d:a},_myNode:function(a,b,d){if(m[a])return m[a].call(this,b,d);if(m._)return m._.call(this,b,d)},fetch:function(a,f){f===h&&(f=a,a=h);this._tpl===h?this._compile(this._filename,this.fetch.bind(this,a,f)):this._tpl(a||{},new c(f,
this._opts.stream),b)},loadString:function(a){this._string=b.trim(a);this._compile();return this},on:function(a,b){this._listeners[a]=b;return this},set:function(a,b){"string"==typeof a?this._data[a]=b:this._data=a||{};return this},safe:function(a,b,d){if(!b||!b.__line)d=b,b=h;return this._opts.safeMode?"(function(){"+this._try("return "+a,b,'""')+"})"+(d?"":"()"):a},escape:function(a,b){return this._opts.escape?"__utils.escape("+this.safe(a,b)+")":this.safe(a,b)}};f._files={};f.load=function(a,c,
d,e){return(this._files[a]||(this._files[a]=b.load(a,c,d))).done(e)};f.NS="xtpl";f.LEFT="<";f.RIGHT=">";f.C_OPEN="<\!--";f.C_CLOSE="--\>";f.TRIM=!0;f.ASYNC=!0;f.STREAM=!1;f.ESCAPE=!0;f.SAFE_MODE=!0;f.ENCODING="utf-8";f.BLOCK_MODE=1;f.DEBUG=!0;f.ROOT_DIR="";f.COMPILE_DIR="";f.fetch=function(a,c,d){var e=new this(a),f=b.defer(),g="";e.fetch(c,function(a){null===a||!e._opts.stream?f.resolve(e._opts.stream?g:a):g+=a});d&&f.done(d);return f.promise()};f.fromString=function(a,b){return(new this(b)).loadString(a)};
f.tags=function(a){b.each(a,function(a,b){m[b]=a});return this};f.tags({doctype:function(a,b){return z[b.mode&&b.mode.value]||z.def}});f.engine=function(a){"string"==typeof a&&(a=o("./"+a));var c=this.fn;c._super={};b.each(a.statics,function(a,b){this[b]=a},this);b.each(a.fn,function(a,b){var f=c[b];f&&(c._super[b]=f);c[b]=a});return f};"undefined"!==typeof p?p("./AsyncTpl",f):module.exports=f})(o("./utils"),o("./Node"),o("./Parser"),o("./Compiler"),o("./Buffer"));(function(b,i){var l={},g=/\{\*|\*\}/g;
l.fn={_defaults:function(c){return this._super._defaults.call(this,b.extend(c||{},{firstLine:!1}))},_build:function(c,h){var f=[];"string"==typeof c&&(c={name:"a"});!c.__empty&&c.__close?f.push("</"+c.name+">"):(f.push("<"+c.name),b.each(h,function(b){f.push(" "+b.name+'="');for(var b=b.value.split(g),c=0,h=b.length;c<h;c++)c%2?f.push({name:"value",value:b[c],__escape:!0}):""!==b[c]&&f.push(b[c]);f.push('"')},this),c.__openTag||f.push(c.__empty?"/>":">"));return f},_trans:function(c,g,f){var k=[],
m,l=c.attributes;if(c.ns!=this._opts.ns)c.type==c.ELEMENT_NODE&&(k=this._build(c,l));else switch(c.name){case "if":m=c.__close?"":c.attr("test");break;case "choose":this.__choose=c.__open?1:0;break;case "when":m=c.__close?"}":(1==this.__choose?"":" else ")+"if("+this.safe(c.attr("test"),c)+"){";this.__choose++;break;case "otherwise":m=c.__close?"}":" else {";break;case "foreach":l={_from:"iterate",from:l.iterate||l.from,key:l.index,item:l.as,to:l.to};break;case "value":m=this.escape(g.shift().value,
c);g.shift();break;case "include":m=c.attr("src");break;case "comment":c.type=c.TEXT_NODE;c.__empty?m="":(m="<\!--"+g.shift().value+"--\>",g.shift());break;case "template":return null}m!==i&&(b.isArray(m)?k=m:c.value=m);c.attributes=l;return k.length?k:this._super._trans.call(this,c,g,f)}};"undefined"!==typeof p?p("./XML",l):module.exports=l})(o("./utils"));var H=o("AsyncTpl");H.get=o;I.AsyncTpl=H;var v={},D=o("utils");AsyncTpl.fetch=function(b,i,l,g){"string"!=typeof i&&(g=l,l=i,i=w);if(v[b]===w)if("#"==
b.charAt(0)){var c=D.$(b)||{innerHTML:"[[#"+b+" \u2014 not found]]"};v[b]=new this;v[b].loadString(c.innerHTML)}else v[b]=new this(b);var h=D.defer();v[b].fetch(l,function(b){h.resolve(b===w?"":b)});i&&h.done(function(b){var c=D.$(i);if(c)c.innerHTML=b});return h.promise().done(g)};"undefined"!=typeof jQuery&&(jQuery.tpl=function(b){AsyncTpl.engine(b);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(b,i){jQuery.tpl("XML").fetch(b,this[0],i);return this})})(this);
