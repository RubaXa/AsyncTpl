(function(H,w){function o(d,i){D[d.replace(E,"")]=i}function p(d){return D[d.replace(E,"")]}var E=/^.+\//,D={};o("fs",{readFile:function(d,i,n){jQuery.ajax({url:d,type:"get",dataType:"text",isLocal:!0,success:function(d){n(null,d)}})},readFileSync:function(d){return jQuery.ajax({url:d,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(d){function i(e,c,d,f){if(!(this instanceof i))return new i(e,c,d,f);if("number"===typeof e)switch(f=d,
d=c,c=e,c){case i.TEXT_NODE:e="<text>";break;case i.CDATA_NODE:e="<cdata>";break;case i.COMMENT_NODE:e="<comment>";break;case i.CUSTOM_NODE:e="<custom>"}else e=e.toLowerCase(),e.match(n)&&(this.ns=RegExp.$1,e=RegExp.$2);this.name=e;this.type=c;this.value=d;this.attributes=f||{};this.childNodes=[]}var n=/^([^:]+):(.+)/,k={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21,VAR_NODE:22},f={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,
input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,wbr:!0};i.prototype={constructor:i,attr:function(e,c){if(this.attributes[e])return this.attributes[e].value;d.exception('Tag "'+this.name+'", attribute "'+(c||e)+'" is missing',this.__line,this.__file)},removeAttr:function(e){delete this.attributes[e]},c:function(e,c,d,f){return this.clone(e,c,i.COMPILER_NODE,d,f)},clone:function(e,c,f,l,h){c=i(c,this.type,c.value);c.ns=e;c.type=f;c.__line=this.__line;c.__file=this.__file;c.__open=!h;c.__close=
!!h;d.each(l,function(a,b){c.attributes[b]=i(b,i.ATTRIBUTE_NODE,a)});return c},isShort:function(){return!0===f[this.name]}};for(var h in k)i[h]=i.prototype[h]=k[h];i.findClosureIdx=function(e,c,d){if(!c.__close)for(var d=d|0,f=e.length,h=0,a;d<f;d++)if(a=e[d],c.name==a.name&&(h+=a.__close?-1:1,a.__close&&1>h))return d};"undefined"!==typeof o?o("./Node",i):module.exports=i})(p("./utils"));(function(d,i){function n(a){return b[a]}function k(a){if(!(this instanceof k))return new k(a);var b=[],g=[],j,
c,d=!0,e=!0,f=!1;this.done=function(a){d&&a!==i&&(f?a(c):b.push(a));return this}.bind(this);this.fail=function(a){e&&a!==i&&(f?a(c):g.push(a));return this}.bind(this);this.then=function(a,q){return this.done(a).fail(q)}.bind(this);this.reject=function(a){d=!1;f=!0;for(c=a;g.length;)g.shift()(a);return this}.bind(this);this.resolve=function(a){e=!1;f=!0;for(c=a;b.length;)b.shift()(a);return this}.bind(this);this.promise=function(){j===i&&(j={done:this.done,fail:this.fail,then:this.then,promise:this.promise});
return j}.bind(this);a!==i&&a(this)}var f=Object.prototype.toString,h=String.prototype.trim,e=/^#/,c=[].slice,m=/^\s+/,l=/\s+$/,z=/[&<>"]/g,a=/'/g,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},j="undefined"!==typeof console&&console,g={Array:function(a){a=a||[];a.map=a.map||function(a){for(var q=[],b=0,g=this.length;b<g;b++)q.push(a(this[b]));return q};a.add=function(a,q,b){a.__order=~~b;q===i?this.push(a):0==q?this.unshift(a):this.splice(q,0,a);return this};a.addOrder=function(a,q){return this.add(a,
i,q)};a.addMulti=function(a,q){a.length&&this.splice.apply(this,[q,0].concat(a));return this};a.order=function(){this.sort(function(a,q){return a.__order-q.__order});return this};return a},$:function(a){return"string"==typeof a?document.getElementById(a.replace(e,"")):a},sizeof:function(a){var b=0;if(a&&(g.isArray(a)||"object"==typeof a))"length"in a?b=a.length:g.each(a,function(){b++});return b},isArray:function(a){return"[object Array]"==f.call(a)},uniqId:function(){return(new Date).getTime()+""+
Math.round(1E3*Math.random())},ns:function(a,b,j){var b=b.split("."),c=b.pop();g.each(b,function(b){a[b]||(a[b]={});a=a[b]});a[c]=j},escape:function(a){return"string"===typeof a&&z.test(a)?a.replace(z,n):a},addslashes:function(b){return b.replace(a,"\\'")},log:j&&"object"==typeof j.log?Function.prototype.call.bind(j.log,j):function(){j&&j.log.apply(j,arguments)},exception:function(a,b,g){throw{message:a,line:b,file:g};},error:function(a,b,g){a="Error: "+a.message+" in "+(a.file||g)+" on line "+(a.line||
b);this.log(a);return a},keys:function(a){var b=[];Object.keys?b=Object.keys(a):g.each(a,function(a){b.push(a)});return b},each:function(a,b,g){if(a)if(a.forEach)a.forEach(b,g);else if("length"in a&&0 in a)for(var j=0,c=a.length;j<c;j++)b.call(g,a[j],j,a);else for(j in a)a.hasOwnProperty(j)&&b.call(g,a[j],j,a)},cycle:function(a,b,g){for(;a<=b;a++)g(a)},trim:h?function(a){return h.call(a)}:function(a){return(""+a).replace(m,"").replace(l,"")},extend:function(a){a=a||{};this.each(arguments,function(b,
g){0<g&&this.each(b,function(b,g){a[g]=b})},this);return a},indexOf:function(a,b){if(a.indexOf)return a.indexOf(b);for(var g=0,j=a.length;g<j;g++)if(a[g]===b)return g;return-1},inherit:function(a,b,j,c){if(2===arguments.length){var d=function(){};d.prototype=b.prototype;a.prototype=new d;a.prototype.self=a;a.prototype.constructor=a;g.each(b,function(b,g){a[g]=b})}else return b.prototype[j].apply(a,c)},defer:k,load:function(a,b,g,j){var c=this.defer();b?d.readFile(a,g||"utf-8",function(a,b){c[a?"reject":
"resolve"](a||b)}):c.resolve(p("fs").readFileSync(a,g||"utf-8"));return c.done(j).promise()},mtime:function(a){return d?+Date.parse(d.lstatSync(a).mtime):0},writeFile:function(a,b,g){d&&d.writeFileSync(a,b,g)},getJSON:function(a,b,j){var c=g.defer();if(d)try{c.resolve(JSON.parse(d.readFileSync(a,b)))}catch(e){c.reject()}return c.fail(function(){j(!0)}).done(function(a){j(!1,a)}).promise()}};k.prototype={constructor:k};k.when=function(a){var b=k(),j=[];a instanceof k?j.push.apply(j,arguments):j=a;
var c=0,d=j.length,e=function(){++c==d&&b.resolve()};g.each(j,function(a){a.done(e)});d||b.resolve();return b.promise()};Function.prototype.bind===i&&(Function.prototype.bind=function(a){var b=c.call(arguments,1),g=this;return function(){return g.apply(a,b.concat(c.call(arguments,0)))}});"undefined"!==typeof o?o("./utils",g):module.exports=g})(p("fs"));(function(d,i,n){function k(c,d){this._file=d;this._opts=i.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},
c);this._opts.tags&&(this._opts.tags=" "+this._opts.tags+" ")}function f(c){var d=(c+"").split(""),a=0,b={};this.pos=function(){for(var b=a;b--&&"\n"!=d[b];);return a-b+1};this.line=function(){for(var b=1,g=a;g--;)"\n"==d[g]&&b++;return b};this.peek=function(b){return d[a+(b||0)]};this.lex=function(b){return d.slice(a,a+b).join("")};this.match=function(a){var b=this.lex(a.length)===a;this.lastMatch=b?a:null;this.lastMatchLength=b?a.length:0;return b};this.next=function(b){"string"===typeof b&&(b=
b.length);a+=b||1;return this};this.save=function(c){b[c]=a;return this};this.load=function(c){a=b[c];return this};this.length=function(){return d.length-a};this.getStr=function(){for(var a,b="",c=this.peek(),d=1;a=this.peek();)if(this.next(),b+=a,"\\"==a)d++;else{if(c==a&&!(d%2))return b.substring(1,b.length-1);d=0}};this.substr=function(b,g){return d.slice(b,g||a).join("")};this.extract=function(a,b){this.save("extract");b!==n&&this.next(b);for(var c="",d;d=this.peek();){if(this.match(a))return this.next(a),
c;c+=d;this.next()}this.load("extract");return null}}var h=/['"]/,e=/^[\s\r\n\t]+$/,c=/^([$a-z][\da-z\s:>]|\/\w)$/i,m=/[a-z\d:-]/i;k.prototype={constructor:k,parse:function(l){var k,a="",b=i.Array(),j,g=this._opts,q=g.tags,B=g.left,I=g.right,J=g.c_open,p=g.c_close,o=B.length,F=0;!g.firstLine&&/^\s*<\?xml/.test(l)&&(l=i.trim(l.replace(/^[^>]+>\n?/,"")),F=1);l=new f(l);a:for(;k=l.peek();){if(l.match(J))k=l.extract(p,l.lastMatchLength),null!==k&&b.push(d(d.COMMENT_NODE,k));else if(l.match("<![CDATA["))k=
l.extract("]]\>",l.lastMatchLength),null!==k&&b.push(d(d.CDATA_NODE,k));else if(l.match(B))if(c.test(l.peek(o)+l.peek(o+1))){k="/"==l.next(B).peek()?(l.next(),!0):!1;j=l;var x=q,A=I,s,y=j;s=void 0;for(var r="";s=y.peek();)if(m.test(s))r+=s,y.next();else break;s=r;var r=void 0,v=y=!1,w={},t="",u=void 0;if(j.length()){j.save("attrs");x=!x||-1<x.indexOf(" "+s+" ");c:for(;r=j.peek();)if(x&&m.test(r))for(t="";r=j.peek();)if(j.match(A)||e.test(r)){w[t]=d(t,d.ATTRIBUTE_NODE);continue c}else if("="==r){if(h.test(j.peek(1)))u=
j.next().getStr();else{for(u="";(r=j.next().peek())&&!e.test(r)&&!j.match(A);)u+=r;u=""==u?n:u}w[t]=d(t,d.ATTRIBUTE_NODE,u);continue c}else t+=r,j.next();else if(j.match(A)){v=!0;y="/"==j.peek(-1);j.next(A);break}else x||(t+=r),j.next();v?(j=x?d(s,d.ELEMENT_NODE,"",w):d(s,d.ELEMENT_NODE,"",t),j.__close=y):(j.load("attrs"),j=d(d.TEXT_NODE,s))}else j=d(d.TEXT_NODE,s);(!g.trim||!e.test(a))&&""!=a&&b.push(d(d.TEXT_NODE,a));a="";j.type!=d.TEXT_NODE&&(j.__open=!k,j.__close=j.__close||k,j.__empty=j.__open&&
j.__close);b.push(j)}else{a+=k;l.next();continue a}else a+=k,l.next();0==l.length()&&""!=a&&b.push(d(d.TEXT_NODE,a));b.length&&(j=b[b.length-1],j.__line||(j.__line=l.line()+F,j.__file=this._file))}return b},build:function(c){for(var e=[],a,b,j=this.left,g=this.right;b=c.shift();){switch(b.type){case d.TEXT_NODE:case d.CDATA_NODE:a=b.value;break;case d.ELEMENT_NODE:a=j+(!b.__empty&&b.__close?"/":"")+b.name;i.each(b.attributes,function(b){a+=" "+b.name+(b.value!==n?'="'+b.value+'"':"")});a+=(b.__empty?
" /":"")+g;break;case d.CUSTOM_NODE:a=j+(b.__close?"/":"")+b.name+b.value+g}""!=a&&(e.push(a),a="")}return e.join("")},rebuild:function(c){return this.build(this.parse(c))}};"undefined"!==typeof o?o("./Parser",k):module.exports=k})(p("./Node"),p("./utils"));(function(d){function i(d){this._opts=d||{useWith:!1}}i.prototype={constructor:i,compile:function(i){function k(){var c="",e=0,k=h.length,a,b;if(k){for(;e<k;e++){b=typeof h[e];if(a!=b||"string"!=b)a&&(c+="string"==a?"',":","),c+="string"==b?"'":
"";c+="string"==b?d.addslashes(h[e]):h[e][0];a=b}"string"==b&&(c+="'");f.push("__buf.w("+c.replace(/\r/g,"").replace(/\n/g,"\\n")+");");h=[]}}for(var f=["","",""],h=[],e,c=["undef","undefined"];e=i.shift();)e.type&&e.type==e.VAR_NODE?~d.indexOf(c,e.name)||c.push(e.name):e.__break?(k(),f.push(e.value)):"value"==e.name?e.__escape?(k(),f.push(" try{__buf.v("+e.value+")}catch(e){} ")):h.push([e.value]):"string"==typeof e||e.type==e.TEXT_NODE||e.type==e.CDATA_NODE?h.push(e.value||e):(k(),f.push(e.value));
k();this._opts.useWith?(f[0]="with( ctx ){ ",f.push(" } ")):f[0]="'use strict';/*global ctx, __buf, utils*/";f[1]="var "+c.join(",");f[2]=";if(ctx.__part!==undef)__buf.off();";f=f.join("")+" __buf.end();";return new Function("ctx, __buf, __utils",f)}};"undefined"!==typeof o?o("./Compiler",i):module.exports=i})(p("./utils"));(function(d,i){function n(d,f){this._data="";this._pullLen=0;this._active=!0;this._stream=f;this._callback=d}n.prototype={constructor:n,on:function(){this._active=!0},off:function(){this._active=
!1},v:function(k){this._active&&k!==i&&(this._data+=d.escape(k));return this},w:function(d){if(this._active)if(1<arguments.length){var f="",h=arguments.length,e=0;switch(h){case 9:f=arguments[8]+f;case 8:f=arguments[7]+f;case 7:f=arguments[6]+f;case 6:f=arguments[5]+f;case 5:f=arguments[4]+f;case 4:f=arguments[3]+f;case 3:f=arguments[2]+f;case 2:this._data+=arguments[0]+arguments[1]+f;break;default:for(h=arguments.length;e<h;)this._data+=arguments[e++]}}else this._data+=d;return this},cycle:function(){this._active&&
d.cycle.apply(d,arguments)},each:function(){this._active&&d.each.apply(d,arguments)},block:function(d,f,h){this.w(this.getBlock(d,f,h))},blockLabel:function(d,f,h){this._active&&(h!==i&&this.setBlock(d,h,!0),this._blocks===i&&(this._chunks=[],this._blocks=[],this._attrs=[]),d=this._chunks.push(this._data,d)-1,this._blocks.push(d),f!==i&&(this._attrs[d]=f),this._data="")},setBlock:function(d,f,h){this._block===i&&(this._block={});if(!0!==h||this._block[d]===i)this._block[d]=f},getBlock:function(d,
f,h){this._block[d]!==i&&(h=this._block[d]);return h!==i?(d=new n,d._block=this._block,h(d,f),d.toStr()):""},pullSync:function(d,f,h){this.pull(d,f,h)},pull:function(k,f,h){this._pull===i&&(this._pull={});if(this._pull[f]===i){var e=d.defer(),c=function(){this._pullLen--;setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[f]=e.then(c,c);try{k[f](function(c,d){e[c?"reject":"resolve"](c||d)})}catch(m){e.reject(!0)}}h!==i&&this._pull[f].then(function(c){h(null,c)},function(c){h(c)});
return this._pull[f].promise()},end:function(){this._stream&&(this._callback(this._data),this._data="");if(0===this._pullLen){if(this._blocks!==i){for(var d=this._blocks,f=this._chunks,h=this._attrs,e=f.length,c=d.length,m;c--;)m=d[c],f[m]=this.getBlock(f[m],h[m]);d=f[--e];for(c=e;c--;)d=f[c]+d;this._data=d+this._data}this._callback(this._data);this._stream&&this._callback(null)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof o?o("./Buffer",
n):module.exports=n})(p("./utils"));(function(d,i,n,k,f,h){function e(a,b){this.__lego(a,b)}var c={},m={},l={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'},z=/^(.+)\s+as\s+(?:(.+)\s*=>\s*)?([^$]+)/i;e.fn=e.prototype={self:e,constructor:e,__lego:function(a,b){"string"!=typeof a&&(b=a,a=h);this._opts=this._defaults(b||{});this._data={};this._files={};this._listeners={};this._string=h;this._filename=a},_defaults:function(a){return d.extend({ns:this.self.NS,left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,
rootDir:this.self.ROOT_DIR,compileDir:this.self.COMPILE_DIR,async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING,blockMode:this.self.BLOCK_MODE,debug:this.self.DEBUG},a)},_uniqKey:function(a){var b=this._opts;return b.left+b.right+b.trim+b.stream+a},_compile:function(a,b){var e=a===h?Math.random():this._uniqKey(a);if(c[e]!==h)c[e].done(function(a){this._tpl=a}.bind(this));else if(!this._tpl&&(a===h||c[e]===h)){var g=d.defer(),
f={};c[e]=g.promise();this._load(a,function(b){b?(this._tpl=b,g.resolve(this._tpl)):(this._compiler||(this._compiler=new k(this._opts)),this._parse(this._opts.rootDir+a,f,function(b){this._tpl=this._compiler.compile(b);this._save(a,f);g.resolve(this._tpl)}.bind(this),f))}.bind(this))}c[e].done(b)},_parse:function(a,b,c){this._parser===h&&(this._parser=new n(this._opts,a));var g=this._opts,e=d.defer(),f=[],i=function(c){for(var g=[],j=a.replace(/\/[\s%|\w\._-]+$/,"/"),i,l,m=0,c=this._parser.parse(c);m in
c;){this._pre(c[m],m,c);m++}try{for(;i=c.shift();){this._prepare(i,c,f);i.prev=this.__node;l=this._trans(i,c,f);this.__node=i;l!==null&&i.type!=i.COMMENT_NODE&&f.push(l);i.name=="include"&&g.push(this._parse(j+i.value,b).done(function(a,b){f[a-1]=b}.bind(this,f.length)))}}catch(k){g=[];f=[d.error(k)]}this.__node=h;d.defer.when(g).done(function(){e.resolve(this._normalizeStack(f))}.bind(this))}.bind(this);this._string!==h?i(this._string||"[[undefined]]"):(b[a]||(b[a]=d.mtime(a)),this.self.load(a,g.async,
g.encoding,i));return e.done(c).promise()},_normalizeStack:function(a){for(var b=[],c;c=a.shift();)"string"!=typeof c&&c[0]?a=c.concat(a):b.push(c);return b},_save:function(a,b){this._opts.compileDir&&d.writeFile(this._opts.compileDir+a+".json",JSON.stringify({includes:b,template:this._tpl.toString()}),this._opts.encoding)},_load:function(a,b){var c=this._opts,g=!0,e=d.defer();c.compileDir?d.getJSON(c.compileDir+a+".json",c.encoding,function(a,b){a?e.resolve(!1):(d.each(b.includes,function(a,b){d.mtime(b)!=
a&&(g=!1)}),e.resolve(g&&(new Function("return "+b.template))()))}):e.resolve(!1);return e.done(b).promise()},_try:function(a,b,c){b||(a&&a.__line?(b=a,a=a.value):b={});return"try{"+a+"}catch(_){"+(this._opts.debug&&b.__line?"__utils.error(_,"+b.__line+',"'+b.__file+'");':"")+(c!==h?"return "+c:"")+"}"},_pre:function(a,b,c){function g(b){return a.c.apply(a,[e].concat(b))}var e=this._opts.ns,f=i.findClosureIdx(c,a,b),h=d.Array(),m=d.Array(),l=d.Array(),k=d.Array();d.each(a.attributes,function(b,c){if(b.ns==
e)switch(a.removeAttr(c),c=b.name,c){case "if":case "tag-if":var d=["if",{test:b.value}],g=["if",0,1];"if"==c?(h.addOrder(d,0),k.addOrder(g,5)):(h.addOrder(d,3),m.addOrder(g,2),l.addOrder(["if",{test:b.value}],3),k.addOrder(["if",0,1],2));break;case "set":h.addOrder(["set",{name:b.value}],1);k.addOrder(["set",0,1],4);break;case "get":m.addOrder(["get",{name:b.value}],3);l.addOrder(["get",0,1],1);break;case "foreach":case "inner-foreach":var d=b.value.match(z),g={iterate:d[1]},f=["foreach",g],j=["foreach",
0,1];d[2]&&(g.index=d[2]);g.as=d[3];"foreach"==c?(h.addOrder(f,2),k.addOrder(j,3)):(m.addOrder(f,5),l.addOrder(j,0))}},this);c.addMulti(k.order().map(g),f+1);c.addMulti(l.order().map(g),f);c.addMulti(m.order().map(g),b+1);c.addMulti(h.order().map(g),b)},_prepare:function(a,b){var c=b[0],d=c&&c.name;if(c&&("attrs"==d||"attributes"==d))a.__openTag=!0},_trans:function(a,b){var c=[],g,e=a.attributes;if(this._opts.ns==a.ns||!a.ns)switch(a.name){case "script":g=" "+this._try(b.shift().value,a)+" ";b.shift();
break;case "if":g=a.__close?"}":"if("+this.safe(a.value,a)+"){";break;case "else":g="}"+a.name+"{";break;case "elseif":case "else if":g="}else if("+this.safe(a.value,a)+"){";break;case "for":case "cycle":case "foreach":a.__break=!0;a.__close?a.value="});":(g="",e.to?g="__buf.cycle("+a.attr("from")+", "+a.attr("to")+", function ("+(e.key||e.item||{value:""}).value+"){":(e.item&&(g=e.item.value),e.key&&(g+=(""==g?"__v,":",")+e.key.value),g="__buf.each("+this.safe(a.attr("from",e._from),a)+", function ("+
g+"){"));break;case "pull":if(a.__close)g="__buf.w('</span>');";else{var f={id:d.uniqId(),name:a.attr("name"),as:e.as&&a.attr("value")||a.attr("name"),async:!!e.async,error:e.error&&a.attr("error")||"err"};this._pullStack||(this._pullStack=[]);this._pullStack.push(f);g="__buf.w('<span id=\""+f.id+"\">');";e.async?g+='__buf.pull(ctx,"'+f.name+'");':(g+='__buf.pullSync(ctx,"'+f.name+'",function('+f.error+","+f.as+"){",b.push({value:"});",type:a.ELEMENT_NODE}))}break;case "assign":g=a.attr("name").split(".");
f=g.shift();"ctx"==f?g='__utils.ns(ctx,"'+g.join(".")+'",':(b.push(i(f,i.VAR_NODE)),g=0<g.length?"if("+f+"===undef)"+f+"={};"+("__utils.ns("+f+',"'+g.join(".")+'",'):f+"=(");g=e.type&&"string"!=e.type?g+a.attr("value"):g+("'"+d.addslashes(a.attr("value"))+"'");g+=");";break;case "get":var f=[],m,l;if(e.attrs)l=e.attrs.value;else for(m in e)"name"!=m&&"attrs-name"!=m&&f.push(this._try("a."+m+"="+a.attr(m),a));a.__empty?g='__buf.#method#("'+a.attr("name")+'",#attrs#);':a.__close?g="});":1==this._opts.blockMode?
g='__buf.#method#("'+a.attr("name")+'",#attrs#,function (__buf,'+(e["attrs-name"]&&e["attrs-name"].value||"attrs")+"){":(g='__buf.#method#("'+a.attr("name")+'",#attrs#)',l=b.shift().value,b.shift());l?(f.length&&console.log("WARNING: Can't use block attributes at block mode == 2"),f=this.safe(l,a)):f=f.length?"(function(a){"+f.join("")+" return a})({})":"undef";g=g.replace("#attrs#",f).replace("#method#",this._opts.stream||this.blockLevel?"block":"blockLabel");break;case "set":if("set"==b[0].name&&
b[0].__close)return b.shift(),null;this.blockLevel=(this.blockLevel|0)+(a.__close?-1:1);a.__close?g="});":(g="",e.test&&(g+="if("+this.safe(a.attr("test"),a)+")"),g+='__buf.setBlock("'+a.attr("name")+'",function(__buf,'+(e["attrs-name"]&&a.attr("attrs-name")||"attrs")+"){");break;case "fail":case "loading":case "success":f=this._pullStack[this._pullStack.length-1];if("loading"==a.name)return null;g=a.__close?"}":"if("+("fail"==a.name?"":"!")+f.error+"){";f.async&&(g=a.__close?g+('__buf.w(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,
f.id).replace("%name",a.name)+"'); });"):'__buf.pull(ctx,"'+f.name+'",function('+f.error+","+f.as+"){__buf.w('<span id=\""+a.name+f.id+'" style="display: none">\');'+g);break;case "part":a.__close?g='if(ctx.__part=="'+this.__parts.pop()+'")__buf.off();':(g='if(ctx.__part=="'+a.attr("name")+'")__buf.on();',this.__parts||(this.__parts=[]),this.__parts.push(a.attr("name")));break;case "space":a.type=a.TEXT_NODE;g=" ";break;case "text":a.type=a.TEXT_NODE;e.value?g=a.attr("value"):(g=b.shift().value,b.shift());
break;case "attrs":case "attributes":if(a.__close)g="",a.type=a.TEXT_NODE,b[0].__close&&!b[0].__empty&&b[0].isShort()&&(b.shift(),g+="/"),g+=this._opts.right;else return(!a.prev||a.prev.type!=a.ELEMENT_NODE||a.prev.__close)&&d.exception("<"+this._opts.ns+":"+a.name+"/> must be the first child",a.__line,a.__file),null;break;case "attr":case "attribute":a.type=a.TEXT_NODE;g=a.__close?'"':" "+a.attr("name")+'="';break;case "closure":if(a.__close)g="})("+this.__closure.shift().join(",")+");";else{f=[];
l=[];g="(function(";this.__closure=this.__closure||[];for(m in e)l.push(m),f.push(this.safe(a.attr(m),a));g+=l.join(",")+"){";this.__closure.push(f)}break;default:g=this._myNode(a.name,a,e),g!==h&&(a.type=a.TEXT_NODE,d.isArray(g)&&(c=g,g=h))}g!==h&&(a.value=g);return c.length?c:a},_myNode:function(a,b,c){if(m[a])return m[a].call(this,b,c);if(m._)return m._.call(this,b,c)},fetch:function(a,b){b===h&&(b=a,a=h);this._tpl===h?this._compile(this._filename,this.fetch.bind(this,a,b)):this._tpl(a||{},new f(b,
this._opts.stream),d)},loadString:function(a){this._string=d.trim(a);this._compile();return this},on:function(a,b){this._listeners[a]=b;return this},set:function(a,b){"string"==typeof a?this._data[a]=b:this._data=a||{};return this},safe:function(a,b,c){if(!b||!b.__line)c=b,b=h;return this._opts.safeMode?"(function(){"+this._try("return "+a,b,'""')+"})"+(c?"":"()"):a},escape:function(a,b){return this._opts.escape?"__utils.escape("+this.safe(a,b)+")":this.safe(a,b)}};e._files={};e.load=function(a,b,
c,e){return(this._files[a]||(this._files[a]=d.load(a,b,c))).done(e)};e.NS="xtpl";e.LEFT="<";e.RIGHT=">";e.C_OPEN="<\!--";e.C_CLOSE="--\>";e.TRIM=!0;e.ASYNC=!0;e.STREAM=!1;e.ESCAPE=!0;e.SAFE_MODE=!0;e.ENCODING="utf-8";e.BLOCK_MODE=1;e.DEBUG=!0;e.ROOT_DIR="";e.COMPILE_DIR="";e.fetch=function(a,b,c){var e=new this(a),f=d.defer(),h="";e.fetch(b,function(a){null===a||!e._opts.stream?f.resolve(e._opts.stream?h:a):h+=a});c&&f.done(c);return f.promise()};e.fromString=function(a,b){return(new this(b)).loadString(a)};
e.tags=function(a){d.each(a,function(a,c){m[c]=a});return this};e.tags({doctype:function(a,b){return l[b.mode&&b.mode.value]||l.def}});e.engine=function(a){"string"==typeof a&&(a=p("./"+a));var b=this.fn;b._super={};d.each(a.statics,function(a,b){this[b]=a},this);d.each(a.fn,function(a,c){var d=b[c];d&&(b._super[c]=d);b[c]=a});return e};"undefined"!==typeof o?o("./AsyncTpl",e):module.exports=e})(p("./utils"),p("./Node"),p("./Parser"),p("./Compiler"),p("./Buffer"));(function(d,i){var n={},k=/\{\*|\*\}/g;
n.fn={_defaults:function(f){return this._super._defaults.call(this,d.extend(f||{},{firstLine:!1}))},_build:function(f,h){var e=[];"string"==typeof f&&(f={name:"a"});!f.__empty&&f.__close?e.push("</"+f.name+">"):(e.push("<"+f.name),d.each(h,function(c){e.push(" "+c.name+'="');for(var c=c.value.split(k),d=0,f=c.length;d<f;d++)d%2?e.push({name:"value",value:c[d],__escape:!0}):""!==c[d]&&e.push(c[d]);e.push('"')},this),f.__openTag||e.push(f.__empty?"/>":">"));return e},_trans:function(f,h,e){var c=[],
m,l=f.attributes;if(f.ns!=this._opts.ns)f.type==f.ELEMENT_NODE&&(c=this._build(f,l));else switch(f.name){case "if":m=f.__close?"":f.attr("test");break;case "choose":this.__choose=f.__open?1:0;break;case "when":m=f.__close?"}":(1==this.__choose?"":" else ")+"if("+this.safe(f.attr("test"),f)+"){";this.__choose++;break;case "otherwise":m=f.__close?"}":" else {";break;case "foreach":l={_from:"iterate",from:l.iterate||l.from,key:l.index,item:l.as,to:l.to};break;case "value":m=this.escape(h.shift().value,
f);h.shift();break;case "include":m=f.attr("src");break;case "comment":f.type=f.TEXT_NODE;f.__empty?m="":(m="<\!--"+h.shift().value+"--\>",h.shift());break;case "template":return null}m!==i&&(d.isArray(m)?c=m:f.value=m);f.attributes=l;return c.length?c:this._super._trans.call(this,f,h,e)}};"undefined"!==typeof o?o("./XML",n):module.exports=n})(p("./utils"));(function(d,i){var n=/\r/g,k=/\n/g,f=/^\/(.+)\/(\w*)$/,h="foreach include extends block doctype",e={fn:{_defaults:function(c){c=d.extend({left:"{{",
right:"}}"},c,{tags:h,ns:i,escape:!1});c.c_open=c.left+"*";c.c_close="*"+c.right;return this._super._defaults.call(this,c)},_trans:function(c,e,f){var h=[],a,b=c.attributes;if(c.type==c.ELEMENT_NODE||c.type==c.CUSTOM_NODE)switch(c.name){case "if":case "else":case "elseif":a=b;break;case "for":case "cycle":case "script":break;case "foreach":c.__break=!0;this.__foreach||(this.__foreach=[],this.__foreachelse=[]);if(c.__open)this.__foreach.push(b.from.value);else if(this.__foreachelse.length)return this.__foreachelse=
[],c.value="}",c;break;case "foreachelse":b=this.__foreach.pop();this.__foreachelse.push(b);a="}); if(!__utils.sizeof("+this.safe(b,c)+")){";break;case "block":b=!c.__close&&c.attr("name");this.__blocks||(this.__blocks={},this.___blocks=[]);b?(this.___blocks.push(b),this.__blocks[b]=1+this.__blocks[b]||0):b=this.___blocks.shift();c.name=0<this.__blocks[b]?"set":"get";break;case "extends":case "include":c.name="include";a=c.attr("file");break;default:if(this.fns[c.name]){var j=[];d.each(b,function(a,
b,d){d=a.value;d=/$\$/.test(d)?this.safe(d,c):'"'+d+'"';j.push(b+":"+d)});c.value="__this.fns."+c.name+"({"+j.join(",")+"},ctx)";c.name="value";return c}a=this.escape(c.name+b,c);c.name="value"}a!==i&&(c.value=a);return h.length?h:this._super._trans.call(this,c,e,f)},escape:function(c,e){var f=c.split("|"),c=f[0];d.each(f.splice(1),function(d){d=d.split(":");c="__this.mods."+d[0]+"("+c+(1<d.length?","+d.splice(1).join(","):"")+")"});return this._super.escape.call(this,c,e)},safe:function(c,d){return this._super.safe.call(this,
c.replace(/\$([a-z][a-z0-9_]*)/ig,function(c,d){return"(typeof "+d+'==="undefined"?ctx.'+d+":"+d+")"}),d)}},statics:{fn:function(c){d.each(c,function(c,d){h+=" "+d;this.fns[d]=c},this);return this},modifiers:function(c){d.each(c,function(c,d){this.mods[d]=function(){return c.apply(this,arguments)}},this);return this}}};e.fn.fns=e.statics.fns={};e.fn.mods=e.statics.mods={};e.statics.fn({assign:function(c,d){d[c["var"]]=c.value;return""}}).modifiers({upper:function(c){return c.toUpperCase()},lower:function(c){return c.toLowerCase()},
capitalize:function(c){return c.charAt(0).toUpperCase()+c.substr(1).toLowerCase()},nl2br:function(c){return c.replace(n,"").replace(k,"<br/>")},regexp_replace:function(c,d,e){d=d.match(f);return c.replace(RegExp(d[1],d[2]),e)}});"undefined"!==typeof o?o("./Smarty",e):module.exports=e})(p("./utils"));var G=p("AsyncTpl");G.get=p;H.AsyncTpl=G;var v={},C=p("utils");AsyncTpl.fetch=function(d,i,n,k){"string"!=typeof i&&(k=n,n=i,i=w);if(v[d]===w)if("#"==d.charAt(0)){var f=C.$(d)||{innerHTML:"[[#"+d+" \u2014 not found]]"};
v[d]=new this;v[d].loadString(f.innerHTML)}else v[d]=new this(d);var h=C.defer();v[d].fetch(n,function(d){h.resolve(d===w?"":d)});i&&h.done(function(d){var c=C.$(i);if(c)c.innerHTML=d});return h.promise().done(k)};"undefined"!=typeof jQuery&&(jQuery.tpl=function(d){AsyncTpl.engine(d);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(d,i){jQuery.tpl("XML").fetch(d,this[0],i);return this})})(this);
