(function(K,C){function p(d,g){G[d.replace(H,"")]=g}function n(d){return G[d.replace(H,"")]}var H=/^.+\//,G={};p("fs",{readFile:function(d,g,j){jQuery.ajax({url:d,type:"get",dataType:"text",isLocal:!0,success:function(d){j(null,d)}})},readFileSync:function(d){return jQuery.ajax({url:d,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(d){function g(b,d,c,r){if(!(this instanceof g))return new g(b,d,c,r);if("number"===typeof b)switch(r=c,
c=d,d=b,d){case g.TEXT_NODE:b="<text>";break;case g.CDATA_NODE:b="<cdata>";break;case g.COMMENT_NODE:b="<comment>";break;case g.CUSTOM_NODE:b="<custom>"}else b=b.toLowerCase(),b.match(j)&&(this.ns=RegExp.$1,b=RegExp.$2);this.name=b;this.type=d;this.value=c;this.attributes=r||{};this.childNodes=[]}var j=/^([^:]+):(.+)/,f={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21,VAR_NODE:22},c={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,
input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,wbr:!0};g.prototype={constructor:g,attr:function(b,c){if(this.attributes[b])return this.attributes[b].value;d.exception('Tag "'+this.name+'", attribute "'+(c||b)+'" is missing',this.__line,this.__file)},attrAny:function(b,c){var e;d.each(b.split(" "),function(b){e=e||this.attributes[b]},this);c&&!e&&this.attr(c);return e&&e.value},removeAttr:function(b){delete this.attributes[b]},c:function(b,d,c,e,f){return this.clone(b,d,g.COMPILER_NODE,c,e,
f)},clone:function(b,c,e,r,f,q){c=g(c,this.type,c.value);c.ns=b;c.type=e;c.value=q;c.__line=this.__line;c.__file=this.__file;c.__open=!f;c.__close=!!f;d.each(r,function(b,a){c.attributes[a]=g(a,g.ATTRIBUTE_NODE,b)});return c},isShort:function(){return!0===c[this.name]}};for(var e in f)g[e]=g.prototype[e]=f[e];g.trace=function(b,c){var e="";d.each(b,function(b){!b.__empty&&b.__close&&(e=e.substr(0,e.length-3));var f=e+c.left+(b.__close?"/":"")+(b.ns?b.ns+":":"")+b.name;"string"==typeof b.attributes?
f+=b.attributes:d.each(b.attributes,function(b,c){f=f+(" "+c+'="'+b.value+'"')});console.log(f+c.right);!b.__empty&&b.__open&&(e+="   ")},this)};g.findClosureIdx=function(b,c,d){if(!c.__close)for(var d=d|0,e=b.length,f=0,g;d<e;d++)if(g=b[d],c.name==g.name&&(f+=g.__close?-1:1,g.__close&&1>f))return d};"undefined"!==typeof p?p("./Node",g):module.exports=g})(n("./utils"));(function(d,g){function j(a){return u[a]}function f(a){if(!(this instanceof f))return new f(a);var i=[],b=[],c,d,e=!0,r=!0,q=!1,h=
this;h.done=function(a){e&&a&&(q?a(d):i.push(a));return h};h.fail=function(a){r&&a&&(q?a(d):b.push(a));return h};h.then=function(a,s){return h.done(a).fail(s)};h.reject=function(a){e=!1;q=!0;for(d=a;b.length;)b.shift()(a);return h};h.resolve=function(a){r=!1;q=!0;for(d=a;i.length;)i.shift()(a);return h};h.promise=function(){c===g&&(c={done:h.done,fail:h.fail,then:h.then,promise:h.promise});return c};a!==g&&a(h)}var c=Object.prototype.toString,e=String.prototype.trim,b=/^#/,h=[].slice,l=/^\s+/,r=/\s+$/,
o=/[&<>"]/g,q=/'/g,u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},a="undefined"!==typeof console&&console,i={Array:function(a){a=a||[];a.map=a.map||function(a){for(var s=[],i=0,b=this.length;i<b;i++)s.push(a(this[i]));return s};a.add=function(a,s,i){a.__order=~~i;s===g?this.push(a):0==s?this.unshift(a):this.splice(s,0,a);return this};a.addOrder=function(a,s){return this.add(a,g,s)};a.addMulti=function(a,s){a.length&&this.splice.apply(this,[s,0].concat(a));return this};a.order=function(){this.sort(function(a,
s){return a.__order-s.__order});return this};return a},$:function(a){return"string"==typeof a?document.getElementById(a.replace(b,"")):a},sizeof:function(a){var b=0;if(a&&(i.isArray(a)||"object"==typeof a))"length"in a?b=a.length:i.each(a,function(){b++});return b},isArray:function(a){return"[object Array]"==c.call(a)},uniqId:function(){return(new Date).getTime()+""+Math.round(1E3*Math.random())},ns:function(a,b,c){var b=b.split("."),d=b.pop();i.each(b,function(i){a[i]||(a[i]={});a=a[i]});a[d]=c},
escape:function(a){return"string"===typeof a&&o.test(a)?a.replace(o,j):a},addslashes:function(a){return a.replace(q,"\\'")},log:a&&"object"==typeof a.log?Function.prototype.call.bind(a.log,a):function(){a&&a.log.apply(a,arguments)},exception:function(a,i,b){throw{message:a,line:i,file:b};},error:function(a,b,c){b="Error: "+a.message+" in "+(a.file||c)+" on line "+(a.line||b);a.stack&&(b+="\n"+a.stack);i.log(b);return b},keys:function(a){var b=[];Object.keys?b=Object.keys(a):i.each(a,function(a){b.push(a)});
return b},each:function(a,i,b){if(a)if(a.forEach)a.forEach(i,b);else if("length"in a&&0 in a)for(var c=0,d=a.length;c<d;c++)i.call(b,a[c],c,a);else for(c in a)a.hasOwnProperty(c)&&i.call(b,a[c],c,a)},cycle:function(a,i,b){for(;a<=i;a++)b(a)},trim:e?function(a){return e.call(a)}:function(a){return(""+a).replace(l,"").replace(r,"")},extend:function(a){a=a||{};i.each(arguments,function(b,c){0<c&&i.each(b,function(b,i){a[i]=b})});return a},indexOf:function(a,b){if(a.indexOf)return a.indexOf(b);for(var i=
0,c=a.length;i<c;i++)if(a[i]===b)return i;return-1},inherit:function(a,b,c,d){if(2===arguments.length){var e=function(){};e.prototype=b.prototype;a.prototype=new e;a.prototype.self=a;a.prototype.constructor=a;i.each(b,function(b,i){a[i]=b})}else return b.prototype[c].apply(a,d)},defer:f,load:function(a,b,c,e){var f=i.defer();b?d.readFile(a,c||"utf-8",function(a,b){f[a?"reject":"resolve"](a||b)}):f.resolve(n("fs").readFileSync(a,c||"utf-8"));return f.done(e).promise()},mtime:function(a){return d?+Date.parse(d.lstatSync(a).mtime):
0},writeFile:function(a,b,i){d&&d.writeFileSync(a,b,i)},getJSON:function(a,b,c){var e=i.defer();if(d)try{e.resolve(JSON.parse(d.readFileSync(a,b)))}catch(f){e.reject()}return e.fail(function(){c(!0)}).done(function(a){c(!1,a)}).promise()}};f.prototype={constructor:f};f.when=function(a){var b=f(),c=[];a instanceof f?c.push.apply(c,arguments):c=a;var d=0,e=c.length,g=function(){++d==e&&b.resolve()};i.each(c,function(a){a.done(g)});e||b.resolve();return b.promise()};Function.prototype.bind===g&&(Function.prototype.bind=
function(a){var b=h.call(arguments,1),i=this;return function(){return i.apply(a,b.concat(h.call(arguments,0)))}});"undefined"!==typeof p?p("./utils",i):module.exports=i})(n("fs"));(function(d,g,j){function f(b,c){this._file=c;this._opts=g.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},b);this._opts.tags&&(this._opts.tags=" "+this._opts.tags+" ")}function c(b){var c=(b+"").split(""),d=0,e={};this.pos=function(){for(var a=d;a--&&"\n"!=c[a];);return d-a+1};this.line=
function(){for(var a=1,b=d;b--;)"\n"==c[b]&&a++;return a};this.peek=function(a){return c[d+(a||0)]};this.lex=function(a){return c.slice(d,d+a).join("")};this.match=function(a){var b=this.lex(a.length)===a;this.lastMatch=b?a:null;this.lastMatchLength=b?a.length:0;return b};this.next=function(a){"string"===typeof a&&(a=a.length);d+=a||1;return this};this.save=function(a){e[a]=d;return this};this.load=function(a){d=e[a];return this};this.length=function(){return c.length-d};this.getStr=function(){for(var a,
b="",c=this.peek(),d=1;a=this.peek();)if(this.next(),b+=a,"\\"==a)d++;else{if(c==a&&!(d%2))return b.substring(1,b.length-1);d=0}};this.substr=function(a,b){return c.slice(a,b||d).join("")};this.extract=function(a,b){this.save("extract");b!==j&&this.next(b);for(var c="",d;d=this.peek();){if(this.match(a))return this.next(a),c;c+=d;this.next()}this.load("extract");return null}}var e=/['"]/,b=/^[\s\r\n\t]+$/,h=/^([$a-z][\da-z\s:>]|\/\w)$/i,l=/[a-z\d:-]/i;f.prototype={constructor:f,parse:function(f){var o,
q="",u=g.Array(),a,i=this._opts,s=i.tags,D=i.left,x=i.right,L=i.c_open,k=i.c_close,m=D.length,I=0;!i.firstLine&&/^\s*<\?xml/.test(f)&&(f=g.trim(f.replace(/^[^>]+>\n?/,"")),I=1);f=new c(f);a:for(;o=f.peek();){if(f.match(L))o=f.extract(k,f.lastMatchLength),null!==o&&u.push(d(d.COMMENT_NODE,o));else if(f.match("<![CDATA["))o=f.extract("]]\>",f.lastMatchLength),null!==o&&u.push(d(d.CDATA_NODE,o));else if(f.match(D))if(h.test(f.peek(m)+f.peek(m+1))){o="/"==f.next(D).peek()?(f.next(),!0):!1;a=f;var n=s,
B=x,v,z=a;v=void 0;for(var t="";v=z.peek();)if(l.test(v))t+=v,z.next();else break;v=t;var t=void 0,p=z=!1,E={},w="",y=void 0;if(a.length()){a.save("attrs");n=!n||-1<n.indexOf(" "+v+" ");c:for(;t=a.peek();)if(n&&l.test(t))for(w="";t=a.peek();)if(a.match(B)||b.test(t)){E[w]=d(w,d.ATTRIBUTE_NODE);continue c}else if("="==t){if(e.test(a.peek(1)))y=a.next().getStr();else{for(y="";(t=a.next().peek())&&!b.test(t)&&!a.match(B);)y+=t;y=""==y?j:y}E[w]=d(w,d.ATTRIBUTE_NODE,y);continue c}else w+=t,a.next();else if(a.match(B)){p=
!0;z="/"==a.peek(-1);a.next(B);break}else n||(w+=t),a.next();p?(a=n?d(v,d.ELEMENT_NODE,"",E):d(v,d.ELEMENT_NODE,"",w),a.__close=z):(a.load("attrs"),a=d(d.TEXT_NODE,v))}else a=d(d.TEXT_NODE,v);(!i.trim||!b.test(q))&&""!=q&&u.push(d(d.TEXT_NODE,q));q="";a.type!=d.TEXT_NODE&&(a.__open=!o,a.__close=a.__close||o,a.__empty=a.__open&&a.__close);u.push(a)}else{q+=o;f.next();continue a}else q+=o,f.next();0==f.length()&&""!=q&&u.push(d(d.TEXT_NODE,q));u.length&&(a=u[u.length-1],a.__line||(a.__line=f.line()+
I,a.__file=this._file))}return u},build:function(b){for(var c=[],e,f,a=this.left,i=this.right;f=b.shift();){switch(f.type){case d.TEXT_NODE:case d.CDATA_NODE:e=f.value;break;case d.ELEMENT_NODE:e=a+(!f.__empty&&f.__close?"/":"")+f.name;g.each(f.attributes,function(a){e+=" "+a.name+(a.value!==j?'="'+a.value+'"':"")});e+=(f.__empty?" /":"")+i;break;case d.CUSTOM_NODE:e=a+(f.__close?"/":"")+f.name+f.value+i}""!=e&&(c.push(e),e="")}return c.join("")},rebuild:function(b){return this.build(this.parse(b))}};
"undefined"!==typeof p?p("./Parser",f):module.exports=f})(n("./Node"),n("./utils"));(function(d){function g(d){this._opts=d||{useWith:!1}}g.prototype={constructor:g,compile:function(g){function f(){var b="",f=0,g=e.length,a,i;if(g){for(;f<g;f++){i=typeof e[f];if(a!=i||"string"!=i)a&&(b+="string"==a?"',":","),b+="string"==i?"'":"";b+="string"==i?d.addslashes(e[f]):e[f][0];a=i}"string"==i&&(b+="'");c.push("__buf.w("+b.replace(/\r/g,"").replace(/\n/g,"\\n")+");");e=[]}}var c=[],e=[],b,h,l,r="undef,undefined,__this=this,__XIF,__XVAL,__XFOR,__XATTR,__XTAG".split(",");
for(b="";b=g.shift();)h=b.name,(l=b.type)&&l==b.VAR_NODE?~d.indexOf(r,h)||r.push(h):b.__break?(f(),c.push(b.value)):"value"==h||"val"==h?(f(),b=" try{__buf.v("+b.value,c.push(b+")}catch(e){} ")):"string"==typeof b||l==b.TEXT_NODE||l==b.CDATA_NODE?e.push(b.value||b):(f(),c.push(b.value));f();this._opts.useWith?(b="with( ctx ){ ",c.push(" } ")):b="'use strict';/*global ctx, __buf, utils*/";b+="var "+r.join(",")+"";c=";if(ctx.__part!==undef)__buf.off();"+c.join("")+" __buf.end();";c=b+c;return new Function("ctx, __buf, __utils",
c)}};"undefined"!==typeof p?p("./Compiler",g):module.exports=g})(n("./utils"));(function(d,g){function j(d,c){this._data="";this._pullLen=0;this._active=!0;this._stream=c;this._callback=d}j.prototype={constructor:j,on:function(){this._active=!0},off:function(){this._active=!1},v:function(f){this._active&&f!==g&&(this._data+=d.escape(f))},w:function(d){this._active&&(this._data+=d)},write:function(d){if(this._active)if(1<arguments.length){var c="",e=arguments,b=e.length,g=0;switch(b){case 9:c=e[8]+
c;case 8:c=e[7]+c;case 7:c=e[6]+c;case 6:c=e[5]+c;case 5:c=e[4]+c;case 4:c=e[3]+c;case 3:c=e[2]+c;case 2:this._data+=e[0]+e[1]+c;break;default:for(b=e.length;g<b;)this._data+=e[g++]}}else this._data+=d},cycle:function(){this._active&&d.cycle.apply(d,arguments)},each:function(){this._active&&d.each.apply(d,arguments)},block:function(d,c,e){this.w(this.getBlock(d,c,e))},blockLabel:function(d,c,e){this._active&&(e!==g&&this.setBlock(d,e,!0),this._blocks===g&&(this._chunks=[],this._blocks=[],this._attrs=
[]),d=this._chunks.push(this._data,d)-1,this._blocks.push(d),c!==g&&(this._attrs[d]=c),this._data="")},setBlock:function(d,c,e){this._block===g&&(this._block={});if(!0!==e||this._block[d]===g)this._block[d]=c},getBlock:function(d,c,e){this._block[d]!==g&&(e=this._block[d]);return e!==g?(d=new j,d._block=this._block,e(d,c),d.toStr()):""},pullSync:function(d,c,e){this.pull(d,c,e)},pull:function(f,c,e){this._pull===g&&(this._pull={});if(this._pull[c]===g){var b=d.defer(),h=function(){this._pullLen--;
setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[c]=b.then(h,h);try{f[c](function(d,c){b[d?"reject":"resolve"](d||c)})}catch(l){b.reject(!0)}}e!==g&&this._pull[c].then(function(b){e(null,b)},function(b){e(b)});return this._pull[c].promise()},end:function(){this._stream&&(this._callback(this._data),this._data="");if(0===this._pullLen){if(this._blocks!==g){for(var d=this._blocks,c=this._chunks,e=this._attrs,b=c.length,h=d.length,l;h--;)l=d[h],c[l]=this.getBlock(c[l],e[l]);d=
c[--b];for(h=b;h--;)d=c[h]+d;this._data=d+this._data}this._callback(this._data);this._stream&&this._callback(null)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof p?p("./Buffer",j):module.exports=j})(n("./utils"));(function(d,g,j,f,c,e){function b(a,b){this.__lego(a,b)}var h={},l={},r={},o={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',
xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'},q=/^(.+)\s+as\s+(?:(.+)\s*=>\s*)?([^$]+)/i,u=/\{\*(.*?)\*\}/g;b.fn=b.prototype={self:b,constructor:b,__lego:function(a,b){"string"!=typeof a&&
(b=a,a=e);this._opts=this._defaults(b||{});this._data={};this._files={};this._listeners={};this._string=e;this._filename=a},_defaults:function(a){return d.extend({ns:this.self.NS,left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,rootDir:this.self.ROOT_DIR,compileDir:this.self.COMPILE_DIR,async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING,blockMode:this.self.BLOCK_MODE,
debug:this.self.DEBUG},a)},_uniqKey:function(a){var b=this._opts;return b.left+b.right+b.trim+b.stream+a},_compile:function(a,b){var c=a===e?Math.random():this._uniqKey(a);if(h[c]!==e)h[c].done(function(a){this._tpl=a}.bind(this));else if(!this._tpl&&(a===e||h[c]===e)){var g=d.defer(),x={};h[c]=g.promise();this._load(a,function(b){b?(this._tpl=b,g.resolve(this._tpl)):(this._compiler||(this._compiler=new f(this._opts)),this._parse(this._opts.rootDir+a,x,function(b){this._tpl=this._compiler.compile(b);
this._save(a,x);g.resolve(this._tpl)}.bind(this)))}.bind(this))}h[c].done(b)},_parse:function(a,b,c,f){this._parser===e&&(this._parser=new j(this._opts,a));var g=this._opts,h=d.defer(),k=function(c){for(var s=[],e=a.replace(/\/[\s%|\w\._-]+$/,"/"),g,x,k=0,c=this._parser.parse(c);g=c[k];){x=g.name;(x=="include"||x=="extends")&&s.push(this._parse(e+g.attrAny("src file",true),b,0,1).done(function(a,b){c.splice(a,1);c.addMulti(b,a)}.bind(this,k)));k++}d.defer.when(s).done(function(){h.resolve(f?c:this._processing(c))}.bind(this))}.bind(this);
this._string!==e?k(this._string):(b[a]||(b[a]=d.mtime(a)),this.self.load(a,g.async,g.encoding,k));return h.done(c).promise()},_processing:function(a){for(var b=0,c,f=[],g;b in a;)this._pre(c=a[b],b,a),b++;try{for(;c=a.shift();)this._prepare(c,a,f),c.prev=this.__node,g=this._trans(c,a,f),this.__node=c,null!==g&&c.type!=c.COMMENT_NODE&&f.push(g)}catch(h){f=[d.error(h)]}this.__node=e;return this._normalizeStack(f)},_normalizeStack:function(a){for(var b=[],c;c=a.shift();)"string"!=typeof c&&c[0]?a=c.concat(a):
b.push(c);return b},_save:function(a,b){this._opts.compileDir&&d.writeFile(this._opts.compileDir+a+".json",JSON.stringify({includes:b,template:this._tpl.toString()}),this._opts.encoding)},_load:function(a,b){var c=this._opts,e=!0,f=d.defer();c.compileDir?d.getJSON(c.compileDir+a+".json",c.encoding,function(a,b){a?f.resolve(!1):(d.each(b.includes,function(a,b){d.mtime(b)!=a&&(e=!1)}),f.resolve(e&&(new Function("return "+b.template))()))}):f.resolve(!1);return f.done(b).promise()},_try:function(a,b,
c){b||(a&&a.__line?(b=a,a=a.value):b={});return"try{"+a+"}catch(_){"+(this._opts.debug&&b.__line?"__utils.error(_,"+b.__line+',"'+b.__file+'");':"")+(c!==e?"return "+c:"")+"}"},_pre:function(a,b,c){function e(b){return a.c.apply(a,[f].concat(b))}var f=this._opts.ns,h,k=a.attributes,l=g.findClosureIdx(c,a,b),j=d.Array(),n=d.Array(),p=d.Array(),o=d.Array();switch(a.name){case "tag":a.__close||(r[a.attr("name")]=1)}"string"!=typeof k&&d.each(k,function(d,e){if(f&&d.ns==f)switch(a.removeAttr(e),h=d.value,
e=d.name,e){case "if":case "tag-if":var g=["if",{test:h}],k=["if",0,1];"if"==e?(j.addOrder(g,0),o.addOrder(k,5)):(j.addOrder(g,3),n.addOrder(k,2),p.addOrder(["if",{test:h}],3),o.addOrder(["if",0,1],2));break;case "val":case "value":n.addOrder(["val"],6).addOrder(["<text>",0,0,h],7).addOrder(["val",0,1],8);a.__empty&&(a.__empty=a.__close=0,c.add(a.clone("",a.name,a.type,0,1),b+1));break;case "set":j.addOrder(["set",{name:h}],1);o.addOrder(["set",0,1],4);break;case "get":n.addOrder(["get",{name:h}],
3);a.__empty&&(l=b+1,a.__empty=a.__close=0,c.add(a.clone("",a.name,a.type,0,1),l));p.addOrder(["get",0,1],1);break;case "foreach":case "inner-foreach":h=h.match(q);var g={iterate:h[1]},k=["foreach",g],r=["foreach",0,1];h[2]&&(g.index=h[2]);g.as=h[3];"foreach"==e?(j.addOrder(k,2),o.addOrder(r,3)):(n.addOrder(k,5),p.addOrder(r,0))}},this);c.addMulti(o.order().map(e),l+1);c.addMulti(p.order().map(e),l);c.addMulti(n.order().map(e),b+1);c.addMulti(j.order().map(e),b)},_prepare:function(a,b){var c=b[0],
d=c&&c.name;if(c&&("attrs"==d||"attributes"==d))a.__openTag=!0},_trans:function(a,b){var c,f=[],h=a.name,l=a.value,k=a.attributes;if(this._opts.ns==a.ns||!a.ns)switch(h){case "script":c=" "+this._try(b.shift().value,a)+" ";b.shift();break;case "if":c=a.__close?"}":"__XIF=false;"+this._try("__XIF=("+l+")",a)+"if(__XIF){";break;case "else":c="}"+h+"{";break;case "elseif":case "else if":c="}else if("+this.safe(l,a)+"){";break;case "for":case "cycle":case "foreach":a.__break=!0;a.__close?c="});":(h="",
k.to?c="__buf.cycle("+a.attr("from")+", "+a.attr("to")+", function ("+(k.key||k.item||{value:""}).value+"){":(k.item&&(h=k.item.value),k.key&&(h+=(""==h?"__v,":",")+k.key.value),c="__XFOR=0;"+this._try("__XFOR="+a.attr("from",k._from),a)+"__buf.each(__XFOR, function ("+h+"){"));break;case "pull":if(a.__close)c="__buf.w('</span>');";else{var m={id:d.uniqId(),name:a.attr("name"),as:k.as&&a.attr("value")||a.attr("name"),async:!!k.async,error:k.error&&a.attr("error")||"err"};this._pullStack||(this._pullStack=
[]);this._pullStack.push(m);c="__buf.w('<span id=\""+m.id+"\">');";k.async?c+='__buf.pull(ctx,"'+m.name+'");':(c+='__buf.pullSync(ctx,"'+m.name+'",function('+m.error+","+m.as+"){",b.push({value:"});",type:a.ELEMENT_NODE}))}break;case "assign":h=a.attr("name").split(".");m=h.shift();"ctx"==m?c='__utils.ns(ctx,"'+h.join(".")+'",':(b.push(g(m,g.VAR_NODE)),0<h.length?(c="if("+m+"===undef)"+m+"={};",c+="__utils.ns("+m+',"'+h.join(".")+'",'):c=m+"=(");c=k.type&&"string"!=k.type.value?c+a.attr("value"):
c+("'"+d.addslashes(a.attr("value"))+"'");c+=");";break;case "get":var h=[],j;if(k.attrs)j=k.attrs.value;else for(m in k)"name"!=m&&"attrs-name"!=m&&h.push(this._try("a."+m+"="+a.attr(m),a));a.__empty?c='__buf.#method#("'+a.attr("name")+'",#attrs#);':a.__close?c="});":1==this._opts.blockMode?c='__buf.#method#("'+a.attr("name")+'",#attrs#,function (__buf,'+(k["attrs-name"]&&k["attrs-name"].value||"attrs")+"){":(c='__buf.#method#("'+a.attr("name")+'",#attrs#)',j=b.shift().value,b.shift());j?(h.length&&
console.log("WARNING: Can't use block attributes at block mode == 2"),c='__XATTR="";'+this._try("__XATTR="+j,a)+c,h="__XATTR"):h=h.length?"(function(a){"+h.join("")+" return a})({})":"undef";c=c.replace("#attrs#",h).replace("#method#",this._opts.stream||this.blockLevel?"block":"blockLabel");break;case "set":if("set"==b[0].name&&b[0].__close)return b.shift(),null;this.blockLevel=(this.blockLevel|0)+(a.__close?-1:1);a.__close?c="});":(c="",k.test&&(c+="if("+this.safe(a.attr("test"),a)+")"),c+='__buf.setBlock("'+
a.attr("name")+'",function(__buf,'+(k["attrs-name"]&&a.attr("attrs-name")||"attrs")+"){");break;case "fail":case "loading":case "success":m=this._pullStack[this._pullStack.length-1];if("loading"==h)return null;c=a.__close?"}":"if("+("fail"==h?"":"!")+m.error+"){";m.async&&(c=a.__close?c+('__buf.w(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,m.id).replace("%name",
a.name)+"'); });"):'__buf.pull(ctx,"'+m.name+'",function('+m.error+","+m.as+"){__buf.w('<span id=\""+h+m.id+'" style="display: none">\');'+c);break;case "part":a.__close?c='if(ctx.__part=="'+this.__parts.pop()+'")__buf.off();':(c='if(ctx.__part=="'+a.attr("name")+'")__buf.on();',this.__parts||(this.__parts=[]),this.__parts.push(a.attr("name")));break;case "space":a.type=a.TEXT_NODE;c=" ";break;case "text":a.type=a.TEXT_NODE;k.value?c=a.attr("value"):(c=b.shift().value,b.shift());break;case "attrs":case "attributes":if(a.__close)c=
"",a.type=a.TEXT_NODE,b[0].__close&&!b[0].__empty&&b[0].isShort()&&(b.shift(),c+="/"),c+=this._opts.right;else return(!a.prev||a.prev.type!=a.ELEMENT_NODE||a.prev.__close)&&d.exception("<"+this._opts.ns+":"+h+"/> must be the first child",a.__line,a.__file),null;break;case "attr":case "attribute":a.type=a.TEXT_NODE;c=a.__close?'"':" "+a.attr("name")+'="';break;case "closure":if(a.__close)c="})("+this.__closure.shift().join(",")+");";else{h=[];j=[];c="(function(";this.__closure=this.__closure||[];for(m in k)j.push(m),
h.push(this.safe(a.attr(m),a));c+=j.join(",")+"){";this.__closure.push(h)}break;case "tag":c=a.__close?"}":"function __xtag_"+a.attr("name").replace(/-/g,"_")+"(__buf,"+(k.context&&k.context.value||"tag")+",__inner){";break;case "tag-inner":c="if(__inner!==undef)__inner();";break;default:h in r?!a.__empty&&a.__close?c="});":(c="__XTAG={};",d.each(k,function(b,d){d='__XTAG["'+d+'"]';c+=d+'="'+b.value.replace(u,function(b,c){return'";'+this._try(d+"+="+c,a)+d+'+="'}.bind(this))+'";'},this),c+="__xtag_"+
h.replace(/-/g,"_")+"(__buf,__XTAG"+(a.__empty?");":",function(){")):(c=this._myNode(h,a,k),c!==e&&(a.type=a.TEXT_NODE,d.isArray(c)&&(f=c,c=e)))}c!==e&&(a.value=c);return f.length?f:a},_myNode:function(a,b,c){if(l[a])return l[a].call(this,b,c);if(l._)return l._.call(this,b,c)},fetch:function(a,b){b===e&&(b=a,a=e);this._tpl===e?this._compile(this._filename,this.fetch.bind(this,a,b)):(this._tpl.prototype.fns=this.fns,this._tpl.prototype.mods=this.mods,new this._tpl(a||{},new c(b,this._opts.stream),
d))},loadString:function(a){this._string=d.trim(a);this._compile();return this},on:function(a,b){this._listeners[a]=b;return this},set:function(a,b){"string"==typeof a?this._data[a]=b:this._data=a||{};return this},safe:function(a,b,c){if(!b||!b.__line)c=b,b=e;return this._opts.safeMode?"(function(){"+this._try("return "+a,b,'""')+"})"+(c?"":"()"):a},escape:function(a,b){return this._opts.escape?"__utils.escape("+this.safe(a,b)+")":this.safe(a,b)}};b._files={};b.load=function(a,b,c,e){return(this._files[a]||
(this._files[a]=d.load(a,b,c))).done(e)};b.NS="xtpl";b.LEFT="<";b.RIGHT=">";b.C_OPEN="<\!--";b.C_CLOSE="--\>";b.TRIM=!0;b.ASYNC=!0;b.STREAM=!1;b.ESCAPE=!0;b.SAFE_MODE=!0;b.ENCODING="utf-8";b.BLOCK_MODE=1;b.DEBUG=!0;b.ROOT_DIR="";b.COMPILE_DIR="";b.fetch=function(a,b,c){var e=new this(a),f=d.defer(),h="";e.fetch(b,function(a){null===a||!e._opts.stream?f.resolve(e._opts.stream?h:a):h+=a});c&&f.done(c);return f.promise()};b.fromString=function(a,b){return(new this(b)).loadString(a)};b.tags=function(a){d.each(a,
function(a,b){l[b]=a});return this};b.tags({doctype:function(a,b){return o[b.mode&&b.mode.value]||o.def}});b.engine=function(a){"string"==typeof a&&(a=n("./"+a));var c=this.fn;c._super={};d.each(a.statics,function(a,b){this[b]=a},this);d.each(a.fn,function(a,b){var d=c[b];d&&(c._super[b]=d);c[b]=a});return b};"undefined"!==typeof p?p("./AsyncTpl",b):module.exports=b})(n("./utils"),n("./Node"),n("./Parser"),n("./Compiler"),n("./Buffer"));(function(d,g){var j={},f=/\{\*|\*\}/g;j.fn={_defaults:function(c){return this._super._defaults.call(this,
d.extend(c||{},{firstLine:!1}))},_build:function(c,e){var b=[];"string"==typeof c&&(c={name:"a"});!c.__empty&&c.__close?b.push("</"+c.name+">"):(b.push("<"+c.name),d.each(e,function(c){b.push(" "+c.name+'="');for(var c=c.value.split(f),d=0,e=c.length;d<e;d++)d%2?b.push({name:"value",value:c[d],__escape:!0}):""!==c[d]&&b.push(c[d]);b.push('"')},this),c.__openTag||b.push(c.__empty?"/>":">"));return b},_trans:function(c,e,b){var f=[],l,j=c.attributes;if(c.ns!=this._opts.ns)c.type==c.ELEMENT_NODE&&(f=
this._build(c,j));else switch(c.name){case "if":l=c.__close?"":c.attr("test");break;case "choose":this.__choose=c.__open?1:0;break;case "when":l=c.__close?"}":(1==this.__choose?"":" else ")+"if("+this.safe(c.attr("test"),c)+"){";this.__choose++;break;case "otherwise":l=c.__close?"}":" else {";break;case "foreach":j={_from:"iterate",from:j.iterate||j.from,key:j.index,item:j.as,to:j.to};break;case "val":case "value":l=e.shift().value;e.shift();break;case "comment":c.type=c.TEXT_NODE;c.__empty?l="":
(l="<\!--"+e.shift().value+"--\>",e.shift());break;case "template":return null}l!==g&&(d.isArray(l)?f=l:c.value=l);c.attributes=j;return f.length?f:this._super._trans.call(this,c,e,b)}};"undefined"!==typeof p?p("./XML",j):module.exports=j})(n("./utils"));var J=n("AsyncTpl");J.get=n;K.AsyncTpl=J;var A={},F=n("utils");AsyncTpl.fetch=function(d,g,j,f){"string"!=typeof g&&(f=j,j=g,g=C);if(A[d]===C)if("#"==d.charAt(0)){var c=F.$(d)||{innerHTML:"[[#"+d+" \u2014 not found]]"};A[d]=new this;A[d].loadString(c.innerHTML)}else A[d]=
new this(d);var e=F.defer();A[d].fetch(j,function(b){e.resolve(b===C?"":b)});g&&e.done(function(b){var c=F.$(g);if(c)c.innerHTML=b});return e.promise().done(f)};"undefined"!=typeof jQuery&&(jQuery.tpl=function(d){AsyncTpl.engine(d);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(d,g){jQuery.tpl("XML").fetch(d,this[0],g);return this})})(this);
