(function(F,w){function n(e,i){C[e.replace(D,"")]=i}function o(e){return C[e.replace(D,"")]}var D=/^.+\//,C={};n("fs",{readFile:function(e,i,l){jQuery.ajax({url:e,type:"get",dataType:"text",isLocal:!0,success:function(d){l(null,d)}})},readFileSync:function(e){return jQuery.ajax({url:e,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(e){function i(b,f,d,e){if(!(this instanceof i))return new i(b,f,d,e);if("number"===typeof b)switch(e=d,
d=f,f=b,f){case i.TEXT_NODE:b="<text>";break;case i.CDATA_NODE:b="<cdata>";break;case i.COMMENT_NODE:b="<comment>";break;case i.CUSTOM_NODE:b="<custom>"}else b=b.toLowerCase(),b.match(l)&&(this.ns=RegExp.$1,b=RegExp.$2);this.name=b;this.type=f;this.value=d;this.attributes=e||[];this.childNodes=[]}var l=/(\w+):(\w+)/,d={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21,VAR_NODE:22},h={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,
input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,wbr:!0};i.prototype={constructor:i,attr:function(b,f){if(this.attributes[b])return this.attributes[b].value;e.exception('Tag "'+this.name+'", attribute "'+(f||b)+'" is missing',this.__line,this.__file)},replace:function(b){this.name=b.name;this.type=b.type;this.value=b.value;this.attributes=b.attributes;return this},addTextNode:function(b){return this.addChild(i.TEXT_NODE,b)},addChild:function(b,f,d,e){b instanceof i||(b=i(b,f,d,e));this.childNodes.push(b);
return this},addChilds:function(b){this.childNodes.push.apply(this.childNodes,b);return this},hasChildNodes:function(){return!!this.childNodes.length},isShort:function(){return!0===h[this.name]}};for(var j in d)i[j]=i.prototype[j]=d[j];"undefined"!==typeof n?n("./Node",i):module.exports=i})(o("./utils"));(function(e,i){function l(a){return p[a]}function d(a){if(!(this instanceof d))return new d(a);var c=[],g=[],b,f,e=!0,p=!0,m=!1;this.done=function(a){e&&a!==i&&(m?a(f):c.push(a));return this}.bind(this);
this.fail=function(a){p&&a!==i&&(m?a(f):g.push(a));return this}.bind(this);this.then=function(a,c){return this.done(a).fail(c)}.bind(this);this.reject=function(a){e=!1;m=!0;for(f=a;g.length;)g.shift()(a);return this}.bind(this);this.resolve=function(a){p=!1;m=!0;for(f=a;c.length;)c.shift()(a);return this}.bind(this);this.promise=function(){b===i&&(b={done:this.done,fail:this.fail,then:this.then,promise:this.promise});return b}.bind(this);a!==i&&a(this)}var h=Object.prototype.toString,j=String.prototype.trim,
b=/^#/,f=[].slice,k=/^\s+/,z=/\s+$/,a=/[&<>"]/g,g=/'/g,p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},c="undefined"!==typeof console&&console,m={$:function(a){return"string"==typeof a?document.getElementById(a.replace(b,"")):a},sizeof:function(a){var c=0;if(a&&(m.isArray(a)||"object"==typeof a))"length"in a?c=a.length:m.each(a,function(){c++});return c},isArray:function(a){return"[object Array]"==h.call(a)},uniqId:function(){return(new Date).getTime()+""+Math.round(1E3*Math.random())},ns:function(a,
c,g){var c=c.split("."),b=c.pop();m.each(c,function(c){a[c]||(a[c]={});a=a[c]});a[b]=g},escape:function(c){return"string"===typeof c&&a.test(c)?c.replace(a,l):c},addslashes:function(a){return a.replace(g,"\\'")},log:c&&"object"==typeof c.log?Function.prototype.call.bind(c.log,c):function(){c&&c.log.apply(c,arguments)},exception:function(a,c,g){throw{message:a,line:c,file:g};},error:function(a,c,g){a="Error: "+a.message+" in "+(a.file||g)+" on line "+(a.line||c);this.log(a);return a},keys:function(a){var c=
[];Object.keys?c=Object.keys(a):m.each(a,function(a){c.push(a)});return c},each:function(a,c,g){if(a)if(a.forEach)a.forEach(c,g);else if("length"in a&&0 in a)for(var b=0,f=a.length;b<f;b++)c.call(g,a[b],b,a);else for(b in a)a.hasOwnProperty(b)&&c.call(g,a[b],b,a)},cycle:function(a,c,g){for(;a<=c;a++)g(a)},trim:j?function(a){return j.call(a)}:function(a){return(""+a).replace(k,"").replace(z,"")},extend:function(a){a=a||{};this.each(arguments,function(c,g){0<g&&this.each(c,function(c,g){a[g]=c})},this);
return a},indexOf:function(a,c){if(a.indexOf)return a.indexOf(c);for(var g=0,b=a.length;g<b;g++)if(a[g]===c)return g;return-1},inherit:function(a,c,g,b){if(2===arguments.length){var f=function(){};f.prototype=c.prototype;a.prototype=new f;a.prototype.self=a;a.prototype.constructor=a;m.each(c,function(c,g){a[g]=c})}else return c.prototype[g].apply(a,b)},defer:d,load:function(a,c,g,b){var f=this.defer();c?e.readFile(a,g||"utf-8",function(a,c){f[a?"reject":"resolve"](a||c)}):f.resolve(o("fs").readFileSync(a,
g||"utf-8"));return f.done(b).promise()},mtime:function(a){return e?+Date.parse(e.lstatSync(a).mtime):0},writeFile:function(a,c,g){e&&e.writeFileSync(a,c,g)},getJSON:function(a,c,g){var b=m.defer();if(e)try{b.resolve(JSON.parse(e.readFileSync(a,c)))}catch(f){b.reject()}return b.fail(function(){g(!0)}).done(function(a){g(!1,a)}).promise()}};d.prototype={constructor:d};d.when=function(a){var c=d(),g=[];a instanceof d?g.push.apply(g,arguments):g=a;var b=0,f=g.length,e=function(){++b==f&&c.resolve()};
m.each(g,function(a){a.done(e)});f||c.resolve();return c.promise()};Function.prototype.bind===i&&(Function.prototype.bind=function(a){var c=f.call(arguments,1),g=this;return function(){return g.apply(a,c.concat(f.call(arguments,0)))}});"undefined"!==typeof n?n("./utils",m):module.exports=m})(o("fs"));(function(e,i,l){function d(b,a){this._file=a;this._opts=i.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},b);this._opts.tags&&(this._opts.tags=" "+this._opts.tags+
" ")}function h(b){var a=(b+"").split(""),g=0,f={};this.pos=function(){for(var c=g;c--&&!("\n"==a[c]););return g-c+1};this.line=function(){for(var c=1,b=g;b--;)"\n"==a[b]&&c++;return c};this.peek=function(c){return a[g+(c||0)]};this.lex=function(c){return a.slice(g,g+c).join("")};this.match=function(a){var g=this.lex(a.length)===a;this.lastMatch=g?a:null;this.lastMatchLength=g?a.length:0;return g};this.next=function(a){"string"===typeof a&&(a=a.length);g+=a||1;return this};this.save=function(a){f[a]=
g;return this};this.load=function(a){g=f[a];return this};this.length=function(){return a.length-g};this.getStr=function(){for(var a,g="",b=this.peek(),f=1;a=this.peek();)if(this.next(),g+=a,"\\"==a)f++;else{if(b==a&&!(f%2))return g.substring(1,g.length-1);f=0}};this.substr=function(c,b){return a.slice(c,b||g).join("")};this.extract=function(a,g){this.save("extract");g!==l&&this.next(g);for(var b="",f;f=this.peek();){if(this.match(a))return this.next(a),b;b+=f;this.next()}this.load("extract");return null}}
var j=/['"]/,b=/^[\s\r\n\t]+$/,f=/^([$a-z][\da-z\s:>]|\/\w)$/i,k=/[a-z\d:]/i;d.prototype={constructor:d,parse:function(d){var a,g="",p=[],c,m=this._opts,G=m.tags,B=m.left,n=m.right,o=m.c_open,H=m.c_close,u=B.length,E=0;!m.firstLine&&/^\s*<\?xml/.test(d)&&(d=i.trim(d.replace(/^[^>]+>\n?/,"")),E=1);d=new h(d);a:for(;a=d.peek();){if(d.match(o))a=d.extract(H,d.lastMatchLength),null!==a&&p.push(e(e.COMMENT_NODE,a));else if(d.match("<![CDATA["))a=d.extract("]]\>",d.lastMatchLength),null!==a&&p.push(e(e.CDATA_NODE,
a));else if(d.match(B))if(f.test(d.peek(u)+d.peek(u+1))){a="/"==d.next(B).peek()?(d.next(),!0):!1;c=d;var x=G,A=n,r,y=c;r=void 0;for(var q="";r=y.peek();)if(k.test(r))q+=r,y.next();else break;r=q;var q=void 0,w=y=!1,v={},s="",t=void 0;if(c.length()){c.save("attrs");x=!x||-1<x.indexOf(" "+r+" ");c:for(;q=c.peek();)if(x&&k.test(q))for(s="";q=c.peek();)if(c.match(A)||b.test(q)){v[s]={name:s,value:l};continue c}else if("="==q){if(j.test(c.peek(1)))t=c.next().getStr();else{for(t="";(q=c.next().peek())&&
!b.test(q)&&!c.match(A);)t+=q;t=""==t?l:t}v[s]=e(s,e.ATTRIBUTE_NODE,t);continue c}else s+=q,c.next();else if(c.match(A)){w=!0;y="/"==c.peek(-1);c.next(A);break}else x||(s+=q),c.next();w?(c=x?e(r,e.ELEMENT_NODE,"",v):e(r,e.ELEMENT_NODE,"",s),c.__close=y):(c.load("attrs"),c=e(e.TEXT_NODE,r))}else c=e(e.TEXT_NODE,r);m.trim&&b.test(g)||""!=g&&p.push(e(e.TEXT_NODE,g));g="";c.type!=e.TEXT_NODE&&(c.__open=!a,c.__close=c.__close||a,c.__empty=c.__open&&c.__close);p.push(c)}else{g+=a;d.next();continue a}else g+=
a,d.next();0==d.length()&&""!=g&&p.push(e(e.TEXT_NODE,g));p.length&&(c=p[p.length-1],c.__line||(c.__line=d.line()+E,c.__file=this._file))}return p},build:function(b){for(var a=[],g,f,c=this.left,d=this.right;f=b.shift();){switch(f.type){case e.TEXT_NODE:case e.CDATA_NODE:g=f.value;break;case e.ELEMENT_NODE:g=c+(!f.__empty&&f.__close?"/":"")+f.name;i.each(f.attributes,function(a){g+=" "+a.name+(a.value!==l?'="'+a.value+'"':"")});g+=(f.__empty?" /":"")+d;break;case e.CUSTOM_NODE:g=c+(f.__close?"/":
"")+f.name+f.value+d}""!=g&&(a.push(g),g="")}return a.join("")},rebuild:function(b){return this.build(this.parse(b))}};"undefined"!==typeof n?n("./Parser",d):module.exports=d})(o("./Node"),o("./utils"));(function(e){function i(e){this._opts=e||{useWith:!1}}i.prototype={constructor:i,compile:function(i){function d(){var b="",f=0,a=j.length,g,d;if(a){for(;f<a;f++){d=typeof j[f];if(g!=d||"string"!=d)g&&(b+="string"==g?"',":","),b+="string"==d?"'":"";b+="string"==d?e.addslashes(j[f]):j[f][0];g=d}"string"==
d&&(b+="'");h.push("__buf.w("+b.replace(/\r/g,"").replace(/\n/g,"\\n")+");");j=[]}}for(var h=["","",""],j=[],b,f=["undef","undefined"];b=i.shift();)b.type&&b.type==b.VAR_NODE?~e.indexOf(f,b.name)||f.push(b.name):b.__break?(d(),h.push(b.value)):"value"==b.name?b.__escape?(d(),h.push(" try{__buf.v("+b.value+")}catch(e){} ")):j.push([b.value]):"string"==typeof b||b.type==b.TEXT_NODE||b.type==b.CDATA_NODE?j.push(b.value||b):(d(),h.push(b.value));d();this._opts.useWith?(h[0]="with( ctx ){ ",h.push(" } ")):
h[0]="'use strict';/*global __buf, __this, utils, ctx*/";h[1]="var "+f.join(",");h[2]=";if(ctx.__part!==undef)__buf.off();";h=h.join("")+" __buf.end();";return new Function("ctx, __buf, __utils, __this",h)}};"undefined"!==typeof n?n("./Compiler",i):module.exports=i})(o("./utils"));(function(e,i){function l(d,e){this._data="";this._pullLen=0;this._active=!0;this._stream=e;this._callback=d}l.prototype={constructor:l,on:function(){this._active=!0},off:function(){this._active=!1},v:function(d){this._active&&
d!==i&&(this._data+=e.escape(d));return this},w:function(d){if(this._active)if(1<arguments.length){var e="",j=arguments.length,b=0;switch(j){case 9:e=arguments[8]+e;case 8:e=arguments[7]+e;case 7:e=arguments[6]+e;case 6:e=arguments[5]+e;case 5:e=arguments[4]+e;case 4:e=arguments[3]+e;case 3:e=arguments[2]+e;case 2:this._data+=arguments[0]+arguments[1]+e;break;default:for(j=arguments.length;b<j;)this._data+=arguments[b++]}}else this._data+=d;return this},cycle:function(){this._active&&e.cycle.apply(e,
arguments)},each:function(){this._active&&e.each.apply(e,arguments)},block:function(d,e,j){this.w(this.getBlock(d,e,j))},blockLabel:function(d,e,j){this._active&&(j!==i&&this.setBlock(d,j,!0),this._blocks===i&&(this._chunks=[],this._blocks=[],this._attrs=[]),d=this._chunks.push(this._data,d)-1,this._blocks.push(d),e!==i&&(this._attrs[d]=e),this._data="")},setBlock:function(d,e,j){this._block===i&&(this._block={});if(!0!==j||this._block[d]===i)this._block[d]=e},getBlock:function(d,e,j){this._block[d]!==
i&&(j=this._block[d]);return j!==i?(d=new l,d._block=this._block,j(d,e),d.toStr()):""},pullSync:function(d,e,j){this.pull(d,e,j)},pull:function(d,h,j){this._pull===i&&(this._pull={});if(this._pull[h]===i){var b=e.defer(),f=function(){this._pullLen--;setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[h]=b.then(f,f);try{d[h](function(f,a){b[f?"reject":"resolve"](f||a)})}catch(k){b.reject(!0)}}j!==i&&this._pull[h].then(function(b){j(null,b)},function(b){j(b)});return this._pull[h].promise()},
end:function(){this._stream&&(this._callback(this._data),this._data="");if(0===this._pullLen){if(this._blocks!==i){for(var e=this._blocks,h=this._chunks,j=this._attrs,b=h.length,f=e.length,k;f--;)k=e[f],h[k]=this.getBlock(h[k],j[k]);e=h[--b];for(f=b;f--;)e=h[f]+e;this._data=e+this._data}this._callback(this._data);this._stream&&this._callback(null)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof n?n("./Buffer",l):module.exports=l})(o("./utils"));
(function(e,i,l,d,h,j){function b(a,g){this.__lego(a,g)}var f={},k={},z={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'};b.fn=b.prototype={self:b,constructor:b,__lego:function(a,g){"string"!=typeof a&&(g=a,a=j);this._opts=this._defaults(g||{});this._data={};this._files={};this._listeners={};this._string=j;this._filename=a},_defaults:function(a){return e.extend({ns:this.self.NS,left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,rootDir:this.self.ROOT_DIR,
compileDir:this.self.COMPILE_DIR,async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING,blockMode:this.self.BLOCK_MODE,debug:this.self.DEBUG},a)},_uniqKey:function(a){var g=this._opts;return g.left+g.right+g.trim+g.stream+a},_compile:function(a,g){var b=a===j?Math.random():this._uniqKey(a);if(f[b]!==j)f[b].done(function(a){this._tpl=a}.bind(this));else if(!this._tpl&&(a===j||f[b]===j)){var c=e.defer(),m={};f[b]=c.promise();this._load(a,
function(g){g?(this._tpl=g,c.resolve(this._tpl)):(this._compiler||(this._compiler=new d(this._opts)),this._parse(this._opts.rootDir+a,m,function(g){this._tpl=this._compiler.compile(g);this._save(a,m);c.resolve(this._tpl)}.bind(this),m))}.bind(this))}f[b].done(g)},_parse:function(a,g,b){this._parser===j&&(this._parser=new l(this._opts,a));var c=this._opts,f=e.defer(),d=[],i=function(c){var b=[],i,p=a.replace(/\/[\s%|\w\._-]+$/,"/"),h,c=this._parser.parse(c);try{for(;i=c.shift();)this._prepare(i,c,
d),i.prev=this.__node,h=this._trans(i,c,d),this.__node=i,null!==h&&i.type!=i.COMMENT_NODE&&d.push(h),"include"==i.name&&b.push(this._parse(p+i.value,g).done(function(a,c){d[a-1]=c}.bind(this,d.length)))}catch(k){b=[],d=[e.error(k)]}this.__node=j;e.defer.when(b).done(function(){f.resolve(this._normalizeStack(d))}.bind(this))}.bind(this);this._string!==j?i(this._string||"[[undefined]]"):(g[a]||(g[a]=e.mtime(a)),this.self.load(a,c.async,c.encoding,i));return f.done(b).promise()},_normalizeStack:function(a){for(var g=
[],b;b=a.shift();)"string"!=typeof b&&b[0]?a=b.concat(a):g.push(b);return g},_save:function(a,b){this._opts.compileDir&&e.writeFile(this._opts.compileDir+a+".json",JSON.stringify({includes:b,template:this._tpl.toString()}),this._opts.encoding)},_load:function(a,b){var f=this._opts,c=!0,d=e.defer();f.compileDir?e.getJSON(f.compileDir+a+".json",f.encoding,function(a,b){a?d.resolve(!1):(e.each(b.includes,function(a,b){e.mtime(b)!=a&&(c=!1)}),d.resolve(c&&(new Function("return "+b.template))()))}):d.resolve(!1);
return d.done(b).promise()},_try:function(a,b,f){b||(a&&a.__line?(b=a,a=a.value):b={});return"try{"+a+"}catch(_){"+(this._opts.debug?"__utils.error(_,"+b.__line+',"'+b.__file+'");':"")+(f!==j?"return "+f:"")+"}"},_prepare:function(a,b){var f=b[0]&&b[0].name;if("attrs"==f||"attributes"==f)a.__openTag=!0},_trans:function(a,b){var f=[],c,d=a.attributes;if(this._opts.ns==a.ns||!a.ns)switch(a.name){case "script":c=" "+this._try(b.shift().value,a)+" ";b.shift();break;case "if":c=a.__close?"}":"if("+this.safe(a.value,
a)+"){";break;case "else":c="}"+a.name+"{";break;case "elseif":case "else if":c="}else if("+this.safe(a.value,a)+"){";break;case "for":case "cycle":case "foreach":a.__break=!0;a.__close?a.value="});":(c="",d.to?c="__buf.cycle("+a.attr("from")+", "+a.attr("to")+", function ("+(d.key||d.item||{value:""}).value+"){":(d.item&&(c=d.item.value),d.key&&(c+=(""==c?"__v,":",")+d.key.value),c="__buf.each("+this.safe(a.attr("from",d._from),a)+", function ("+c+"){"));break;case "pull":if(a.__close)c="__buf.w('</span>');";
else{var h={id:e.uniqId(),name:a.attr("name"),as:d.as&&a.attr("value")||a.attr("name"),async:!!d.async,error:d.error&&a.attr("error")||"err"};this._pullStack||(this._pullStack=[]);this._pullStack.push(h);c="__buf.w('<span id=\""+h.id+"\">');";d.async?c+='__buf.pull(ctx,"'+h.name+'");':(c+='__buf.pullSync(ctx,"'+h.name+'",function('+h.error+","+h.as+"){",b.push({value:"});",type:a.ELEMENT_NODE}))}break;case "assign":c=a.attr("name").split(".");h=c.shift();"ctx"==h?c='__utils.ns(ctx,"'+c.join(".")+
'",':(b.push(i(h,i.VAR_NODE)),c=0<c.length?"if("+h+"===undef)"+h+"={};"+("__utils.ns("+h+',"'+c.join(".")+'",'):h+"=(");c=d.type&&"string"!=d.type?c+a.attr("value"):c+("'"+e.addslashes(a.attr("value"))+"'");c+=");";break;case "get":var h=[],k,l;if(d.attrs)l=d.attrs.value;else for(k in d)"name"!=k&&"attrs-name"!=k&&h.push(this._try("a."+k+"="+a.attr(k),a));a.__empty?c='__buf.#method#("'+a.attr("name")+'",#attrs#);':a.__close?c="});":1==this._opts.blockMode?c='__buf.#method#("'+a.attr("name")+'",#attrs#,function (__buf,'+
(d["attrs-name"]&&d["attrs-name"].value||"attrs")+"){":(c='__buf.#method#("'+a.attr("name")+'",#attrs#)',l=b.shift().value,b.shift());l?(h.length&&console.log("WARNING: Can't use block attributes at block mode == 2"),h=this.safe(l,a)):h=h.length?"(function(a){"+h.join("")+" return a})({})":"undef";c=c.replace("#attrs#",h).replace("#method#",this._opts.stream||this.blockLevel?"block":"blockLabel");break;case "set":if("set"==b[0].name&&b[0].__close)return b.shift(),null;this.blockLevel=(this.blockLevel|
0)+(a.__close?-1:1);a.__close?c="});":(c="",d.test&&(c+="if("+this.safe(a.attr("test"),a)+")"),c+='__buf.setBlock("'+a.attr("name")+'",function(__buf,'+(d["attrs-name"]&&a.attr("attrs-name")||"attrs")+"){");break;case "fail":case "loading":case "success":h=this._pullStack[this._pullStack.length-1];if("loading"==a.name)return null;c=a.__close?"}":"if("+("fail"==a.name?"":"!")+h.error+"){";h.async&&(c=a.__close?c+('__buf.w(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,
h.id).replace("%name",a.name)+"'); });"):'__buf.pull(ctx,"'+h.name+'",function('+h.error+","+h.as+"){__buf.w('<span id=\""+a.name+h.id+'" style="display: none">\');'+c);break;case "part":a.__close?c='if(ctx.__part=="'+this.__parts.pop()+'")__buf.off();':(c='if(ctx.__part=="'+a.attr("name")+'")__buf.on();',this.__parts||(this.__parts=[]),this.__parts.push(a.attr("name")));break;case "space":a.type=a.TEXT_NODE;c=" ";break;case "text":a.type=a.TEXT_NODE;d.value?c=a.attr("value"):(c=b.shift().value,b.shift());
break;case "attrs":case "attributes":if(a.__close)c="",a.type=a.TEXT_NODE,b[0].__close&&!b[0].__empty&&b[0].isShort()&&(b.shift(),c+="/"),c+=this._opts.right;else return(!a.prev||a.prev.type!=a.ELEMENT_NODE||a.prev.__close)&&e.exception("<"+this._opts.ns+":"+a.name+"/> must be the first child",a.__line,a.__file),null;break;case "attr":case "attribute":a.type=a.TEXT_NODE;c=a.__close?'"':" "+a.attr("name")+'="';break;case "closure":if(a.__close)c="})("+this.__closure.shift().join(",")+");";else{h=[];
l=[];c="(function(";this.__closure=this.__closure||[];for(k in d)l.push(k),h.push(this.safe(a.attr(k),a));c+=l.join(",")+"){";this.__closure.push(h)}break;default:c=this._myNode(a.name,a,d),c!==j&&(a.type=a.TEXT_NODE,e.isArray(c)&&(f=c,c=j))}c!==j&&(a.value=c);return f.length?f:a},_myNode:function(a,b,f){if(k[a])return k[a].call(this,b,f);if(k._)return k._.call(this,b,f)},fetch:function(a,b){b===j&&(b=a,a=j);this._tpl===j?this._compile(this._filename,this.fetch.bind(this,a,b)):this._tpl(a||{},new h(b,
this._opts.stream),e,this)},loadString:function(a){this._string=e.trim(a);this._compile();return this},on:function(a,b){this._listeners[a]=b;return this},set:function(a,b){"string"==typeof a?this._data[a]=b:this._data=a||{};return this},safe:function(a,b,f){if(!b||!b.__line)f=b,b=j;return this._opts.safeMode?"(function(){"+this._try("return "+a,b,'""')+"})"+(f?"":"()"):a},escape:function(a,b){return this._opts.escape?"__utils.escape("+this.safe(a,b)+")":this.safe(a,b)}};b._files={};b.load=function(a,
b,f,c){return(this._files[a]||(this._files[a]=e.load(a,b,f))).done(c)};b.NS="xtpl";b.LEFT="<";b.RIGHT=">";b.C_OPEN="<\!--";b.C_CLOSE="--\>";b.TRIM=!0;b.ASYNC=!0;b.STREAM=!1;b.ESCAPE=!0;b.SAFE_MODE=!0;b.ENCODING="utf-8";b.BLOCK_MODE=1;b.DEBUG=!0;b.ROOT_DIR="";b.COMPILE_DIR="";b.fetch=function(a,b,f){var c=new this(a),d=e.defer(),h="";c.fetch(b,function(a){null===a||!c._opts.stream?d.resolve(c._opts.stream?h:a):h+=a});f&&d.done(f);return d.promise()};b.fromString=function(a,b){return(new this(b)).loadString(a)};
b.tags=function(a){e.each(a,function(a,b){k[b]=a});return this};b.tags({doctype:function(a,b){return z[b.mode&&b.mode.value]||z.def}});b.engine=function(a){"string"==typeof a&&(a=o("./"+a));var f=this.fn;f._super={};e.each(a.statics,function(a,b){this[b]=a},this);e.each(a.fn,function(a,b){var d=f[b];d&&(f._super[b]=d);f[b]=a});return b};"undefined"!==typeof n?n("./AsyncTpl",b):module.exports=b})(o("./utils"),o("./Node"),o("./Parser"),o("./Compiler"),o("./Buffer"));(function(e,i){var l={fn:{_defaults:function(d){return this._super._defaults.call(this,
e.extend(d||{},{firstLine:!1}))},_build:function(d,h){var i=[];"string"==typeof d&&(d={name:"a"});if(!d.__empty&&d.__close)i.push("</"+d.name+">");else{i.push("<"+d.name);var b=RegExp(this._opts.ns+":");e.each(h,function(f){b.test(f.value)?i.push(" "+f.name+'="',{name:"value",value:f.value.replace(b,""),__escape:!0},'"'):i.push(" "+f.name+'="'+f.value+'"')},this);d.__openTag||i.push(d.__empty?"/>":">")}return i},_trans:function(d,h,j){var b=[],f,k=d.attributes;if(d.ns!=this._opts.ns)d.type==d.ELEMENT_NODE&&
(b=this._build(d,k));else switch(d.name){case "if":f=d.__close?"":d.attr("test");break;case "choose":this.__choose=d.__open?1:0;break;case "when":f=d.__close?"}":(1==this.__choose?"":" else ")+"if("+this.safe(d.attr("test"),d)+"){";this.__choose++;break;case "otherwise":f=d.__close?"}":" else {";break;case "foreach":k={_from:"iterate",from:k.iterate||k.from,key:k.index,item:k.as,to:k.to};break;case "value":f=this.escape(h.shift().value,d);h.shift();break;case "include":f=d.attr("src");break;case "comment":d.type=
d.TEXT_NODE;d.__empty?f="":(f="<\!--"+h.shift().value+"--\>",h.shift());break;case "template":return null}f!==i&&(e.isArray(f)?b=f:d.value=f);d.attributes=k;return b.length?b:this._super._trans.call(this,d,h,j)}}};"undefined"!==typeof n?n("./XML",l):module.exports=l})(o("./utils"));(function(e,i){var l=/\r/g,d=/\n/g,h=/^\/(.+)\/(\w*)$/,j="foreach include extends block doctype",b={fn:{_defaults:function(b){b=e.extend({left:"{{",right:"}}"},b,{tags:j,ns:i,escape:!1});b.c_open=b.left+"*";b.c_close="*"+
b.right;return this._super._defaults.call(this,b)},_trans:function(b,d,h){var a=[],g,j=b.attributes;if(b.type==b.ELEMENT_NODE||b.type==b.CUSTOM_NODE)switch(b.name){case "if":case "else":case "elseif":g=j;break;case "for":case "cycle":case "script":break;case "foreach":b.__break=!0;this.__foreach||(this.__foreach=[],this.__foreachelse=[]);if(b.__open)this.__foreach.push(j.from.value);else if(this.__foreachelse.length)return this.__foreachelse=[],b.value="}",b;break;case "foreachelse":j=this.__foreach.pop();
this.__foreachelse.push(j);g="}); if(!__utils.sizeof("+this.safe(j,b)+")){";break;case "block":j=!b.__close&&b.attr("name");this.__blocks||(this.__blocks={},this.___blocks=[]);j?(this.___blocks.push(j),this.__blocks[j]=1+this.__blocks[j]||0):j=this.___blocks.shift();b.name=0<this.__blocks[j]?"set":"get";break;case "extends":case "include":b.name="include";g=b.attr("file");break;default:if(this.fns[b.name]){var c=[];e.each(j,function(a,d,e){e=a.value;e=/$\$/.test(e)?this.safe(e,b):'"'+e+'"';c.push(d+
":"+e)});b.value="__this.fns."+b.name+"({"+c.join(",")+"},ctx)";b.name="value";return b}g=this.escape(b.name+j,b);b.name="value"}g!==i&&(b.value=g);return a.length?a:this._super._trans.call(this,b,d,h)},escape:function(b,d){var h=b.split("|"),b=h[0];e.each(h.splice(1),function(a){a=a.split(":");b="__this.mods."+a[0]+"("+b+(1<a.length?","+a.splice(1).join(","):"")+")"});return this._super.escape.call(this,b,d)},safe:function(b,d){return this._super.safe.call(this,b.replace(/\$([a-z][a-z0-9_]*)/ig,
function(b,a){return"(typeof "+a+'==="undefined"?ctx.'+a+":"+a+")"}),d)}},statics:{fn:function(b){e.each(b,function(b,d){j+=" "+d;this.fns[d]=b},this);return this},modifiers:function(b){e.each(b,function(b,d){this.mods[d]=function(){return b.apply(this,arguments)}},this);return this}}};b.fn.fns=b.statics.fns={};b.fn.mods=b.statics.mods={};b.statics.fn({assign:function(b,d){d[b["var"]]=b.value;return""}}).modifiers({upper:function(b){return b.toUpperCase()},lower:function(b){return b.toLowerCase()},
capitalize:function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()},nl2br:function(b){return b.replace(l,"").replace(d,"<br/>")},regexp_replace:function(b,d,e){d=d.match(h);return b.replace(RegExp(d[1],d[2]),e)}});"undefined"!==typeof n?n("./Smarty",b):module.exports=b})(o("./utils"));F.AsyncTpl=o("AsyncTpl");var u={},v=o("utils");AsyncTpl.fetch=function(e,i,l,d){"string"!=typeof i&&(d=l,l=i,i=w);if(u[e]===w)if("#"==e.charAt(0)){var h=v.$(e)||{innerHTML:"[[#"+e+" \u2014 not found]]"};
u[e]=new this;u[e].loadString(h.innerHTML)}else u[e]=new this(e);var j=v.defer();u[e].fetch(l,function(b){j.resolve(b===w?"":b)});i&&j.done(function(b){var d=v.$(i);d&&(d.innerHTML=b)});return j.promise().done(d)};"undefined"!=typeof jQuery&&(jQuery.tpl=function(e){AsyncTpl.engine(e);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(e,i){jQuery.tpl("XML").fetch(e,this[0],i);return this})})(this);
