(function(G,x){function o(b,j){C[b.replace(D,"")]=j}function p(b){return C[b.replace(D,"")]}var D=/^.+\//,C={};o("fs",{readFile:function(b,j,l){jQuery.ajax({url:b,type:"get",dataType:"text",isLocal:!0,success:function(b){l(null,b)}})},readFileSync:function(b){return jQuery.ajax({url:b,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(){function b(e,d,c,h){if(!(this instanceof b))return new b(e,d,c,h);if("number"===typeof e)switch(h=c,
c=d,d=e,d){case b.TEXT_NODE:e="<text>";break;case b.CDATA_NODE:e="<cdata>";break;case b.COMMENT_NODE:e="<comment>";break;case b.CUSTOM_NODE:e="<custom>"}else e=e.toLowerCase(),e.match(j)&&(this.ns=RegExp.$1,e=RegExp.$2);this.name=e;this.type=d;this.value=c;this.attributes=h||[];this.childNodes=[]}var j=/(\w+):(\w+)/,l={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21},d={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,
link:!0,meta:!0,param:!0,source:!0,wbr:!0};b.prototype={constructor:b,attr:function(e,b){if(this.attributes[e])return this.attributes[e].value;throw Error("At line "+this.__line+': tag "'+this.name+'", attribute "'+(b||e)+'" is missing');},replace:function(b){this.name=b.name;this.type=b.type;this.value=b.value;this.attributes=b.attributes;return this},addTextNode:function(e){return this.addChild(b.TEXT_NODE,e)},addChild:function(e,d,c,h){e instanceof b||(e=b(e,d,c,h));this.childNodes.push(e);return this},
addChilds:function(b){this.childNodes.push.apply(this.childNodes,b);return this},hasChildNodes:function(){return!!this.childNodes.length},isShort:function(){return!0===d[this.name]}};for(var h in l)b[h]=b.prototype[h]=l[h];"undefined"!==typeof o?o("./Node",b):module.exports=b})();(function(b,j){function l(a){return g[a]}function d(a){if(!(this instanceof d))return new d(a);var f=[],k=[],b,c,g=!0,e=!0,m=!1;this.done=function(a){g&&a!==j&&(m?a(c):f.push(a));return this}.bind(this);this.fail=function(a){e&&
a!==j&&(m?a(c):k.push(a));return this}.bind(this);this.then=function(a,f){return this.done(a).fail(f)}.bind(this);this.reject=function(a){g=!1;m=!0;for(c=a;k.length;)k.shift()(a);return this}.bind(this);this.resolve=function(a){e=!1;m=!0;for(c=a;f.length;)f.shift()(a);return this}.bind(this);this.promise=function(){b===j&&(b={done:this.done,fail:this.fail,then:this.then,promise:this.promise});return b}.bind(this);a!==j&&a(this)}var h=Object.prototype.toString,e=String.prototype.trim,i=/^#/,c=[].slice,
n=/^\s+/,a=/\s+$/,k=/[&<>"]/g,m=/'/g,g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},f="undefined"!==typeof console&&console,q={$:function(a){return"string"==typeof a?document.getElementById(a.replace(i,"")):a},sizeof:function(a){var f=0;if(a&&(q.isArray(a)||"object"==typeof a))"length"in a?f=a.length:q.each(a,function(){f++});return f},isArray:function(a){return"[object Array]"==h.call(a)},uniqId:function(){return(new Date).getTime()+""+Math.round(1E3*Math.random())},escape:function(a){return"string"===
typeof a&&k.test(a)?a.replace(k,l):a},addslashes:function(a){return a.replace(m,"\\'")},log:f&&"object"==typeof f.log?Function.prototype.call.bind(f.log,f):function(){f&&f.log.apply(f,arguments)},error:function(a,f,k){this.log((f?"Error in "+k+"\nAt line "+f+": ":"")+a.toString())},keys:function(a){var f=[];Object.keys?f=Object.keys(a):q.each(a,function(a){f.push(a)});return f},each:function(a,f,k){if(a)if(a.forEach)a.forEach(f,k);else if("length"in a&&0 in a)for(var b=0,c=a.length;b<c;b++)b in a&&
f.call(k,a[b],b,a);else for(b in a)a.hasOwnProperty(b)&&f.call(k,a[b],b,a)},cycle:function(a,f,b){for(;a<=f;a++)b(a)},trim:e?function(a){return e.call(a)}:function(f){return(""+f).replace(n,"").replace(a,"")},extend:function(a){a=a||{};this.each(arguments,function(f,b){0<b&&this.each(f,function(f,b){a[b]=f})},this);return a},indexOf:function(a,f){if(a.indexOf)return a.indexOf(f);for(var b=0,k=a.length;b<k;b++)if(a[b]===f)return b;return-1},inherit:function(a,f,b,k){if(2===arguments.length){var c=
function(){};c.prototype=f.prototype;a.prototype=new c;a.prototype.self=a;a.prototype.constructor=a;q.each(f,function(f,b){a[b]=f})}else return f.prototype[b].apply(a,k)},defer:d,load:function(a,f,k,c){var g=this.defer();f?b.readFile(a,k||"utf-8",function(a,f){g[a?"reject":"resolve"](a||f)}):g.resolve(p("fs").readFileSync(a,k||"utf-8"));return g.done(c).promise()},mtime:function(a){return b?+Date.parse(b.lstatSync(a).mtime):0},writeFile:function(a,f,k){b&&b.writeFileSync(a,f,k)},getJSON:function(a,
f,k){var c=q.defer();if(b)try{c.resolve(JSON.parse(b.readFileSync(a,f)))}catch(g){c.reject()}return c.fail(function(){k(!0)}).done(function(a){k(!1,a)}).promise()}};d.prototype={constructor:d};d.when=function(a){var f=d(),b=[];a instanceof d?b.push.apply(b,arguments):b=a;var k=0,c=b.length,g=function(){++k==c&&f.resolve()};q.each(b,function(a){a.done(g)});c||f.resolve();return f.promise()};Function.prototype.bind===j&&(Function.prototype.bind=function(a){var f=c.call(arguments,1),b=this;return function(){return b.apply(a,
f.concat(c.call(arguments,0)))}});"undefined"!==typeof o?o("./utils",q):module.exports=q})(p("fs"));(function(b,j,l){function d(a,b){this._file=b;this._opts=j.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},a);this._opts.tags&&(this._opts.tags=" "+this._opts.tags+" ")}function h(a){var b=(a+"").split(""),c=0,g={};this.pos=function(){for(var a=c;a--&&!("\n"==b[a]););return c-a+1};this.line=function(){for(var a=1,g=c;g--;)"\n"==b[g]&&a++;return a};this.peek=function(a){return b[c+
(a||0)]};this.lex=function(a){return b.slice(c,c+a).join("")};this.match=function(a){var b=this.lex(a.length)===a;this.lastMatch=b?a:null;this.lastMatchLength=b?a.length:0;return b};this.next=function(a){"string"===typeof a&&(a=a.length);c+=a||1;return this};this.save=function(a){g[a]=c;return this};this.load=function(a){c=g[a];return this};this.length=function(){return b.length-c};this.getStr=function(){for(var a,b="",c=this.peek(),k=1;a=this.peek();)if(this.next(),b+=a,"\\"==a)k++;else{if(c==a&&
!(k%2))return b.substring(1,b.length-1);k=0}};this.substr=function(a,g){return b.slice(a,g||c).join("")};this.extract=function(a,b){this.save("extract");b!==l&&this.next(b);for(var c="",k;k=this.peek();){if(this.match(a))return this.next(a),c;c+=k;this.next()}this.load("extract");return null}}var e=/['"]/,i=/^[\s\r\n\t]+$/,c=/^([$a-z][\da-z\s:>]|\/\w)$/i,n=/[a-z\d:]/i;d.prototype={constructor:d,parse:function(a){var k,d="",g=[],f,q=this._opts,H=q.tags,B=q.left,o=q.right,p=q.c_open,v=q.c_close,E=B.length,
F=0;!q.firstLine&&/^\s*<\?xml/.test(a)&&(a=j.trim(a.replace(/^[^\n]+\n/,"")),F=1);a=new h(a);a:for(;k=a.peek();){if(a.match(p))k=a.extract(v,a.lastMatchLength),null!==k&&g.push(b(b.COMMENT_NODE,k));else if(a.match("<![CDATA["))k=a.extract("]]\>",a.lastMatchLength),null!==k&&g.push(b(b.CDATA_NODE,k));else if(a.match(B))if(c.test(a.peek(E)+a.peek(E+1))){k="/"==a.next(B).peek()?(a.next(),!0):!1;f=a;var y=H,A=o,s,z=f;s=void 0;for(var r="";s=z.peek();)if(n.test(s))r+=s,z.next();else break;s=r;var r=void 0,
x=z=!1,w={},t="",u=void 0;if(f.length()){f.save("attrs");y=!y||-1<y.indexOf(" "+s+" ");c:for(;r=f.peek();)if(y&&n.test(r))for(t="";r=f.peek();)if(f.match(A)||i.test(r)){w[t]={name:t,value:l};continue c}else if("="==r){if(e.test(f.peek(1)))u=f.next().getStr();else{for(u="";(r=f.next().peek())&&!i.test(r)&&!f.match(A);)u+=r;u=""==u?l:u}w[t]=b(t,b.ATTRIBUTE_NODE,u);continue c}else t+=r,f.next();else if(f.match(A)){x=!0;z="/"==f.peek(-1);f.next(A);break}else y||(t+=r),f.next();x?(f=y?b(s,b.ELEMENT_NODE,
"",w):b(s,b.ELEMENT_NODE,"",t),f.__close=z):(f.load("attrs"),f=b(b.TEXT_NODE,s))}else f=b(b.TEXT_NODE,s);q.trim&&i.test(d)||""!=d&&g.push(b(b.TEXT_NODE,d));d="";f.type!=b.TEXT_NODE&&(f.__open=!k,f.__close=f.__close||k,f.__empty=f.__open&&f.__close);g.push(f)}else{d+=k;a.next();continue a}else d+=k,a.next();0==a.length()&&""!=d&&g.push(b(b.TEXT_NODE,d));if(g.length&&(f=g[g.length-1],!f.__line&&(!f.__close||f.__empty)))f.__line=a.line()+F,f.__file=this._file}return g},build:function(a){for(var c=[],
d,g,f=this.left,e=this.right;g=a.shift();){switch(g.type){case b.TEXT_NODE:case b.CDATA_NODE:d=g.value;break;case b.ELEMENT_NODE:d=f+(!g.__empty&&g.__close?"/":"")+g.name;j.each(g.attributes,function(a){d+=" "+a.name+(a.value!==l?'="'+a.value+'"':"")});d+=(g.__empty?" /":"")+e;break;case b.CUSTOM_NODE:d=f+(g.__close?"/":"")+g.name+g.value+e}""!=d&&(c.push(d),d="")}return c.join("")},rebuild:function(a){return this.build(this.parse(a))}};"undefined"!==typeof o?o("./Parser",d):module.exports=d})(p("./Node"),
p("./utils"));(function(b){function j(b){this._opts=b||{useWith:!1}}j.prototype={constructor:j,compile:function(j){function d(){var c="",d=0,a=e.length,k,m;if(a){for(;d<a;d++){m=typeof e[d];if(k!=m||"string"!=m)k&&(c+="string"==k?"',":","),c+="string"==m?"'":"";c+="string"==m?b.addslashes(e[d]):e[d][0];k=m}"string"==m&&(c+="'");h.push("__buf.w("+c.replace(/\r/g,"").replace(/\n/g,"\\n")+");");e=[]}}for(var h=["",""],e=[],i;i=j.shift();)i.__break?(d(),h.push(i.value)):"value"==i.name?i.__escape?(d(),
h.push(" try{__buf.v("+i.value+")}catch(e){} ")):e.push([i.value]):"string"==typeof i||i.type==i.TEXT_NODE||i.type==i.CDATA_NODE?e.push(i.value||i):(d(),h.push(i.value));d();this._opts.useWith?(h[0]="with( ctx ){ ",h.push(" } ")):h[0]="'use strict';/*global __buf*/";h[1]="var undef;if(ctx.__part!==undef)__buf.off();";h=h.join("")+" __buf.end();";return new Function("ctx, __buf, __utils",h)}};"undefined"!==typeof o?o("./Compiler",j):module.exports=j})(p("./utils"));(function(b,j){function l(b,h){this._data=
"";this._pullLen=0;this._active=!0;this._stream=h;this._callback=b}l.prototype={constructor:l,on:function(){this._active=!0},off:function(){this._active=!1},v:function(d){this._active&&d!==j&&(this._data+=b.escape(d));return this},w:function(b){if(this._active)if(1<arguments.length){var h="",e=arguments.length,i=0;switch(e){case 9:h=arguments[8]+h;case 8:h=arguments[7]+h;case 7:h=arguments[6]+h;case 6:h=arguments[5]+h;case 5:h=arguments[4]+h;case 4:h=arguments[3]+h;case 3:h=arguments[2]+h;case 2:this._data+=
arguments[0]+arguments[1]+h;break;default:for(e=arguments.length;i<e;)this._data+=arguments[i++]}}else this._data+=b;return this},cycle:function(){this._active&&b.cycle.apply(b,arguments)},each:function(){this._active&&b.each.apply(b,arguments)},block:function(b,h,e){this.w(this.getBlock(b,h,e))},blockLabel:function(b,h,e){this._active&&(e!==j&&this.setBlock(b,e,!0),this._blocks===j&&(this._chunks=[],this._blocks=[],this._attrs=[]),b=this._chunks.push(this._data,b)-1,this._blocks.push(b),h!==j&&(this._attrs[b]=
h),this._data="")},setBlock:function(b,h,e){this._block===j&&(this._block={});if(!0!==e||this._block[b]===j)this._block[b]=h},getBlock:function(b,h,e){this._block[b]!==j&&(e=this._block[b]);return e!==j?(b=new l,b._block=this._block,e(b,h),b.toStr()):""},pullSync:function(b,h,e){this.pull(b,h,e)},pull:function(d,h,e){this._pull===j&&(this._pull={});if(this._pull[h]===j){var i=b.defer(),c=function(){this._pullLen--;setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[h]=i.then(c,
c);try{d[h](function(a,b){i[a?"reject":"resolve"](a||b)})}catch(n){i.reject(!0)}}e!==j&&this._pull[h].then(function(a){e(null,a)},function(a){e(a)});return this._pull[h].promise()},end:function(){this._stream&&(this._callback(this._data),this._data="");if(0===this._pullLen){if(this._blocks!==j){for(var b=this._blocks,h=this._chunks,e=this._attrs,i=h.length,c=b.length,n;c--;)n=b[c],h[n]=this.getBlock(h[n],e[n]);b=h[--i];for(c=i;c--;)b=h[c]+b;this._data=b+this._data}this._callback(this._data);this._stream&&
this._callback(null)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof o?o("./Buffer",l):module.exports=l})(p("./utils"));(function(b,j,l,d,h){function e(a,b){this.__lego(a,b)}var i={},c={},n={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',
transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'};e.fn=e.prototype={self:e,constructor:e,__lego:function(a,b){"string"!=typeof a&&(b=a,a=h);this._opts=this._defaults(b||{});this._data={};this._files={};this._listeners={};this._string=h;this._filename=a},_defaults:function(a){return b.extend({ns:this.self.NS,
left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,rootDir:this.self.ROOT_DIR,compileDir:this.self.COMPILE_DIR,async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING,blockMode:this.self.BLOCK_MODE,debug:this.self.DEBUG},a)},_uniqKey:function(a){var b=this._opts;return b.left+b.right+b.trim+b.stream+a},_compile:function(a,c){var e=a===h?Math.random():this._uniqKey(a);
if(i[e]!==h)i[e].done(function(a){this._tpl=a}.bind(this));else if(!this._tpl&&(a===h||i[e]===h)){var g=b.defer(),f={};i[e]=g.promise();this._load(a,function(b){b?(this._tpl=b,g.resolve(this._tpl)):(this._compiler||(this._compiler=new l(this._opts)),this._parse(this._opts.rootDir+a,f,function(b){this._tpl=this._compiler.compile(b);this._save(a,f);g.resolve(this._tpl)}.bind(this),f))}.bind(this))}i[e].done(c)},_parse:function(a,c,e){this._parser===h&&(this._parser=new j(this._opts,a));var g=this._opts,
f=b.defer(),d=[],i=function(g){var e=[],m,i=a.replace(/\/[\s%|\w\._-]+$/,"/"),j,g=this._parser.parse(g);try{for(;m=g.shift();)this._prepare(m,g,d),m.prev=this.__node,j=this._trans(m,g,d),this.__node=m,null!==j&&m.type!=m.COMMENT_NODE&&d.push(j),"include"==m.name&&e.push(this._parse(i+m.value,c).done(function(a,b){d[a-1]=b}.bind(this,d.length)))}catch(n){e=[],d=[m.__file+"\n"+n.message]}this.__node=h;b.defer.when(e).done(function(){f.resolve(this._normalizeStack(d))}.bind(this))}.bind(this);this._string!==
h?i(this._string||"[[undefined]]"):(c[a]||(c[a]=b.mtime(a)),this.self.load(a,g.async,g.encoding,i));return f.done(e).promise()},_normalizeStack:function(a){for(var b=[],c;c=a.shift();)"string"!=typeof c&&c[0]?a=c.concat(a):b.push(c);return b},_save:function(a,c){this._opts.compileDir&&b.writeFile(this._opts.compileDir+a+".json",JSON.stringify({includes:c,template:this._tpl.toString()}),this._opts.encoding)},_load:function(a,c){var e=this._opts,g=!0,f=b.defer();e.compileDir?b.getJSON(e.compileDir+
a+".json",e.encoding,function(a,c){a?f.resolve(!1):(b.each(c.includes,function(a,c){b.mtime(c)!=a&&(g=!1)}),f.resolve(g&&(new Function("return "+c.template))()))}):f.resolve(!1);return f.done(c).promise()},_try:function(a,b,c){b||(a&&a.__line?(b=a,a=a.value):b={});return"try{"+a+"}catch(_){"+(this._opts.debug?"__utils.error(_,"+b.__line+',"'+b.__file+'");':"")+(c!==h?"return "+c:"")+"}"},_prepare:function(a,b){var c=b[0]&&b[0].name;if("attrs"==c||"attributes"==c)a.__openTag=!0},_trans:function(a,
c){var e=[],g,f=a.attributes;if(this._opts.ns==a.ns||!a.ns)switch(a.name){case "script":g=" "+this._try(c.shift())+" ";c.shift();break;case "if":g=a.__close?"}":"if("+this.safe(a.value,a)+"){";break;case "else":g="}"+a.name+"{";break;case "elseif":case "else if":g="}else if("+this.safe(a.value,a)+"){";break;case "for":case "cycle":case "foreach":a.__break=!0;a.__close?a.value="});":(g="",f.to?g="__buf.cycle("+a.attr("from")+", "+a.attr("to")+", function ("+(f.key||f.item||{value:""}).value+"){":(f.item&&
(g=f.item.value),f.key&&(g+=(""==g?"__v,":",")+f.key.value),g="__buf.each("+this.safe(a.attr("from",f._from),a)+", function ("+g+"){"));break;case "pull":if(a.__close)g="__buf.w('</span>');";else{var d={id:b.uniqId(),name:a.attr("name"),as:f.as&&a.attr("value")||a.attr("name"),async:!!f.async,error:f.error&&a.attr("error")||"err"};this._pullStack||(this._pullStack=[]);this._pullStack.push(d);g="__buf.w('<span id=\""+d.id+"\">');";f.async?g+='__buf.pull(ctx,"'+d.name+'");':(g+='__buf.pullSync(ctx,"'+
d.name+'",function('+d.error+","+d.as+"){",c.push({value:"});",type:a.ELEMENT_NODE}))}break;case "assign":g=" ctx['"+b.addslashes(a.attr("value"))+"']=";g=f.type&&"string"!=f.type?g+a.attr("value"):g+("'"+b.addslashes(a.attr("value"))+"';");break;case "get":var d=[],i,j;if(f.attrs)j=f.attrs.value;else for(i in f)"name"!=i&&"attrs-name"!=i&&d.push(this._try("a."+i+"="+a.attr(i),a));a.__empty?g='__buf.#method#("'+a.attr("name")+'",#attrs#);':a.__close?g="});":1==this._opts.blockMode?g='__buf.#method#("'+
a.attr("name")+'",#attrs#,function (__buf,'+(f["attrs-name"]&&f["attrs-name"].value||"attrs")+"){":(g='__buf.#method#("'+a.attr("name")+'",#attrs#)',j=c.shift().value,c.shift());j?(d.length&&console.log("WARNING: Can't use block attributes at block mode == 2"),d=this.safe(j,a)):d=d.length?"(function(a){"+d.join("")+" return a})({})":"undef";g=g.replace("#attrs#",d).replace("#method#",this._opts.stream||this.blockLevel?"block":"blockLabel");break;case "set":if("set"==c[0].name&&c[0].__close)return c.shift(),
null;this.blockLevel=(this.blockLevel|0)+(a.__close?-1:1);a.__close?g="});":(g="",f.test&&(g+="if("+this.safe(a.attr("test"),a)+")"),g+='__buf.setBlock("'+a.attr("name")+'",function(__buf,'+(f["attrs-name"]&&a.attr("attrs-name")||"attrs")+"){");break;case "fail":case "loading":case "success":d=this._pullStack[this._pullStack.length-1];if("loading"==a.name)return null;g=a.__close?"}":"if("+("fail"==a.name?"":"!")+d.error+"){";d.async&&(g=a.__close?g+('__buf.w(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,
d.id).replace("%name",a.name)+"'); });"):'__buf.pull(ctx,"'+d.name+'",function('+d.error+","+d.as+"){__buf.w('<span id=\""+a.name+d.id+'" style="display: none">\');'+g);break;case "part":a.__close?g='if(ctx.__part=="'+this.__parts.pop()+'")__buf.off();':(g='if(ctx.__part=="'+a.attr("name")+'")__buf.on();',this.__parts||(this.__parts=[]),this.__parts.push(a.attr("name")));break;case "space":a.type=a.TEXT_NODE;g=" ";break;case "text":a.type=a.TEXT_NODE;f.value?g=a.attr("value"):(g=c.shift().value,c.shift());
break;case "attrs":case "attributes":if(a.__close)g="",a.type=a.TEXT_NODE,c[0].__close&&!c[0].__empty&&c[0].isShort()&&(c.shift(),g+="/"),g+=this._opts.right;else{if(!a.prev||a.prev.type!=a.ELEMENT_NODE||a.prev.__close)throw Error("At line "+a.__line+": <"+this._opts.ns+":"+a.name+"/> must be the first child");return null}break;case "attr":case "attribute":a.type=a.TEXT_NODE;g=a.__close?'"':" "+a.attr("name")+'="';break;case "closure":if(a.__close)g="})("+this.__closure.shift().join(",")+");";else{d=
[];j=[];g="(function(";this.__closure=this.__closure||[];for(i in f)j.push(i),d.push(this.safe(a.attr(i),a));g+=j.join(",")+"){";this.__closure.push(d)}break;default:g=this._myNode(a.name,a,f),g!==h&&(a.type=a.TEXT_NODE,b.isArray(g)&&(e=g,g=h))}g!==h&&(a.value=g);return e.length?e:a},_myNode:function(a,b,d){if(c[a])return c[a].call(this,b,d);if(c._)return c._.call(this,b,d)},fetch:function(a,c){c===h&&(c=a,a=h);this._tpl===h?this._compile(this._filename,this.fetch.bind(this,a,c)):this._tpl(a||{},
new d(c,this._opts.stream),b)},loadString:function(a){this._string=b.trim(a);this._compile();return this},on:function(a,b){this._listeners[a]=b;return this},set:function(a,b){"string"==typeof a?this._data[a]=b:this._data=a||{};return this},safe:function(a,b,c){if(!b||!b.__line)c=b,b=h;return this._opts.safeMode?"(function(){"+this._try("return "+a,b,'""')+"})"+(c?"":"()"):a},escape:function(a,b){return this._opts.escape?"__utils.escape("+this.safe(a,b)+")":this.safe(a,b)}};e._files={};e.load=function(a,
c,d,g){return(this._files[a]||(this._files[a]=b.load(a,c,d))).done(g)};e.NS="xtpl";e.LEFT="<";e.RIGHT=">";e.C_OPEN="<\!--";e.C_CLOSE="--\>";e.TRIM=!0;e.ASYNC=!0;e.STREAM=!1;e.ESCAPE=!0;e.SAFE_MODE=!0;e.ENCODING="utf-8";e.BLOCK_MODE=1;e.DEBUG=!0;e.ROOT_DIR="";e.COMPILE_DIR="";e.fetch=function(a,c,d){var g=new this(a),f=b.defer(),e="";g.fetch(c,function(a){null===a||!g._opts.stream?f.resolve(g._opts.stream?e:a):e+=a});d&&f.done(d);return f.promise()};e.fromString=function(a,b){return(new this(b)).loadString(a)};
e.tags=function(a){b.each(a,function(a,b){c[b]=a});return this};e.tags({doctype:function(a,b){return n[b.mode&&b.mode.value]||n.def}});e.engine=function(a){"string"==typeof a&&(a=p("./"+a));var c=this.fn;c._super={};b.each(a.statics,function(a,b){this[b]=a},this);b.each(a.fn,function(a,b){var f=c[b];f&&(c._super[b]=f);c[b]=a});return e};"undefined"!==typeof o?o("./AsyncTpl",e):module.exports=e})(p("./utils"),p("./Parser"),p("./Compiler"),p("./Buffer"));(function(b,j){var l={fn:{_defaults:function(d){return this._super._defaults.call(this,
b.extend(d||{},{firstLine:!1}))},_build:function(d,h){var e=[];"string"==typeof d&&(d={name:"a"});if(!d.__empty&&d.__close)e.push("</"+d.name+">");else{e.push("<"+d.name);var i=RegExp(this._opts.ns+":");b.each(h,function(b){i.test(b.value)?e.push(" "+b.name+'="',{name:"value",value:b.value.replace(i,""),__escape:!0},'"'):e.push(" "+b.name+'="'+b.value+'"')},this);d.__openTag||e.push(d.__empty?"/>":">")}return e},_trans:function(d,h,e){var i=[],c,n=d.attributes;if(d.ns!=this._opts.ns)d.type==d.ELEMENT_NODE&&
(i=this._build(d,n));else switch(d.name){case "if":c=d.__close?"":d.attr("test");break;case "choose":this.__choose=d.__open?1:0;break;case "when":c=d.__close?"}":(1==this.__choose?"":" else ")+"if("+this.safe(d.attr("test"),d)+"){";this.__choose++;break;case "otherwise":c=d.__close?"}":" else {";break;case "foreach":n={_from:"iterate",from:n.iterate||n.from,key:n.index,item:n.as,to:n.to};break;case "value":c=this.escape(h.shift().value,d);h.shift();break;case "include":c=d.attr("src");break;case "comment":d.type=
d.TEXT_NODE;d.__empty?c="":(c="<\!--"+h.shift().value+"--\>",h.shift());break;case "template":return null}c!==j&&(b.isArray(c)?i=c:d.value=c);d.attributes=n;return i.length?i:this._super._trans.call(this,d,h,e)}}};"undefined"!==typeof o?o("./XML",l):module.exports=l})(p("./utils"));(function(b,j){var l=/\r/g,d=/\n/g,h=/^\/(.+)\/(\w*)$/,e="foreach include extends block doctype",i={fn:{_defaults:function(c){c=b.extend({left:"{{",right:"}}"},c,{tags:e});c.c_open=c.left+"*";c.c_close="*"+c.right;return this._super._defaults.call(this,
c)},_trans:function(c,d){var a=[],e,h=c.attributes;if(c.type==c.ELEMENT_NODE||c.type==c.CUSTOM_NODE)switch(c.name){case "if":case "else":case "elseif":e=h;break;case "script":case "cycle":break;case "foreach":c.__break=!0;this.__foreach||(this.__foreach=[],this.__foreachelse=[]);if(c.__open)this.__foreach.push(h.from.value);else if(this.__foreachelse.length)return this.__foreachelse=[],c.value="}",c;break;case "foreachelse":h=this.__foreach.pop();this.__foreachelse.push(h);e="}); if(!__utils.sizeof("+
this.safe(h,c)+")){";break;case "block":h=c.attr("name");this.__blocks||(this.__blocks={},this.___blocks=[]);h?(this.___blocks.push(h),this.__blocks[h]=1+this.__blocks[h]||0):h=this.___blocks.shift();c.name=0<this.__blocks[h]?"set":"get";break;case "extends":case "include":c.name="include";e=h.file.value;break;default:if(this.fns[c.name]){var g=[];b.each(h,function(a,b,d){d=a.value;d=/$\$/.test(d)?this.safe(d,c):'"'+d+'"';g.push(b+":"+d)});c.value="__this.fns."+c.name+"({"+g.join(",")+"},ctx)";c.name=
"value";return c}e=this.escape(c.name+h,c);c.name="value"}e!==j&&(c.value=e);return a.length?a:this._super._trans.call(this,c,d)},escape:function(c){var d=c.split("|"),c=this._super.escape.call(this,this.safe(d[0]));b.each(d.splice(1),function(a){a=a.split(":");c="__this.mods."+a[0]+"("+c+(1<a.length?","+a.splice(1).join(","):"")+")"});return c},safe:function(b){return this._super.safe.call(this,b.replace(/\$([a-z][a-z0-9_]*)/ig,function(b,a){return"(typeof "+a+'==="undefined"?ctx.'+a+":"+a+")"}))}},
statics:{fn:function(c){b.each(c,function(b,a){e+=" "+a;this.fns[a]=b},this);return this},modifiers:function(c){b.each(c,function(b,a){this.mods[a]=function(){return b.apply(this,arguments)}},this);return this}}};i.fn.fns=i.statics.fns={};i.fn.mods=i.statics.mods={};i.statics.fn({assign:function(b,d){d[b["var"]]=b.value;return""}}).modifiers({upper:function(b){return b.toUpperCase()},lower:function(b){return b.toLowerCase()},capitalize:function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()},
nl2br:function(b){return b.replace(l,"").replace(d,"<br/>")},regexp_replace:function(b,d,a){d=d.match(h);return b.replace(RegExp(d[1],d[2]),a)}});"undefined"!==typeof o?o("./Smarty",i):module.exports=i})(p("./utils"));G.AsyncTpl=p("AsyncTpl");var v={},w=p("utils");AsyncTpl.fetch=function(b,j,l,d){"string"!=typeof j&&(d=l,l=j,j=x);if(v[b]===x)if("#"==b.charAt(0)){var h=w.$(b)||{innerHTML:"[[#"+b+" \u2014 not found]]"};v[b]=new this;v[b].loadString(h.innerHTML)}else v[b]=new this(b);var e=w.defer();
v[b].fetch(l,function(b){e.resolve(b===x?"":b)});j&&e.done(function(b){var c=w.$(j);c&&(c.innerHTML=b)});return e.promise().done(d)};"undefined"!=typeof jQuery&&(jQuery.tpl=function(b){AsyncTpl.engine(b);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(b,j){jQuery.tpl("XML").fetch(b,this[0],j);return this})})(this);
