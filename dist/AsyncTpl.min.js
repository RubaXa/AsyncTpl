/*
 AsyncTpl â€” Asynchronous Templating engine for NodeJS/Browser

 Copyright (c) 2011, Lebedev Konstantin
 Released under the MIT License.
*/
(function(E,w){function n(a,k){B[a.replace(C,"")]=k}function o(a){return B[a.replace(C,"")]}var C=/^.+\//,B={};n("fs",{readFile:function(a,k,l){jQuery.ajax({url:a,type:"get",dataType:"text",isLocal:!0,success:function(a){l(null,a)}})},readFileSync:function(a){return jQuery.ajax({url:a,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(){function a(h,g,f,d){if(!(this instanceof a))return new a(h,g,f,d);if("number"===typeof h)switch(d=f,
f=g,g=h,g){case a.TEXT_NODE:h="<text>";break;case a.CDATA_NODE:h="<cdata>";break;case a.COMMENT_NODE:h="<comment>";break;case a.CUSTOM_NODE:h="<custom>"}else if(h=h.toLowerCase(),h.match(k))this.ns=RegExp.$1,h=RegExp.$2;this.name=h;this.type=g;this.value=f;this.attributes=d||[];this.childNodes=[]}var k=/(\w+):(\w+)/,l={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21};a.prototype={constructor:a,replace:function(a){this.name=a.name;this.type=a.type;
this.value=a.value;this.attributes=a.attributes;return this},addTextNode:function(h){return this.addChild(a.TEXT_NODE,h)},addChild:function(h,f,j,d){h instanceof a||(h=a(h,f,j,d));this.childNodes.push(h);return this},addChilds:function(a){this.childNodes.push.apply(this.childNodes,a);return this},hasChildNodes:function(){return!!this.childNodes.length}};for(var f in l)a[f]=a.prototype[f]=l[f];"undefined"!==typeof n?n("./Node",a):module.exports=a})();(function(a,k){function l(c){if(!(this instanceof
l))return new l(c);var b=[],i=[],a,e,d=!0,h=!0,f=!1;this.done=function(c){d&&c!==k&&(f?c(e):b.push(c));return this}.bind(this);this.fail=function(c){h&&c!==k&&(f?c(e):i.push(c));return this}.bind(this);this.then=function(c,b){return this.done(c).fail(b)}.bind(this);this.reject=function(c){d=!1;f=!0;for(e=c;i.length;)i.shift()(c);return this}.bind(this);this.resolve=function(c){h=!1;f=!0;for(e=c;b.length;)b.shift()(c);return this}.bind(this);this.promise=function(){a===k&&(a={done:this.done,fail:this.fail,
then:this.then,promise:this.promise});return a}.bind(this);c!==k&&c(this)}var f=String.prototype.trim,h=/^#/,g=[].slice,j=/^\s+/,d=/\s+$/,b=/[&<>"]/,i=/[&<>"]/g,G=/'/g,e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},q={$:function(c){return"string"==typeof c?document.getElementById(c.replace(h,"")):c},sizeof:function(c){var b=0,i;if(c&&("object"==typeof c||"object"==typeof c))if("length"in c)b=c.length;else for(i in c)b++;return b},uniqId:function(){return(new Date).getTime()+""+Math.round(1E3*
Math.random())},escape:function(c){return"string"===typeof c&&b.test(c)?c.replace(i,function(c){return e[c]}):c},addslashes:function(c){return c.replace(G,"\\'")},keys:function(c){var b=[];Object.keys?b=Object.keys(c):q.each(c,function(c){b.push(c)});return b},each:function(c,b,i){if(c)if(c.forEach)c.forEach(b,i);else if("length"in c&&0 in c)for(var a=0,e=c.length;a<e;a++)a in c&&b.call(i,c[a],a,c);else for(a in c)c.hasOwnProperty(a)&&b.call(i,c[a],a,c)},cycle:function(c,b,a){for(;c<b;c++)a()},trim:f?
function(c){return f.call(c)}:function(c){return(""+c).replace(j,"").replace(d,"")},extend:function(c){c=c||{};this.each(arguments,function(b,a){0<a&&this.each(b,function(b,a){c[a]=b})},this);return c},indexOf:function(c,b){if(c.indexOf)return c.indexOf(b);for(var a=0,i=c.length;a<i;a++)if(c[a]===b)return a;return-1},inherit:function(c,b,a,i){if(2===arguments.length){var e=function(){};e.prototype=b.prototype;c.prototype=new e;c.prototype.self=c;c.prototype.constructor=c;q.each(b,function(b,a){c[a]=
b})}else return b.prototype[a].apply(c,i)},defer:l,load:function(c,b,i,e){var d=this.defer();b?a.readFile(c,i||"utf-8",function(c,b){d[c?"reject":"resolve"](c||b)}):d.resolve(o("fs").readFileSync(c,i||"utf-8"));return d.done(e).promise()},mtime:function(c){return a?+Date.parse(a.lstatSync(c).mtime):0},writeFile:function(c,b,i){a&&a.writeFileSync(c,b,i)},getJSON:function(c,b,i){var e=q.defer();if(a)try{e.resolve(JSON.parse(a.readFileSync(c,b)))}catch(d){e.reject()}return e.fail(function(){i(!0)}).done(function(c){i(!1,
c)}).promise()}};l.prototype={constructor:l};l.when=function(c){var b=l(),a=[];c instanceof l?a.push.apply(a,arguments):a=c;var i=0,e=a.length,d=function(){++i==e&&b.resolve()};q.each(a,function(c){c.done(d)});e||b.resolve();return b.promise()};if(Function.prototype.bind===k)Function.prototype.bind=function(c){var b=g.call(arguments,1),a=this;return function(){return a.apply(c,b.concat(g.call(arguments,0)))}};"undefined"!==typeof n?n("./utils",q):module.exports=q})(o("fs"));(function(a,k,l){function f(b){this._opts=
k.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},b);if(this._opts.tags)this._opts.tags=" "+this._opts.tags+" "}function h(b){var a=(b+"").split(""),e=0,d={};this.peek=function(b){return a[e+(b||0)]};this.lex=function(b){return a.slice(e,e+b).join("")};this.match=function(b){var a=this.lex(b.length)===b;this.lastMatch=a?b:null;this.lastMatchLength=a?b.length:0;return a};this.next=function(b){if("string"===typeof b)b=b.length;e+=b||1;return this};this.save=function(b){d[b]=
e;return this};this.load=function(b){e=d[b];return this};this.length=function(){return a.length-e};this.getStr=function(){for(var b,a="",i=this.peek(),e=1;b=this.peek();)if(this.next(),a+=b,"\\"==b)e++;else{if(i==b&&!(e%2))return a.substring(1,a.length-1);e=0}};this.extract=function(b,a){this.save("extract");a!==l&&this.next(a);for(var i="",e;e=this.peek();){if(this.match(b))return this.next(b),i;i+=e;this.next()}this.load("extract");return null}}var g=/['"]/,j=/^[\s\r\n\t]+$/,d=/^([$a-z][\da-z\s:>]|\/\w)$/i,
b=/[a-z\d:]/i;f.prototype={constructor:f,parse:function(i){var f,e="",q=[],c=this._opts,n=c.tags,A=c.left,o=c.right,F=c.c_open,u=c.c_close,D=A.length;!c.firstLine&&/^\s*<\?xml/.test(i)&&(i=k.trim(i.replace(/^[^\n]+\n/,"")));i=new h(i);a:for(;f=i.peek();){if(i.match(F))f=i.extract(u,i.lastMatchLength),null!==f&&q.push(a(a.COMMENT_NODE,f));else if(i.match("<![CDATA["))f=i.extract("]]\>",i.lastMatchLength),null!==f&&q.push(a(a.CDATA_NODE,f));else if(i.match(A))if(d.test(i.peek(D)+i.peek(D+1))){f="/"==
i.next(A).peek()?(i.next(),!0):!1;var m;m=i;var x=n,z=o,r,y=m;r=void 0;for(var p="";r=y.peek();)if(b.test(r))p+=r,y.next();else break;r=p;var p=void 0,w=y=!1,v={},s="",t=void 0;if(m.length()){m.save("attrs");x=!x||-1<x.indexOf(" "+r+" ");c:for(;p=m.peek();)if(x&&b.test(p))for(s="";p=m.peek();)if(m.match(z)||j.test(p)){v[s]={name:s,value:l};continue c}else if("="==p){if(g.test(m.peek(1)))t=m.next().getStr();else{for(t="";(p=m.next().peek())&&!j.test(p)&&!m.match(z);)t+=p;t=""==t?l:t}v[s]=a(s,a.ATTRIBUTE_NODE,
t);continue c}else s+=p,m.next();else if(m.match(z)){w=!0;y="/"==m.peek(-1);m.next(z);break}else x||(s+=p),m.next();w?(m=x?a(r,a.ELEMENT_NODE,"",v):a(r,a.ELEMENT_NODE,"",s),m.__close=y):(m.load("attrs"),m=a(a.TEXT_NODE,r))}else m=a(a.TEXT_NODE,r);c.trim&&j.test(e)||""!=e&&q.push(a(a.TEXT_NODE,e));e="";if(m.type!=a.TEXT_NODE)m.__open=!f,m.__close=m.__close||f,m.__empty=m.__open&&m.__close;q.push(m)}else{e+=f;i.next();continue a}else e+=f,i.next();0==i.length()&&""!=e&&q.push(a(a.TEXT_NODE,e))}return q},
build:function(b){for(var d=[],e,f,c=this.left,h=this.right;f=b.shift();){switch(f.type){case a.TEXT_NODE:case a.CDATA_NODE:e=f.value;break;case a.ELEMENT_NODE:e=c+(!f.__empty&&f.__close?"/":"")+f.name;k.each(f.attributes,function(b){e+=" "+b.name+(b.value!==l?'="'+b.value+'"':"")});e+=(f.__empty?" /":"")+h;break;case a.CUSTOM_NODE:e=c+(f.__close?"/":"")+f.name+f.value+h}""!=e&&(d.push(e),e="")}return d.join("")},rebuild:function(b){return this.build(this.parse(b))}};"undefined"!==typeof n?n("./Parser",
f):module.exports=f})(o("./Node"),o("./utils"));(function(a){function k(a){this._opts=a||{useWith:!1}}k.prototype={constructor:k,compile:function(k){function f(){var d="",b=0,i=g.length,f,e;if(i){for(;b<i;b++){e=typeof g[b];if(f!=e||"string"!=e)f&&(d+="string"==f?"',":","),d+="string"==e?"'":"";d+="string"==e?a.addslashes(g[b]):g[b][0];f=e}"string"==e&&(d+="'");h.push("__buf.write("+d.replace(/\r/g,"").replace(/\n/g,"\\n")+");");g=[]}}for(var h=[""],g=[],j;j=k.shift();)j.__break?(f(),h.push(j.value)):
"value"==j.name?g.push([j.value]):"string"==typeof j||j.type==j.TEXT_NODE||j.type==j.CDATA_NODE?g.push(j.value||j):(f(),h.push(j.value));f();this._opts.useWith?(h[0]="with( ctx ){ ",h.push(" } ")):h[0]="'use strict';";return new Function("ctx, __buf, __utils",h.join("")+" __buf.end();")}};"undefined"!==typeof n?n("./Compiler",k):module.exports=k})(o("./utils"));(function(a,k){function l(a,h){this._data="";this._pullLen=0;this._stream=h;this._callback=a}l.prototype={constructor:l,s:function(a){this._data+=
a;return this},v:function(a){a===k&&(a="");this._data+=a;return this},write:function(){var a=arguments.length,h=0;if(1===a)this._data+=arguments[0];else for(;h<a;h++)this._data+=arguments[h]},block:function(a,h){this.write(this.getBlock(a,h))},blockLabel:function(a,h){h!==k&&this.setBlock(a,h);if(this._blocks===k)this._chunks=[],this._blocks=[];this._chunks.push(this._data,a);this._blocks.push(this._chunks.length-1);this._data=""},setBlock:function(a,h){if(this._block===k)this._block={};this._block[a]=
h},getBlock:function(a,h){this._block[a]!==k&&(h=this._block[a]);if(h!==k){var g=new l;g._block=this._block;h(g);return g.toStr()}return""},pullSync:function(a,h,g){this.pull(a,h,g)},pull:function(f,h,g){if(this._pull===k)this._pull={};if(this._pull[h]===k){var j=a.defer(),d=function(){this._pullLen--;setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[h]=j.then(d,d);try{f[h](function(b,a){j[b?"reject":"resolve"](b||a)})}catch(b){j.reject(!0)}}g!==k&&this._pull[h].then(function(b){g(null,
b)},function(b){g(b)});return this._pull[h].promise()},end:function(){if(this._stream)this._callback(this._data),this._data="";if(0===this._pullLen){if(this._blocks!==k){for(var a=this._chunks.length,h=this._blocks.length,g,j="";h--;)g=this._blocks[h],this._chunks[g]=this.getBlock(this._chunks[g]);for(h=0;h<a;h++)j+=this._chunks[h];this._data=j+this._data}this._stream||this._callback(this._data)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof n?
n("./Buffer",l):module.exports=l})(o("./utils"));(function(a,k,l,f,h){function g(b,a){this.__lego(b,a)}var j={};a.uniqId();var d={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'};g.prototype={self:g,constructor:g,__lego:function(b,a){"string"!=typeof b&&(a=b,b=h);this._opts=this._defaults(a||{});this._data={};this._files={};this._listeners={};this._string=h;this._filename=b},_defaults:function(b){return a.extend({ns:this.self.NS,left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,rootDir:this.self.ROOT_DIR,compileDir:this.self.COMPILE_DIR,
async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING},b)},_uniqKey:function(b){var a=this._opts;return a.LEFT+a.RIGHT+a.TRIM+a.stream+b},_compile:function(b,i){var d=this._uniqKey(b);if(!this._tpl&&(b===h||j[d]===h)){var e=a.defer(),f={};j[d]=e.promise();this._load(b,function(a){if(a)e.resolve(a);else{if(!this._compiler)this._compiler=new l(this._opts);this._parse(this._opts.rootDir+b,f,function(a){this._tpl=this._compiler.compile(a);
this._save(b,f);e.resolve()}.bind(this),f)}}.bind(this))}j[d].done(i)},_parse:function(b,i,d){if(this._parser===h)this._parser=new k(this._opts);var e=this._opts,f=a.defer(),c=[],g=function(e){for(var d=[],h,g=b.replace(/\/[\s%|\w\._-]+$/,"/"),j,e=this._parser.parse(e);h=e.shift();)j=this._trans(h,e),null!==j&&h.type!=h.COMMENT_NODE&&c.push(j),"include"==h.name&&d.push(this._parse(g+h.value,i).done(function(b,a){c[b-1]=a}.bind(this,c.length)));a.defer.when(d).done(function(){f.resolve(this._normalizeStack(c))}.bind(this))}.bind(this);
this._string!==h?g(this._string||"[[undefined]]"):(i[b]||(i[b]=a.mtime(b)),this.self.load(b,e.async,e.encoding,g));return f.done(d).promise()},_normalizeStack:function(b){for(var a=[],d;d=b.shift();)"string"!=typeof d&&d[0]?b=d.concat(b):a.push(d);return a},_save:function(b,d){this._opts.compileDir&&a.writeFile(this._opts.compileDir+b+".json",JSON.stringify({includes:d,template:this._tpl.toString()}),this._opts.encoding)},_load:function(b,d){var h=this._opts,e=!0,f=a.defer();h.compileDir?a.getJSON(h.compileDir+
b+".json",h.encoding,function(b,d){b?f.resolve(!1):(a.each(d.includes,function(b,c){a.mtime(c)!=b&&(e=!1)}),f.resolve(e&&(new Function("return "+d.template))()))}):f.resolve(!1);return f.done(d).promise()},_trans:function(b,i){var f=[],e,g=b.attributes;if(this._opts.ns==b.ns||!b.ns)switch(b.name){case "doctype":e=d[g.mode&&g.mode.value]||d.def;b.type=b.TEXT_NODE;break;case "script":e=" try{ "+i.shift().value+" } catch(e){} ";i.shift();break;case "if":e=b.__close?"}":"if("+this.safe(b.value)+"){";
break;case "else":e="}"+b.name+"{";break;case "elseif":case "else if":e="}else if("+this.safe(b.value)+"){";break;case "cycle":case "foreach":b.__break=!0;if(b.__close)b.value="});";else{var c="";if("cycle"==b.name)b.value="__utils.cycle("+g.from.value+", "+g.to.value+", function (){";else{if(g.item)c=g.item.value;g.key&&(c+=(""==c?"__v,":",")+g.key.value);b.value="__utils.each("+this.safe(g.from.value)+", function ("+c+"){"}}break;case "pull":if(b.__close)e="__buf.write('</span>');";else{c={id:a.uniqId(),
name:g.name.value,as:g.as&&g.as.value||g.name.value,async:!!g.async,error:g.error&&g.error.value||"err"};if(!this._pullStack)this._pullStack=[];this._pullStack.push(c);e="__buf.write('<span id=\""+c.id+"\">');";g.async?e+='__buf.pull(ctx,"'+g.name.value+'");':(e+='__buf.pullSync(ctx,"'+c.name+'",function('+c.error+","+c.as+"){",i.push({value:"});",type:b.ELEMENT_NODE}))}break;case "get":this._opts.stream||this.blockLevel?(b.name="value",b.__empty?e='__buf.getBlock("'+g.name.value+'")':(e=b.__close?
"});":'__buf.block("'+g.name.value+'", function (__buf){',b.__break=!0)):e=b.__empty?'__buf.blockLabel("'+g.name.value+'");':b.__close?"});":'__buf.blockLabel("'+g.name.value+'", function (__buf){';break;case "set":this.blockLevel=(this.blockLevel>>0)+(b.__close?-1:1);e=b.__close?"});":(g.test?"if("+this.safe(g.test.value)+")":"")+'__buf.setBlock("'+g.name.value+'",function(__buf){';break;case "fail":case "loading":case "success":c=this._pullStack[this._pullStack.length-1];if("loading"==b.name)return null;
e=b.__close?"}":"if("+("fail"==b.name?"":"!")+c.error+"){";c.async&&(e=b.__close?e+('__buf.write(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,c.id).replace("%name",b.name)+"'); });"):'__buf.pull(ctx,"'+c.name+'",function('+c.error+","+c.as+"){__buf.write('<span id=\""+b.name+c.id+'" style="display: none">\');'+e)}if(e!==h)b.value=e;return f.length?
f:b},fetch:function(b,d){if(this._tpl===h)return this._compile(this._filename,this.fetch.bind(this,b,d)),this;this._tpl(b||{},new f(d,this._opts.stream),a)},loadString:function(b){this._string=a.trim(b);this._compile();return this},on:function(b,a){this._listeners[b]=a;return this},set:function(b,a){"string"==typeof b?this._data[b]=a:this._data=b||{};return this},safe:function(b){return this._opts.safeMode?"(function(){try{return "+b+'}catch(e){return""}})()':b},escape:function(b){return this._opts.escape?
"__utils.escape("+this.safe(b)+")":this.safe(b)}};g._files={};g.load=function(b,d,f,e){return(this._files[b]||(this._files[b]=a.load(b,d,f))).done(e)};g.NS="xtpl";g.LEFT="<";g.RIGHT=">";g.C_OPEN="<\!--";g.C_CLOSE="--\>";g.TRIM=!0;g.ASYNC=!0;g.STREAM=!1;g.ESCAPE=!0;g.SAFE_MODE=!0;g.ENCODING="utf-8";g.ROOT_DIR="";g.COMPILE_DIR="";g.fetch=function(b,d){var f=new this(b),e=a.defer(),g="";f.set(d).on("data",function(b){g+=b}).on("end",function(b){e.resolve(b===h?g:b)}).fetch();return e.promise()};g.fromString=
function(b,a){return(new this(a)).loadString(b)};g.engine=function(b){"string"==typeof b&&(b=o("./"+b));var d=this.prototype;d._super={};a.each(b.statics,function(b,a){this[a]=b},this);a.each(b.fn,function(b,a){var f=d[a];f&&(d._super[a]=f);d[a]=b});return g};"undefined"!==typeof n?n("./AsyncTpl",g):module.exports=g})(o("./utils"),o("./Parser"),o("./Compiler"),o("./Buffer"));(function(a,k){var l={fn:{_defaults:function(f){return this._super._defaults.call(this,a.extend(f||{},{firstLine:!1}))},_trans:function(f,
h){var g=[],j,d=f.attributes;if(f.ns!=this._opts.ns){if(f.type==f.ELEMENT_NODE)if(!f.__empty&&f.__close)g.push("</"+f.name+">");else{g.push("<"+f.name);var b=RegExp(this._opts.ns+":");a.each(d,function(a){b.test(a.value)?g.push(" "+a.name+'="',{name:"value",value:this.escape(a.value.replace(b,""))},'"'):g.push(" "+a.name+'="'+a.value+'"')},this);g.push(f.__empty?"/>":">")}}else switch(f.name){case "if":j=d.test&&d.test.value;break;case "choose":this.__choose=f.__open?1:0;break;case "when":j=f.__close?
"}":(1==this.__choose?"":" else ")+"if("+this.safe(d.test.value)+"){";this.__choose++;break;case "otherwise":j=f.__close?"}":" else {";break;case "foreach":d={from:d.iterate,key:d.index,item:d.as};break;case "value":j=this.escape(h.shift().value);h.shift();break;case "include":j=d.src.value;break;case "comment":f.type=f.TEXT_NODE;f.__empty?j="":(j="<\!--"+h.shift().value+"--\>",h.shift());break;case "text":f.type=f.TEXT_NODE;j=h.shift().value;h.shift();break;case "template":return null}if(j!==k)f.value=
j;f.attributes=d;return g.length?g:this._super._trans.call(this,f,h)}}};"undefined"!==typeof n?n("./XML",l):module.exports=l})(o("./utils"));(function(a,k){var l=/\r/g,f=/\n/g,h=/^\/(.+)\/(\w*)$/,g="foreach include extends block doctype",j={fn:{_defaults:function(d){d=a.extend({left:"{{",right:"}}"},d,{tags:g});d.c_open=d.left+"*";d.c_close="*"+d.right;return this._super._defaults.call(this,d)},_trans:function(d,b){var f=[],g,e=d.attributes;if(d.type==d.ELEMENT_NODE||d.type==d.CUSTOM_NODE)switch(d.name){case "if":case "else":case "elseif":g=
e;break;case "script":case "cycle":break;case "foreach":d.__break=!0;if(!this.__foreach)this.__foreach=[],this.__foreachelse=[];if(d.__open)this.__foreach.push(e.from.value);else if(this.__foreachelse.length)return this.__foreachelse=[],d.value="}",d;break;case "foreachelse":e=this.__foreach.pop();this.__foreachelse.push(e);g="}); if(!__utils.sizeof("+this.safe(e)+")){";break;case "block":e=e.name&&e.name.value;if(!this.__blocks)this.__blocks={},this.___blocks=[];e?(this.___blocks.push(e),this.__blocks[e]=
1+this.__blocks[e]||0):e=this.___blocks.shift();d.name=0<this.__blocks[e]?"set":"get";break;case "extends":case "include":d.name="include";g=e.file.value;break;default:if(this.fns[d.name]){var h=[];a.each(e,function(b,a,d){d=b.value;d=/$\$/.test(d)?this.safe(d):'"'+d+'"';h.push(a+":"+d)});d.value="__this.fns."+d.name+"({"+h.join(",")+"},ctx)";d.name="value";return d}g=this.escape(d.name+e);d.name="value"}if(g!==k)d.value=g;return f.length?f:this._super._trans.call(this,d,b)},escape:function(d){var b=
d.split("|"),d=this._super.escape.call(this,this.safe(b[0]));a.each(b.splice(1),function(b){b=b.split(":");d="__this.mods."+b[0]+"("+d+(1<b.length?","+b.splice(1).join(","):"")+")"});return d},safe:function(a){return this._super.safe.call(this,a.replace(/\$([a-z][a-z0-9_]*)/ig,function(b,a){return"(typeof "+a+'==="undefined"?ctx.'+a+":"+a+")"}))}},statics:{fn:function(d){a.each(d,function(b,a){g+=" "+a;this.fns[a]=b},this);return this},modifiers:function(d){a.each(d,function(b,a){this.mods[a]=function(){return b.apply(this,
arguments)}},this);return this}}};j.fn.fns=j.statics.fns={};j.fn.mods=j.statics.mods={};j.statics.fn({assign:function(a,b){b[a["var"]]=a.value;return""}}).modifiers({upper:function(a){return a.toUpperCase()},lower:function(a){return a.toLowerCase()},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()},nl2br:function(a){return a.replace(l,"").replace(f,"<br/>")},regex_replace:function(a,b,f){b=b.match(h);return a.replace(RegExp(b[1],b[2]),f)}});"undefined"!==typeof n?
n("./Smarty",j):module.exports=j})(o("./utils"));E.AsyncTpl=o("AsyncTpl");var u={},v=o("utils");AsyncTpl.fetch=function(a,k,l,f){"string"!=typeof k&&(f=l,l=k,k=w);if(u[a]===w)if("#"==a.charAt(0)){var h=v.$(a)||{innerHTML:"[["+a+" \u2014 not found]]"};u[a]=new this;u[a].loadString(h.innerHTML)}else u[a]=new this(a);var g=v.defer();u[a].fetch(l,function(a){g.resolve(a===w?"":a)});k&&g.done(function(a){var d=v.$(k);if(d)d.innerHTML=a});return g.promise().done(f)};if("undefined"!=typeof jQuery)jQuery.tpl=
function(a){AsyncTpl.engine(a);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(a,k){jQuery.tpl("XML").fetch(a,this[0],k);return this}})(this);
