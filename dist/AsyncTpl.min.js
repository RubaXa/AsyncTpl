(function(H,w){function p(d,i){C[d.replace(D,"")]=i}function o(d){return C[d.replace(D,"")]}var D=/^.+\//,C={};p("fs",{readFile:function(d,i,m){jQuery.ajax({url:d,type:"get",dataType:"text",isLocal:!0,success:function(d){m(null,d)}})},readFileSync:function(d){return jQuery.ajax({url:d,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(d){function i(e,b,d,f){if(!(this instanceof i))return new i(e,b,d,f);if("number"===typeof e)switch(f=d,
d=b,b=e,b){case i.TEXT_NODE:e="<text>";break;case i.CDATA_NODE:e="<cdata>";break;case i.COMMENT_NODE:e="<comment>";break;case i.CUSTOM_NODE:e="<custom>"}else e=e.toLowerCase(),e.match(m)&&(this.ns=RegExp.$1,e=RegExp.$2);this.name=e;this.type=b;this.value=d;this.attributes=f||{};this.childNodes=[]}var m=/^([^:]+):(.+)/,l={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21,VAR_NODE:22},f={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,
input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,wbr:!0};i.prototype={constructor:i,attr:function(e,b){if(this.attributes[e])return this.attributes[e].value;d.exception('Tag "'+this.name+'", attribute "'+(b||e)+'" is missing',this.__line,this.__file)},removeAttr:function(e){delete this.attributes[e]},c:function(e,b,d,f){return this.clone(e,b,i.COMPILER_NODE,d,f)},clone:function(e,b,f,k,a){b=i(b,this.type,b.value);b.ns=e;b.type=f;b.__line=this.__line;b.__file=this.__file;b.__open=!a;b.__close=
!!a;d.each(k,function(a,e){b.attributes[e]=i(e,i.ATTRIBUTE_NODE,a)});return b},isShort:function(){return!0===f[this.name]}};for(var h in l)i[h]=i.prototype[h]=l[h];i.findClosureIdx=function(e,b,d){if(!b.__close)for(var d=d|0,f=e.length,a=0,g;d<f;d++)if(g=e[d],b.name==g.name&&(a+=g.__close?-1:1,g.__close&&1>a))return d};"undefined"!==typeof p?p("./Node",i):module.exports=i})(o("./utils"));(function(d,i){function m(a){return n[a]}function l(a){if(!(this instanceof l))return new l(a);var c=[],g=[],b,
d,e=!0,f=!0,n=!1;this.done=function(a){e&&a!==i&&(n?a(d):c.push(a));return this}.bind(this);this.fail=function(a){f&&a!==i&&(n?a(d):g.push(a));return this}.bind(this);this.then=function(a,c){return this.done(a).fail(c)}.bind(this);this.reject=function(a){e=!1;n=!0;for(d=a;g.length;)g.shift()(a);return this}.bind(this);this.resolve=function(a){f=!1;n=!0;for(d=a;c.length;)c.shift()(a);return this}.bind(this);this.promise=function(){b===i&&(b={done:this.done,fail:this.fail,then:this.then,promise:this.promise});
return b}.bind(this);a!==i&&a(this)}var f=Object.prototype.toString,h=String.prototype.trim,e=/^#/,b=[].slice,j=/^\s+/,k=/\s+$/,a=/[&<>"]/g,g=/'/g,n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},c="undefined"!==typeof console&&console,q={Array:function(a){a=a||[];a.map=a.map||function(a){for(var c=[],x=0,g=this.length;x<g;x++)c.push(a(this[x]));return c};a.add=function(a,c,x){a.__order=~~x;c===i?this.push(a):0==c?this.unshift(a):this.splice(c,0,a);return this};a.addOrder=function(a,c){return this.add(a,
i,c)};a.addMulti=function(a,c){a.length&&this.splice.apply(this,[c,0].concat(a));return this};a.order=function(){this.sort(function(a,c){return a.__order-c.__order});return this};return a},$:function(a){return"string"==typeof a?document.getElementById(a.replace(e,"")):a},sizeof:function(a){var c=0;if(a&&(q.isArray(a)||"object"==typeof a))"length"in a?c=a.length:q.each(a,function(){c++});return c},isArray:function(a){return"[object Array]"==f.call(a)},uniqId:function(){return(new Date).getTime()+""+
Math.round(1E3*Math.random())},ns:function(a,c,g){var c=c.split("."),b=c.pop();q.each(c,function(c){a[c]||(a[c]={});a=a[c]});a[b]=g},escape:function(c){return"string"===typeof c&&a.test(c)?c.replace(a,m):c},addslashes:function(a){return a.replace(g,"\\'")},log:c&&"object"==typeof c.log?Function.prototype.call.bind(c.log,c):function(){c&&c.log.apply(c,arguments)},exception:function(a,c,g){throw{message:a,line:c,file:g};},error:function(a,c,g){a="Error: "+a.message+" in "+(a.file||g)+" on line "+(a.line||
c);this.log(a);return a},keys:function(a){var c=[];Object.keys?c=Object.keys(a):q.each(a,function(a){c.push(a)});return c},each:function(a,c,g){if(a)if(a.forEach)a.forEach(c,g);else if("length"in a&&0 in a)for(var b=0,d=a.length;b<d;b++)c.call(g,a[b],b,a);else for(b in a)a.hasOwnProperty(b)&&c.call(g,a[b],b,a)},cycle:function(a,c,g){for(;a<=c;a++)g(a)},trim:h?function(a){return h.call(a)}:function(a){return(""+a).replace(j,"").replace(k,"")},extend:function(a){a=a||{};this.each(arguments,function(c,
g){0<g&&this.each(c,function(c,g){a[g]=c})},this);return a},indexOf:function(a,c){if(a.indexOf)return a.indexOf(c);for(var g=0,b=a.length;g<b;g++)if(a[g]===c)return g;return-1},inherit:function(a,c,g,b){if(2===arguments.length){var d=function(){};d.prototype=c.prototype;a.prototype=new d;a.prototype.self=a;a.prototype.constructor=a;q.each(c,function(c,g){a[g]=c})}else return c.prototype[g].apply(a,b)},defer:l,load:function(a,c,g,b){var e=this.defer();c?d.readFile(a,g||"utf-8",function(a,c){e[a?"reject":
"resolve"](a||c)}):e.resolve(o("fs").readFileSync(a,g||"utf-8"));return e.done(b).promise()},mtime:function(a){return d?+Date.parse(d.lstatSync(a).mtime):0},writeFile:function(a,c,g){d&&d.writeFileSync(a,c,g)},getJSON:function(a,c,g){var b=q.defer();if(d)try{b.resolve(JSON.parse(d.readFileSync(a,c)))}catch(e){b.reject()}return b.fail(function(){g(!0)}).done(function(a){g(!1,a)}).promise()}};l.prototype={constructor:l};l.when=function(a){var c=l(),g=[];a instanceof l?g.push.apply(g,arguments):g=a;
var b=0,d=g.length,e=function(){++b==d&&c.resolve()};q.each(g,function(a){a.done(e)});d||c.resolve();return c.promise()};Function.prototype.bind===i&&(Function.prototype.bind=function(a){var c=b.call(arguments,1),g=this;return function(){return g.apply(a,c.concat(b.call(arguments,0)))}});"undefined"!==typeof p?p("./utils",q):module.exports=q})(o("fs"));(function(d,i,m){function l(b,a){this._file=a;this._opts=i.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},
b);this._opts.tags&&(this._opts.tags=" "+this._opts.tags+" ")}function f(b){var a=(b+"").split(""),g=0,d={};this.pos=function(){for(var c=g;c--&&"\n"!=a[c];);return g-c+1};this.line=function(){for(var c=1,b=g;b--;)"\n"==a[b]&&c++;return c};this.peek=function(c){return a[g+(c||0)]};this.lex=function(c){return a.slice(g,g+c).join("")};this.match=function(a){var g=this.lex(a.length)===a;this.lastMatch=g?a:null;this.lastMatchLength=g?a.length:0;return g};this.next=function(a){"string"===typeof a&&(a=
a.length);g+=a||1;return this};this.save=function(a){d[a]=g;return this};this.load=function(a){g=d[a];return this};this.length=function(){return a.length-g};this.getStr=function(){for(var a,g="",b=this.peek(),d=1;a=this.peek();)if(this.next(),g+=a,"\\"==a)d++;else{if(b==a&&!(d%2))return g.substring(1,g.length-1);d=0}};this.substr=function(c,b){return a.slice(c,b||g).join("")};this.extract=function(a,g){this.save("extract");g!==m&&this.next(g);for(var b="",d;d=this.peek();){if(this.match(a))return this.next(a),
b;b+=d;this.next()}this.load("extract");return null}}var h=/['"]/,e=/^[\s\r\n\t]+$/,b=/^([$a-z][\da-z\s:>]|\/\w)$/i,j=/[a-z\d:-]/i;l.prototype={constructor:l,parse:function(k){var a,g="",n=i.Array(),c,q=this._opts,x=q.tags,l=q.left,I=q.right,o=q.c_open,p=q.c_close,E=l.length,F=0;!q.firstLine&&/^\s*<\?xml/.test(k)&&(k=i.trim(k.replace(/^[^>]+>\n?/,"")),F=1);k=new f(k);a:for(;a=k.peek();){if(k.match(o))a=k.extract(p,k.lastMatchLength),null!==a&&n.push(d(d.COMMENT_NODE,a));else if(k.match("<![CDATA["))a=
k.extract("]]\>",k.lastMatchLength),null!==a&&n.push(d(d.CDATA_NODE,a));else if(k.match(l))if(b.test(k.peek(E)+k.peek(E+1))){a="/"==k.next(l).peek()?(k.next(),!0):!1;c=k;var y=x,A=I,s,z=c;s=void 0;for(var r="";s=z.peek();)if(j.test(s))r+=s,z.next();else break;s=r;var r=void 0,v=z=!1,w={},t="",u=void 0;if(c.length()){c.save("attrs");y=!y||-1<y.indexOf(" "+s+" ");c:for(;r=c.peek();)if(y&&j.test(r))for(t="";r=c.peek();)if(c.match(A)||e.test(r)){w[t]=d(t,d.ATTRIBUTE_NODE);continue c}else if("="==r){if(h.test(c.peek(1)))u=
c.next().getStr();else{for(u="";(r=c.next().peek())&&!e.test(r)&&!c.match(A);)u+=r;u=""==u?m:u}w[t]=d(t,d.ATTRIBUTE_NODE,u);continue c}else t+=r,c.next();else if(c.match(A)){v=!0;z="/"==c.peek(-1);c.next(A);break}else y||(t+=r),c.next();v?(c=y?d(s,d.ELEMENT_NODE,"",w):d(s,d.ELEMENT_NODE,"",t),c.__close=z):(c.load("attrs"),c=d(d.TEXT_NODE,s))}else c=d(d.TEXT_NODE,s);(!q.trim||!e.test(g))&&""!=g&&n.push(d(d.TEXT_NODE,g));g="";c.type!=d.TEXT_NODE&&(c.__open=!a,c.__close=c.__close||a,c.__empty=c.__open&&
c.__close);n.push(c)}else{g+=a;k.next();continue a}else g+=a,k.next();0==k.length()&&""!=g&&n.push(d(d.TEXT_NODE,g));n.length&&(c=n[n.length-1],c.__line||(c.__line=k.line()+F,c.__file=this._file))}return n},build:function(b){for(var a=[],g,e,c=this.left,f=this.right;e=b.shift();){switch(e.type){case d.TEXT_NODE:case d.CDATA_NODE:g=e.value;break;case d.ELEMENT_NODE:g=c+(!e.__empty&&e.__close?"/":"")+e.name;i.each(e.attributes,function(a){g+=" "+a.name+(a.value!==m?'="'+a.value+'"':"")});g+=(e.__empty?
" /":"")+f;break;case d.CUSTOM_NODE:g=c+(e.__close?"/":"")+e.name+e.value+f}""!=g&&(a.push(g),g="")}return a.join("")},rebuild:function(b){return this.build(this.parse(b))}};"undefined"!==typeof p?p("./Parser",l):module.exports=l})(o("./Node"),o("./utils"));(function(d){function i(d){this._opts=d||{useWith:!1}}i.prototype={constructor:i,compile:function(i){function l(){var b="",e=0,a=h.length,g,n;if(a){for(;e<a;e++){n=typeof h[e];if(g!=n||"string"!=n)g&&(b+="string"==g?"',":","),b+="string"==n?"'":
"";b+="string"==n?d.addslashes(h[e]):h[e][0];g=n}"string"==n&&(b+="'");f.push("__buf.w("+b.replace(/\r/g,"").replace(/\n/g,"\\n")+");");h=[]}}for(var f=["","",""],h=[],e,b=["undef","undefined"];e=i.shift();)e.type&&e.type==e.VAR_NODE?~d.indexOf(b,e.name)||b.push(e.name):e.__break?(l(),f.push(e.value)):"value"==e.name?e.__escape?(l(),f.push(" try{__buf.v("+e.value+")}catch(e){} ")):h.push([e.value]):"string"==typeof e||e.type==e.TEXT_NODE||e.type==e.CDATA_NODE?h.push(e.value||e):(l(),f.push(e.value));
l();this._opts.useWith?(f[0]="with( ctx ){ ",f.push(" } ")):f[0]="'use strict';/*global ctx, __buf, utils*/";f[1]="var "+b.join(",");f[2]=";if(ctx.__part!==undef)__buf.off();";f=f.join("")+" __buf.end();";return new Function("ctx, __buf, __utils",f)}};"undefined"!==typeof p?p("./Compiler",i):module.exports=i})(o("./utils"));(function(d,i){function m(d,f){this._data="";this._pullLen=0;this._active=!0;this._stream=f;this._callback=d}m.prototype={constructor:m,on:function(){this._active=!0},off:function(){this._active=
!1},v:function(l){this._active&&l!==i&&(this._data+=d.escape(l));return this},w:function(d){if(this._active)if(1<arguments.length){var f="",h=arguments.length,e=0;switch(h){case 9:f=arguments[8]+f;case 8:f=arguments[7]+f;case 7:f=arguments[6]+f;case 6:f=arguments[5]+f;case 5:f=arguments[4]+f;case 4:f=arguments[3]+f;case 3:f=arguments[2]+f;case 2:this._data+=arguments[0]+arguments[1]+f;break;default:for(h=arguments.length;e<h;)this._data+=arguments[e++]}}else this._data+=d;return this},cycle:function(){this._active&&
d.cycle.apply(d,arguments)},each:function(){this._active&&d.each.apply(d,arguments)},block:function(d,f,h){this.w(this.getBlock(d,f,h))},blockLabel:function(d,f,h){this._active&&(h!==i&&this.setBlock(d,h,!0),this._blocks===i&&(this._chunks=[],this._blocks=[],this._attrs=[]),d=this._chunks.push(this._data,d)-1,this._blocks.push(d),f!==i&&(this._attrs[d]=f),this._data="")},setBlock:function(d,f,h){this._block===i&&(this._block={});if(!0!==h||this._block[d]===i)this._block[d]=f},getBlock:function(d,
f,h){this._block[d]!==i&&(h=this._block[d]);return h!==i?(d=new m,d._block=this._block,h(d,f),d.toStr()):""},pullSync:function(d,f,h){this.pull(d,f,h)},pull:function(l,f,h){this._pull===i&&(this._pull={});if(this._pull[f]===i){var e=d.defer(),b=function(){this._pullLen--;setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[f]=e.then(b,b);try{l[f](function(b,a){e[b?"reject":"resolve"](b||a)})}catch(j){e.reject(!0)}}h!==i&&this._pull[f].then(function(b){h(null,b)},function(b){h(b)});
return this._pull[f].promise()},end:function(){this._stream&&(this._callback(this._data),this._data="");if(0===this._pullLen){if(this._blocks!==i){for(var d=this._blocks,f=this._chunks,h=this._attrs,e=f.length,b=d.length,j;b--;)j=d[b],f[j]=this.getBlock(f[j],h[j]);d=f[--e];for(b=e;b--;)d=f[b]+d;this._data=d+this._data}this._callback(this._data);this._stream&&this._callback(null)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof p?p("./Buffer",
m):module.exports=m})(o("./utils"));(function(d,i,m,l,f,h){function e(a,g){this.__lego(a,g)}var b={},j={},k={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'};e.fn=e.prototype={self:e,constructor:e,__lego:function(a,g){"string"!=typeof a&&(g=a,a=h);this._opts=this._defaults(g||{});this._data={};this._files={};this._listeners={};this._string=h;this._filename=a},_defaults:function(a){return d.extend({ns:this.self.NS,left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,rootDir:this.self.ROOT_DIR,
compileDir:this.self.COMPILE_DIR,async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING,blockMode:this.self.BLOCK_MODE,debug:this.self.DEBUG},a)},_uniqKey:function(a){var g=this._opts;return g.left+g.right+g.trim+g.stream+a},_compile:function(a,g){var e=a===h?Math.random():this._uniqKey(a);if(b[e]!==h)b[e].done(function(a){this._tpl=a}.bind(this));else if(!this._tpl&&(a===h||b[e]===h)){var c=d.defer(),f={};b[e]=c.promise();this._load(a,
function(g){g?(this._tpl=g,c.resolve(this._tpl)):(this._compiler||(this._compiler=new l(this._opts)),this._parse(this._opts.rootDir+a,f,function(g){this._tpl=this._compiler.compile(g);this._save(a,f);c.resolve(this._tpl)}.bind(this),f))}.bind(this))}b[e].done(g)},_parse:function(a,g,b){this._parser===h&&(this._parser=new m(this._opts,a));var c=this._opts,e=d.defer(),f=[],i=function(c){for(var b=[],n=a.replace(/\/[\s%|\w\._-]+$/,"/"),i,k,j=0,c=this._parser.parse(c);j in c;){this._pre(c[j],j,c);j++}try{for(;i=
c.shift();){this._prepare(i,c,f);i.prev=this.__node;k=this._trans(i,c,f);this.__node=i;k!==null&&i.type!=i.COMMENT_NODE&&f.push(k);i.name=="include"&&b.push(this._parse(n+i.value,g).done(function(a,c){f[a-1]=c}.bind(this,f.length)))}}catch(l){b=[];f=[d.error(l)]}this.__node=h;d.defer.when(b).done(function(){e.resolve(this._normalizeStack(f))}.bind(this))}.bind(this);this._string!==h?i(this._string||"[[undefined]]"):(g[a]||(g[a]=d.mtime(a)),this.self.load(a,c.async,c.encoding,i));return e.done(b).promise()},
_normalizeStack:function(a){for(var g=[],b;b=a.shift();)"string"!=typeof b&&b[0]?a=b.concat(a):g.push(b);return g},_save:function(a,g){this._opts.compileDir&&d.writeFile(this._opts.compileDir+a+".json",JSON.stringify({includes:g,template:this._tpl.toString()}),this._opts.encoding)},_load:function(a,g){var b=this._opts,c=!0,e=d.defer();b.compileDir?d.getJSON(b.compileDir+a+".json",b.encoding,function(a,g){a?e.resolve(!1):(d.each(g.includes,function(a,g){d.mtime(g)!=a&&(c=!1)}),e.resolve(c&&(new Function("return "+
g.template))()))}):e.resolve(!1);return e.done(g).promise()},_try:function(a,g,b){g||(a&&a.__line?(g=a,a=a.value):g={});return"try{"+a+"}catch(_){"+(this._opts.debug&&g.__line?"__utils.error(_,"+g.__line+',"'+g.__file+'");':"")+(b!==h?"return "+b:"")+"}"},_pre:function(a,g,b){function c(c){return a.c.apply(a,[e].concat(c))}var e=this._opts.ns,f=i.findClosureIdx(b,a,g),h=d.Array(),j=d.Array(),k=d.Array(),l=d.Array();d.each(a.attributes,function(c,b){if(c.ns==e)switch(a.removeAttr(b),b=c.name,b){case "if":case "tag-if":var g=
["if",{test:c.value}],d=["if",0,1];"if"==b?(h.addOrder(g,0),l.addOrder(d,3)):(h.addOrder(g,2),j.addOrder(d,2),l.addOrder(d,1),k.addOrder(g,1));break;case "set":h.addOrder(["set",{name:c.value}],1);l.addOrder(["set",0,1],2);break;case "get":j.addOrder(["get",{name:c.value}],3),k.addOrder(["get",0,1],0)}},this);b.addMulti(l.order().map(c),f+1);b.addMulti(k.order().map(c),f);b.addMulti(j.order().map(c),g+1);b.addMulti(h.order().map(c),g)},_prepare:function(a,b){var d=b[0],c=d&&d.name;if(d&&("attrs"==
c||"attributes"==c))a.__openTag=!0},_trans:function(a,b){var e=[],c,f=a.attributes;if(this._opts.ns==a.ns||!a.ns)switch(a.name){case "script":c=" "+this._try(b.shift().value,a)+" ";b.shift();break;case "if":c=a.__close?"}":"if("+this.safe(a.value,a)+"){";break;case "else":c="}"+a.name+"{";break;case "elseif":case "else if":c="}else if("+this.safe(a.value,a)+"){";break;case "for":case "cycle":case "foreach":a.__break=!0;a.__close?a.value="});":(c="",f.to?c="__buf.cycle("+a.attr("from")+", "+a.attr("to")+
", function ("+(f.key||f.item||{value:""}).value+"){":(f.item&&(c=f.item.value),f.key&&(c+=(""==c?"__v,":",")+f.key.value),c="__buf.each("+this.safe(a.attr("from",f._from),a)+", function ("+c+"){"));break;case "pull":if(a.__close)c="__buf.w('</span>');";else{var j={id:d.uniqId(),name:a.attr("name"),as:f.as&&a.attr("value")||a.attr("name"),async:!!f.async,error:f.error&&a.attr("error")||"err"};this._pullStack||(this._pullStack=[]);this._pullStack.push(j);c="__buf.w('<span id=\""+j.id+"\">');";f.async?
c+='__buf.pull(ctx,"'+j.name+'");':(c+='__buf.pullSync(ctx,"'+j.name+'",function('+j.error+","+j.as+"){",b.push({value:"});",type:a.ELEMENT_NODE}))}break;case "assign":c=a.attr("name").split(".");j=c.shift();"ctx"==j?c='__utils.ns(ctx,"'+c.join(".")+'",':(b.push(i(j,i.VAR_NODE)),c=0<c.length?"if("+j+"===undef)"+j+"={};"+("__utils.ns("+j+',"'+c.join(".")+'",'):j+"=(");c=f.type&&"string"!=f.type?c+a.attr("value"):c+("'"+d.addslashes(a.attr("value"))+"'");c+=");";break;case "get":var j=[],k,l;if(f.attrs)l=
f.attrs.value;else for(k in f)"name"!=k&&"attrs-name"!=k&&j.push(this._try("a."+k+"="+a.attr(k),a));a.__empty?c='__buf.#method#("'+a.attr("name")+'",#attrs#);':a.__close?c="});":1==this._opts.blockMode?c='__buf.#method#("'+a.attr("name")+'",#attrs#,function (__buf,'+(f["attrs-name"]&&f["attrs-name"].value||"attrs")+"){":(c='__buf.#method#("'+a.attr("name")+'",#attrs#)',l=b.shift().value,b.shift());l?(j.length&&console.log("WARNING: Can't use block attributes at block mode == 2"),j=this.safe(l,a)):
j=j.length?"(function(a){"+j.join("")+" return a})({})":"undef";c=c.replace("#attrs#",j).replace("#method#",this._opts.stream||this.blockLevel?"block":"blockLabel");break;case "set":if("set"==b[0].name&&b[0].__close)return b.shift(),null;this.blockLevel=(this.blockLevel|0)+(a.__close?-1:1);a.__close?c="});":(c="",f.test&&(c+="if("+this.safe(a.attr("test"),a)+")"),c+='__buf.setBlock("'+a.attr("name")+'",function(__buf,'+(f["attrs-name"]&&a.attr("attrs-name")||"attrs")+"){");break;case "fail":case "loading":case "success":j=
this._pullStack[this._pullStack.length-1];if("loading"==a.name)return null;c=a.__close?"}":"if("+("fail"==a.name?"":"!")+j.error+"){";j.async&&(c=a.__close?c+('__buf.w(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,j.id).replace("%name",a.name)+"'); });"):'__buf.pull(ctx,"'+j.name+'",function('+j.error+","+j.as+"){__buf.w('<span id=\""+a.name+j.id+
'" style="display: none">\');'+c);break;case "part":a.__close?c='if(ctx.__part=="'+this.__parts.pop()+'")__buf.off();':(c='if(ctx.__part=="'+a.attr("name")+'")__buf.on();',this.__parts||(this.__parts=[]),this.__parts.push(a.attr("name")));break;case "space":a.type=a.TEXT_NODE;c=" ";break;case "text":a.type=a.TEXT_NODE;f.value?c=a.attr("value"):(c=b.shift().value,b.shift());break;case "attrs":case "attributes":if(a.__close)c="",a.type=a.TEXT_NODE,b[0].__close&&!b[0].__empty&&b[0].isShort()&&(b.shift(),
c+="/"),c+=this._opts.right;else return(!a.prev||a.prev.type!=a.ELEMENT_NODE||a.prev.__close)&&d.exception("<"+this._opts.ns+":"+a.name+"/> must be the first child",a.__line,a.__file),null;break;case "attr":case "attribute":a.type=a.TEXT_NODE;c=a.__close?'"':" "+a.attr("name")+'="';break;case "closure":if(a.__close)c="})("+this.__closure.shift().join(",")+");";else{j=[];l=[];c="(function(";this.__closure=this.__closure||[];for(k in f)l.push(k),j.push(this.safe(a.attr(k),a));c+=l.join(",")+"){";this.__closure.push(j)}break;
default:c=this._myNode(a.name,a,f),c!==h&&(a.type=a.TEXT_NODE,d.isArray(c)&&(e=c,c=h))}c!==h&&(a.value=c);return e.length?e:a},_myNode:function(a,b,d){if(j[a])return j[a].call(this,b,d);if(j._)return j._.call(this,b,d)},fetch:function(a,b){b===h&&(b=a,a=h);this._tpl===h?this._compile(this._filename,this.fetch.bind(this,a,b)):this._tpl(a||{},new f(b,this._opts.stream),d)},loadString:function(a){this._string=d.trim(a);this._compile();return this},on:function(a,b){this._listeners[a]=b;return this},set:function(a,
b){"string"==typeof a?this._data[a]=b:this._data=a||{};return this},safe:function(a,b,d){if(!b||!b.__line)d=b,b=h;return this._opts.safeMode?"(function(){"+this._try("return "+a,b,'""')+"})"+(d?"":"()"):a},escape:function(a,b){return this._opts.escape?"__utils.escape("+this.safe(a,b)+")":this.safe(a,b)}};e._files={};e.load=function(a,b,e,c){return(this._files[a]||(this._files[a]=d.load(a,b,e))).done(c)};e.NS="xtpl";e.LEFT="<";e.RIGHT=">";e.C_OPEN="<\!--";e.C_CLOSE="--\>";e.TRIM=!0;e.ASYNC=!0;e.STREAM=
!1;e.ESCAPE=!0;e.SAFE_MODE=!0;e.ENCODING="utf-8";e.BLOCK_MODE=1;e.DEBUG=!0;e.ROOT_DIR="";e.COMPILE_DIR="";e.fetch=function(a,b,e){var c=new this(a),f=d.defer(),j="";c.fetch(b,function(a){null===a||!c._opts.stream?f.resolve(c._opts.stream?j:a):j+=a});e&&f.done(e);return f.promise()};e.fromString=function(a,b){return(new this(b)).loadString(a)};e.tags=function(a){d.each(a,function(a,b){j[b]=a});return this};e.tags({doctype:function(a,b){return k[b.mode&&b.mode.value]||k.def}});e.engine=function(a){"string"==
typeof a&&(a=o("./"+a));var b=this.fn;b._super={};d.each(a.statics,function(a,b){this[b]=a},this);d.each(a.fn,function(a,c){var d=b[c];d&&(b._super[c]=d);b[c]=a});return e};"undefined"!==typeof p?p("./AsyncTpl",e):module.exports=e})(o("./utils"),o("./Node"),o("./Parser"),o("./Compiler"),o("./Buffer"));(function(d,i){var m={},l=/\{\*|\*\}/g;m.fn={_defaults:function(f){return this._super._defaults.call(this,d.extend(f||{},{firstLine:!1}))},_build:function(f,i){var e=[];"string"==typeof f&&(f={name:"a"});
!f.__empty&&f.__close?e.push("</"+f.name+">"):(e.push("<"+f.name),d.each(i,function(b){e.push(" "+b.name+'="');for(var b=b.value.split(l),d=0,f=b.length;d<f;d++)d%2?e.push({name:"value",value:b[d],__escape:!0}):""!==b[d]&&e.push(b[d]);e.push('"')},this),f.__openTag||e.push(f.__empty?"/>":">"));return e},_trans:function(f,h,e){var b=[],j,k=f.attributes;if(f.ns!=this._opts.ns)f.type==f.ELEMENT_NODE&&(b=this._build(f,k));else switch(f.name){case "if":j=f.__close?"":f.attr("test");break;case "choose":this.__choose=
f.__open?1:0;break;case "when":j=f.__close?"}":(1==this.__choose?"":" else ")+"if("+this.safe(f.attr("test"),f)+"){";this.__choose++;break;case "otherwise":j=f.__close?"}":" else {";break;case "foreach":k={_from:"iterate",from:k.iterate||k.from,key:k.index,item:k.as,to:k.to};break;case "value":j=this.escape(h.shift().value,f);h.shift();break;case "include":j=f.attr("src");break;case "comment":f.type=f.TEXT_NODE;f.__empty?j="":(j="<\!--"+h.shift().value+"--\>",h.shift());break;case "template":return null}j!==
i&&(d.isArray(j)?b=j:f.value=j);f.attributes=k;return b.length?b:this._super._trans.call(this,f,h,e)}};"undefined"!==typeof p?p("./XML",m):module.exports=m})(o("./utils"));(function(d,i){var m=/\r/g,l=/\n/g,f=/^\/(.+)\/(\w*)$/,h="foreach include extends block doctype",e={fn:{_defaults:function(b){b=d.extend({left:"{{",right:"}}"},b,{tags:h,ns:i,escape:!1});b.c_open=b.left+"*";b.c_close="*"+b.right;return this._super._defaults.call(this,b)},_trans:function(b,e,f){var a=[],g,h=b.attributes;if(b.type==
b.ELEMENT_NODE||b.type==b.CUSTOM_NODE)switch(b.name){case "if":case "else":case "elseif":g=h;break;case "for":case "cycle":case "script":break;case "foreach":b.__break=!0;this.__foreach||(this.__foreach=[],this.__foreachelse=[]);if(b.__open)this.__foreach.push(h.from.value);else if(this.__foreachelse.length)return this.__foreachelse=[],b.value="}",b;break;case "foreachelse":h=this.__foreach.pop();this.__foreachelse.push(h);g="}); if(!__utils.sizeof("+this.safe(h,b)+")){";break;case "block":h=!b.__close&&
b.attr("name");this.__blocks||(this.__blocks={},this.___blocks=[]);h?(this.___blocks.push(h),this.__blocks[h]=1+this.__blocks[h]||0):h=this.___blocks.shift();b.name=0<this.__blocks[h]?"set":"get";break;case "extends":case "include":b.name="include";g=b.attr("file");break;default:if(this.fns[b.name]){var c=[];d.each(h,function(a,d,e){e=a.value;e=/$\$/.test(e)?this.safe(e,b):'"'+e+'"';c.push(d+":"+e)});b.value="__this.fns."+b.name+"({"+c.join(",")+"},ctx)";b.name="value";return b}g=this.escape(b.name+
h,b);b.name="value"}g!==i&&(b.value=g);return a.length?a:this._super._trans.call(this,b,e,f)},escape:function(b,e){var f=b.split("|"),b=f[0];d.each(f.splice(1),function(a){a=a.split(":");b="__this.mods."+a[0]+"("+b+(1<a.length?","+a.splice(1).join(","):"")+")"});return this._super.escape.call(this,b,e)},safe:function(b,d){return this._super.safe.call(this,b.replace(/\$([a-z][a-z0-9_]*)/ig,function(b,a){return"(typeof "+a+'==="undefined"?ctx.'+a+":"+a+")"}),d)}},statics:{fn:function(b){d.each(b,function(b,
d){h+=" "+d;this.fns[d]=b},this);return this},modifiers:function(b){d.each(b,function(b,d){this.mods[d]=function(){return b.apply(this,arguments)}},this);return this}}};e.fn.fns=e.statics.fns={};e.fn.mods=e.statics.mods={};e.statics.fn({assign:function(b,d){d[b["var"]]=b.value;return""}}).modifiers({upper:function(b){return b.toUpperCase()},lower:function(b){return b.toLowerCase()},capitalize:function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()},nl2br:function(b){return b.replace(m,
"").replace(l,"<br/>")},regexp_replace:function(b,d,e){d=d.match(f);return b.replace(RegExp(d[1],d[2]),e)}});"undefined"!==typeof p?p("./Smarty",e):module.exports=e})(o("./utils"));var G=o("AsyncTpl");G.get=o;H.AsyncTpl=G;var v={},B=o("utils");AsyncTpl.fetch=function(d,i,m,l){"string"!=typeof i&&(l=m,m=i,i=w);if(v[d]===w)if("#"==d.charAt(0)){var f=B.$(d)||{innerHTML:"[[#"+d+" \u2014 not found]]"};v[d]=new this;v[d].loadString(f.innerHTML)}else v[d]=new this(d);var h=B.defer();v[d].fetch(m,function(d){h.resolve(d===
w?"":d)});i&&h.done(function(d){var b=B.$(i);if(b)b.innerHTML=d});return h.promise().done(l)};"undefined"!=typeof jQuery&&(jQuery.tpl=function(d){AsyncTpl.engine(d);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(d,i){jQuery.tpl("XML").fetch(d,this[0],i);return this})})(this);
