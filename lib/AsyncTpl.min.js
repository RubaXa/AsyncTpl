(function(E,w){function n(b,k){B[b.replace(C,"")]=k}function p(b){return B[b.replace(C,"")]}var C=/^.+\//,B={};n("fs",{readFile:function(b,k,l){jQuery.ajax({url:b,type:"get",dataType:"text",isLocal:!0,success:function(b){l(null,b)}})},readFileSync:function(b){return jQuery.ajax({url:b,type:"get",async:!1,dataType:"text",isLocal:!0}).responseText},lstatSync:function(){return{mtime:0}}});(function(){function b(f,g,i,d){if(!(this instanceof b))return new b(f,g,i,d);if("number"===typeof f)switch(d=i,
i=g,g=f,g){case b.TEXT_NODE:f="<text>";break;case b.CDATA_NODE:f="<cdata>";break;case b.COMMENT_NODE:f="<comment>";break;case b.CUSTOM_NODE:f="<custom>"}else if(f=f.toLowerCase(),f.match(k))this.ns=RegExp.$1,f=RegExp.$2;this.name=f;this.type=g;this.value=i;this.attributes=d||[];this.childNodes=[]}var k=/(\w+):(\w+)/,l={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_NODE:4,COMMENT_NODE:8,CUSTOM_NODE:20,COMPILER_NODE:21};b.prototype={constructor:b,replace:function(b){this.name=b.name;this.type=b.type;
this.value=b.value;this.attributes=b.attributes;return this},addTextNode:function(f){return this.addChild(b.TEXT_NODE,f)},addChild:function(f,g,i,d){f instanceof b||(f=b(f,g,i,d));this.childNodes.push(f);return this},addChilds:function(b){this.childNodes.push.apply(this.childNodes,b);return this},hasChildNodes:function(){return!!this.childNodes.length}};for(var i in l)b[i]=b.prototype[i]=l[i];"undefined"!==typeof n?n("./Node",b):module.exports=b})();(function(b,k){function l(c){if(!(this instanceof
l))return new l(c);var a=[],b=[],h,e,d=!0,f=!0,o=!1;this.done=function(c){d&&c!==k&&(o?c(e):a.push(c));return this}.bind(this);this.fail=function(c){f&&c!==k&&(o?c(e):b.push(c));return this}.bind(this);this.then=function(c,a){return this.done(c).fail(a)}.bind(this);this.reject=function(c){d=!1;o=!0;for(e=c;b.length;)b.shift()(c);return this}.bind(this);this.resolve=function(c){f=!1;o=!0;for(e=c;a.length;)a.shift()(c);return this}.bind(this);this.promise=function(){h===k&&(h={done:this.done,fail:this.fail,
then:this.then,promise:this.promise});return h}.bind(this);c!==k&&c(this)}var i=String.prototype.trim,f=/^#/,g=[].slice,j=/^\s+/,d=/\s+$/,a=/[&<>"]/,h=/[&<>"]/g,G=/'/g,e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"},o={$:function(c){return"string"==typeof c?document.getElementById(c.replace(f,"")):c},sizeof:function(c){var a=0,b;if(c&&("object"==typeof c||"object"==typeof c))if("length"in c)a=c.length;else for(b in c)a++;return a},uniqId:function(){return(new Date).getTime()+""+Math.round(1E3*
Math.random())},escape:function(c){return"string"===typeof c&&a.test(c)?c.replace(h,function(c){return e[c]}):c},addslashes:function(c){return c.replace(G,"\\'")},keys:function(c){var a=[];Object.keys?a=Object.keys(c):o.each(c,function(c){a.push(c)});return a},each:function(c,a,b){if(c)if(c.forEach)c.forEach(a,b);else if("length"in c&&0 in c)for(var h=0,e=c.length;h<e;h++)h in c&&a.call(b,c[h],h,c);else for(h in c)c.hasOwnProperty(h)&&a.call(b,c[h],h,c)},cycle:function(c,a,h){for(;c<a;c++)h()},trim:i?
function(c){return i.call(c)}:function(c){return(""+c).replace(j,"").replace(d,"")},extend:function(c){c=c||{};this.each(arguments,function(a,h){0<h&&this.each(a,function(a,h){c[h]=a})},this);return c},indexOf:function(c,a){if(c.indexOf)return c.indexOf(a);for(var h=0,b=c.length;h<b;h++)if(c[h]===a)return h;return-1},inherit:function(c,a,h,b){if(2===arguments.length){var e=function(){};e.prototype=a.prototype;c.prototype=new e;c.prototype.self=c;c.prototype.constructor=c;o.each(a,function(a,h){c[h]=
a})}else return a.prototype[h].apply(c,b)},defer:l,load:function(c,a,h,e){var d=this.defer();a?b.readFile(c,h||"utf-8",function(c,a){d[c?"reject":"resolve"](c||a)}):d.resolve(p("fs").readFileSync(c,h||"utf-8"));return d.done(e).promise()},mtime:function(c){return b?+Date.parse(b.lstatSync(c).mtime):0},writeFile:function(c,a,h){b&&b.writeFileSync(c,a,h)},getJSON:function(c,a,h){var e=o.defer();if(b)try{e.resolve(JSON.parse(b.readFileSync(c,a)))}catch(d){e.reject()}return e.fail(function(){h(!0)}).done(function(c){h(!1,
c)}).promise()}};l.prototype={constructor:l};l.when=function(c){var a=l(),h=[];c instanceof l?h.push.apply(h,arguments):h=c;var b=0,e=h.length,d=function(){++b==e&&a.resolve()};o.each(h,function(c){c.done(d)});e||a.resolve();return a.promise()};if(Function.prototype.bind===k)Function.prototype.bind=function(c){var a=g.call(arguments,1),h=this;return function(){return h.apply(c,a.concat(g.call(arguments,0)))}};"undefined"!==typeof n?n("./utils",o):module.exports=o})(p("fs"));(function(b,k,l){function i(a){this._opts=
k.extend({tags:!1,left:"<",right:">",c_open:"<\!--",c_close:"--\>",trim:!0,firstLine:!0},a);if(this._opts.tags)this._opts.tags=" "+this._opts.tags+" "}function f(a){var b=(a+"").split(""),e=0,d={};this.peek=function(c){return b[e+(c||0)]};this.lex=function(c){return b.slice(e,e+c).join("")};this.match=function(c){var a=this.lex(c.length)===c;this.lastMatch=a?c:null;this.lastMatchLength=a?c.length:0;return a};this.next=function(a){if("string"===typeof a)a=a.length;e+=a||1;return this};this.save=function(a){d[a]=
e;return this};this.load=function(a){e=d[a];return this};this.length=function(){return b.length-e};this.getStr=function(){for(var a,h="",b=this.peek(),e=1;a=this.peek();)if(this.next(),h+=a,"\\"==a)e++;else{if(b==a&&!(e%2))return h.substring(1,h.length-1);e=0}};this.extract=function(a,h){this.save("extract");h!==l&&this.next(h);for(var b="",e;e=this.peek();){if(this.match(a))return this.next(a),b;b+=e;this.next()}this.load("extract");return null}}var g=/['"]/,j=/^[\s\r\n\t]+$/,d=/^([$a-z][\da-z\s:>]|\/\w)$/i,
a=/[a-z\d:]/i;i.prototype={constructor:i,parse:function(h){var i,e="",o=[],c=this._opts,n=c.tags,A=c.left,p=c.right,F=c.c_open,u=c.c_close,D=A.length;!c.firstLine&&/^\s*<\?xml/.test(h)&&(h=k.trim(h.replace(/^[^\n]+\n/,"")));h=new f(h);a:for(;i=h.peek();){if(h.match(F))i=h.extract(u,h.lastMatchLength),null!==i&&o.push(b(b.COMMENT_NODE,i));else if(h.match("<![CDATA["))i=h.extract("]]\>",h.lastMatchLength),null!==i&&o.push(b(b.CDATA_NODE,i));else if(h.match(A))if(d.test(h.peek(D)+h.peek(D+1))){i="/"==
h.next(A).peek()?(h.next(),!0):!1;var m;m=h;var x=n,z=p,r,y=m;r=void 0;for(var q="";r=y.peek();)if(a.test(r))q+=r,y.next();else break;r=q;var q=void 0,w=y=!1,v={},s="",t=void 0;if(m.length()){m.save("attrs");x=!x||-1<x.indexOf(" "+r+" ");c:for(;q=m.peek();)if(x&&a.test(q))for(s="";q=m.peek();)if(m.match(z)||j.test(q)){v[s]={name:s,value:l};continue c}else if("="==q){if(g.test(m.peek(1)))t=m.next().getStr();else{for(t="";(q=m.next().peek())&&!j.test(q)&&!m.match(z);)t+=q;t=""==t?l:t}v[s]=b(s,b.ATTRIBUTE_NODE,
t);continue c}else s+=q,m.next();else if(m.match(z)){w=!0;y="/"==m.peek(-1);m.next(z);break}else x||(s+=q),m.next();w?(m=x?b(r,b.ELEMENT_NODE,"",v):b(r,b.ELEMENT_NODE,"",s),m.__close=y):(m.load("attrs"),m=b(b.TEXT_NODE,r))}else m=b(b.TEXT_NODE,r);c.trim&&j.test(e)||""!=e&&o.push(b(b.TEXT_NODE,e));e="";if(m.type!=b.TEXT_NODE)m.__open=!i,m.__close=m.__close||i,m.__empty=m.__open&&m.__close;o.push(m)}else{e+=i;h.next();continue a}else e+=i,h.next();0==h.length()&&""!=e&&o.push(b(b.TEXT_NODE,e))}return o},
build:function(a){for(var d=[],e,f,c=this.left,i=this.right;f=a.shift();){switch(f.type){case b.TEXT_NODE:case b.CDATA_NODE:e=f.value;break;case b.ELEMENT_NODE:e=c+(!f.__empty&&f.__close?"/":"")+f.name;k.each(f.attributes,function(a){e+=" "+a.name+(a.value!==l?'="'+a.value+'"':"")});e+=(f.__empty?" /":"")+i;break;case b.CUSTOM_NODE:e=c+(f.__close?"/":"")+f.name+f.value+i}""!=e&&(d.push(e),e="")}return d.join("")},rebuild:function(a){return this.build(this.parse(a))}};"undefined"!==typeof n?n("./Parser",
i):module.exports=i})(p("./Node"),p("./utils"));(function(b){function k(b){this._opts=b||{useWith:!1}}k.prototype={constructor:k,compile:function(k){function i(){var d="",a=0,h=g.length,i,e;if(h){for(;a<h;a++){e=typeof g[a];if(e!=i||"string"!=e)i&&("string"==i&&(d+="'"),d+=", "),"string"==e&&(d+="'");d+="string"==e?b.addslashes(g[a]):g[a][0];i=e}"string"==e&&(d+="'");f.push("__buf.write("+d.replace(/\r/g,"").replace(/\n/g,"\\n")+");");g=[]}}for(var f=[""],g=[],j;j=k.shift();)j.__break?(i(),f.push(j.value)):
"value"==j.name?g.push([j.value]):"string"==typeof j||j.type==j.TEXT_NODE||j.type==j.CDATA_NODE?g.push(j.value||j):(i(),f.push(j.value));i();this._opts.useWith?(f[0]="with( ctx ){ ",f.push(" } ")):f[0]="'use strict';";return new Function("ctx, __buf, __utils",f.join("")+" __buf.end();")}};"undefined"!==typeof n?n("./Compiler",k):module.exports=k})(p("./utils"));(function(b,k){function l(b,f){this._data="";this._pullLen=0;this._dataFn=b;this._endFn=f}l.prototype={constructor:l,write:function(){var b=
arguments.length,f=0;if(1===b)this._data+=arguments[0];else for(;f<b;f++)this._data+=arguments[f]},block:function(b,f){this.write(this.getBlock(b,f))},blockLabel:function(b,f){f!==k&&this.setBlock(b,f);if(this._blocks===k)this._chunks=[],this._blocks=[];this._chunks.push(this._data,b);this._blocks.push(this._chunks.length-1);this._data=""},setBlock:function(b,f){if(this._block===k)this._block={};this._block[b]=f},getBlock:function(b,f){this._block[b]!==k&&(f=this._block[b]);if(f!==k){var g=new l;
g._block=this._block;f(g);return g.toStr()}return""},pullSync:function(b,f,g){this.pull(b,f,g)},pull:function(i,f,g){if(this._pull===k)this._pull={};if(this._pull[f]===k){var j=b.defer(),d=function(){this._pullLen--;setTimeout(this.end.bind(this),0)}.bind(this);this._pullLen++;this._pull[f]=j.then(d,d);try{i[f](function(a,b){j[a?"reject":"resolve"](a||b)})}catch(a){j.reject(!0)}}g!==k&&this._pull[f].then(function(a){g(null,a)},function(a){g(a)});return this._pull[f].promise()},end:function(){if(this._dataFn!==
k)this._dataFn(this._data),this._data="";if(!this.isActive()){if(this._blocks!==k){for(var b=this._chunks.length,f=this._blocks.length,g,j="";f--;)g=this._blocks[f],this._chunks[g]=this.getBlock(this._chunks[g]);for(f=0;f<b;f++)j+=this._chunks[f];this._data=j+this._data}this._endFn(this._data)}},isActive:function(){return 0!==this._pullLen},toStr:function(){return this._data}};"undefined"!==typeof n?n("./Buffer",l):module.exports=l})(p("./utils"));(function(b,k,l,i,f){function g(a,b){this.__lego(a,
b)}var j={};b.uniqId();var d={def:"<!DOCTYPE html>",strict:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',loose:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',xstrict:'<!DOCTYPE html PUBLIC  "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',
xhtml:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">'};g.prototype={self:g,constructor:g,__lego:function(a,b){"string"!=typeof a&&(b=a,a=f);this._opts=this._defaults(b||{});this._data={};this._files={};this._listeners={};this._string=f;this._filename=a},_defaults:function(a){return b.extend({left:this.self.LEFT,right:this.self.RIGHT,trim:this.self.TRIM,c_open:this.self.C_OPEN,c_close:this.self.C_CLOSE,rootDir:this.self.ROOT_DIR,compileDir:this.self.COMPILE_DIR,
async:this.self.ASYNC,stream:this.self.STREAM,escape:this.self.ESCAPE,safeMode:this.self.SAFE_MODE,encoding:this.self.ENCODING},a)},_uniqKey:function(a){var b=this._opts;return b.LEFT+b.RIGHT+b.TRIM+b.stream+a},_compile:function(a,h){var d=this._uniqKey(a);if(!this._tpl&&(a===f||j[d]===f)){var e=b.defer(),i={};j[d]=e.promise();this._load(a,function(b){if(b)e.resolve(b);else{if(!this._compiler)this._compiler=new l(this._opts);this._parse(this._opts.rootDir+a,i,function(b){this._tpl=this._compiler.compile(b);
this._save(a,i);e.resolve()}.bind(this),i)}}.bind(this))}j[d].done(h)},_parse:function(a,h,d){if(this._parser===f)this._parser=new k(this._opts);var e=this._opts,i=b.defer(),c=[],g=function(e){for(var d=[],f,g=a.replace(/\/[\s%|\w\._-]+$/,"/"),j,e=this._parser.parse(e);f=e.shift();)j=this._trans(f,e),null!==j&&f.type!=f.COMMENT_NODE&&c.push(j),"include"==f.name&&d.push(this._parse(g+f.value,h).done(function(a,b){c[a-1]=b}.bind(this,c.length)));b.defer.when(d).done(function(){i.resolve(this._normalizeStack(c))}.bind(this))}.bind(this);
this._string!==f?g(this._string||"[[undefined]]"):(h[a]||(h[a]=b.mtime(a)),this.self.load(a,e.async,e.encoding,g));return i.done(d).promise()},_normalizeStack:function(a){for(var b=[],d;d=a.shift();)"string"!=typeof d&&d[0]?a=d.concat(a):b.push(d);return b},_save:function(a,h){this._opts.compileDir&&b.writeFile(this._opts.compileDir+a+".json",JSON.stringify({includes:h,template:this._tpl.toString()}),this._opts.encoding)},_load:function(a,h){var d=this._opts,e=!0,f=b.defer();d.compileDir?b.getJSON(d.compileDir+
a+".json",d.encoding,function(a,h){a?f.resolve(!1):(b.each(h.includes,function(a,c){b.mtime(c)!=a&&(e=!1)}),f.resolve(e&&(new Function("return "+h.template))()))}):f.resolve(!1);return f.done(h).promise()},_trans:function(a,h){var i=[],e,g=a.attributes;if(this._opts.ns==a.ns||!a.ns)switch(a.name){case "doctype":e=d[g.mode&&g.mode.value]||d.def;a.type=a.TEXT_NODE;break;case "script":e=" try{ "+h.shift().value+" } catch(e){} ";h.shift();break;case "if":e=a.__close?"}":"if("+this.safe(a.value)+"){";
break;case "else":e="}"+a.name+"{";break;case "elseif":case "else if":e="}else if("+this.safe(a.value)+"){";break;case "cycle":case "foreach":a.__break=!0;if(a.__close)a.value="});";else{var c="";if("cycle"==a.name)a.value="__utils.cycle("+g.from.value+", "+g.to.value+", function (){";else{if(g.item)c=g.item.value;g.key&&(c+=(""==c?"__v,":",")+g.key.value);a.value="__utils.each("+this.safe(g.from.value)+", function ("+c+"){"}}break;case "pull":if(a.__close)e="__buf.write('</span>');";else{c={id:b.uniqId(),
name:g.name.value,as:g.as&&g.as.value||g.name.value,async:!!g.async,error:g.error&&g.error.value||"err"};if(!this._pullStack)this._pullStack=[];this._pullStack.push(c);e="__buf.write('<span id=\""+c.id+"\">');";g.async?e+='__buf.pull(ctx,"'+g.name.value+'");':(e+='__buf.pullSync(ctx,"'+c.name+'",function('+c.error+","+c.as+"){",h.push({value:"});",type:a.ELEMENT_NODE}))}break;case "get":this._opts.stream||this.blockLevel?(a.name="value",a.__empty?e='__buf.getBlock("'+g.name.value+'")':(e=a.__close?
"});":'__buf.block("'+g.name.value+'", function (__buf){',a.__break=!0)):e=a.__empty?'__buf.blockLabel("'+g.name.value+'");':a.__close?"});":'__buf.blockLabel("'+g.name.value+'", function (__buf){';break;case "set":this.blockLevel=(this.blockLevel>>0)+(a.__close?-1:1);e=a.__close?"});":(g.test?"if("+this.safe(g.test.value)+")":"")+'__buf.setBlock("'+g.name.value+'",function(__buf){';break;case "fail":case "loading":case "success":c=this._pullStack[this._pullStack.length-1];if("loading"==a.name)return null;
e=a.__close?"}":"if("+("fail"==a.name?"":"!")+c.error+"){";c.async&&(e=a.__close?e+('__buf.write(\'</span><script>(function(a,b){try{a.parentNode.insertBefore(b,a);b.style.display="";a.parentNode.removeChild(a);}catch(er){}})(__utils.$("#%id"),__utils.$("#%name%id"));<\/script>'.replace(/%id/g,c.id).replace("%name",a.name)+"'); });"):'__buf.pull(ctx,"'+c.name+'",function('+c.error+","+c.as+"){__buf.write('<span id=\""+a.name+c.id+'" style="display: none">\');'+e)}if(e!==f)a.value=e;return i.length?
i:a},fetch:function(){if(this._tpl===f)return this._compile(this._filename,this.fetch.bind(this)),this;this._tpl(this._data,new i(this._opts.stream?this._listeners.data:f,this._listeners.end),b);return this},loadString:function(a){this._string=b.trim(a);this._compile();return this},on:function(a,b){this._listeners[a]=b;return this},set:function(a,b){"string"==typeof a?this._data[a]=b:this._data=a||{};return this},safe:function(a){return this._opts.safeMode?"(function(){try{return "+a+'}catch(e){return""}})()':
a},escape:function(a){return this._opts.escape?"__utils.escape("+this.safe(a)+")":a}};g._files={};g.load=function(a,h,d,e){return(this._files[a]||(this._files[a]=b.load(a,h,d))).done(e)};g.NS="xtpl";g.LEFT="<";g.RIGHT=">";g.C_OPEN="<\!--";g.C_CLOSE="--\>";g.TRIM=!0;g.ASYNC=!0;g.STREAM=!1;g.ESCAPE=!0;g.SAFE_MODE=!0;g.ENCODING="utf-8";g.ROOT_DIR="";g.COMPILE_DIR="";g.fetch=function(a,d){var g=new this(a),e=b.defer(),i="";g.set(d).on("data",function(a){i+=a}).on("end",function(a){e.resolve(a===f?i:a)}).fetch();
return e.promise()};g.fromString=function(a,b){return(new this(b)).loadString(a)};g.engine=function(a){"string"==typeof a&&(a=p("./"+a));var d=this.prototype;d._super={};b.each(a.statics,function(a,b){this[b]=a},this);b.each(a.fn,function(a,b){var f=d[b];f&&(d._super[b]=f);d[b]=a});return g};"undefined"!==typeof n?n("./AsyncTpl",g):module.exports=g})(p("./utils"),p("./Parser"),p("./Compiler"),p("./Buffer"));(function(b,k){var l={fn:{_defaults:function(i){return this._super._defaults.call(this,b.extend({ns:this.self.NS},
i||{},{firstLine:!1}))},_trans:function(i,f){var g=[],j,d=i.attributes;if(i.ns!=this._opts.ns){if(i.type==i.ELEMENT_NODE)if(!i.__empty&&i.__close)g.push("</"+i.name+">");else{g.push("<"+i.name);var a=RegExp(this._opts.ns+":","i");b.each(d,function(b){a.test(b.value)?g.push(" "+b.name+'="',{name:"value",value:this.escape(b.value.replace(a,""))},'"'):g.push(" "+b.name+'="'+b.value+'"')},this);g.push(i.__empty?"/>":">")}}else switch(i.name){case "if":j=d.test&&d.test.value;break;case "choose":this.__choose=
i.__open?1:0;break;case "when":j=i.__close?"}":(1==this.__choose?"":" else ")+"if("+this.safe(d.test.value)+"){";this.__choose++;break;case "otherwise":j=i.__close?"}":" else {";break;case "foreach":d={from:d.iterate,key:d.index,item:d.as};break;case "value":j=this.escape(f.shift().value);f.shift();break;case "include":j=d.src.value;break;case "comment":i.type=i.TEXT_NODE;i.__empty?j="":(j="<\!--"+f.shift().value+"--\>",f.shift());break;case "text":i.type=i.TEXT_NODE;j=f.shift().value;f.shift();break;
case "template":return null}if(j!==k)i.value=j;i.attributes=d;return g.length?g:this._super._trans.call(this,i,f)}}};"undefined"!==typeof n?n("./XML",l):module.exports=l})(p("./utils"));(function(b,k){var l=/\r/g,i=/\n/g,f=/^\/(.+)\/(\w*)$/,g="foreach include extends block doctype",j={fn:{_defaults:function(d){d=b.extend({left:"{{",right:"}}"},d,{tags:g});d.c_open=d.left+"*";d.c_close="*"+d.right;return this._super._defaults.call(this,d)},_trans:function(d,a){var f=[],g,e=d.attributes;if(d.type==
d.ELEMENT_NODE||d.type==d.CUSTOM_NODE)switch(d.name){case "if":case "else":case "elseif":g=e;break;case "script":case "cycle":break;case "foreach":d.__break=!0;if(!this.__foreach)this.__foreach=[],this.__foreachelse=[];if(d.__open)this.__foreach.push(e.from.value);else if(this.__foreachelse.length)return this.__foreachelse=[],d.value="}",d;break;case "foreachelse":e=this.__foreach.pop();this.__foreachelse.push(e);g="}); if(!__utils.sizeof("+this.safe(e)+")){";break;case "block":e=e.name&&e.name.value;
if(!this.__blocks)this.__blocks={},this.___blocks=[];e?(this.___blocks.push(e),this.__blocks[e]=1+this.__blocks[e]||0):e=this.___blocks.shift();d.name=0<this.__blocks[e]?"set":"get";break;case "extends":case "include":d.name="include";g=e.file.value;break;default:if(this.fns[d.name]){var i=[];b.each(e,function(a,b,d){d=a.value;d=/$\$/.test(d)?this.safe(d):'"'+d+'"';i.push(b+":"+d)});d.value="__this.fns."+d.name+"({"+i.join(",")+"},ctx)";d.name="value";return d}g=this.escape(d.name+e);d.name="value"}if(g!==
k)d.value=g;return f.length?f:this._super._trans.call(this,d,a)},escape:function(d){var a=d.split("|"),d=this._super.escape.call(this,this.safe(a[0]));b.each(a.splice(1),function(a){a=a.split(":");d="__this.mods."+a[0]+"("+d+(1<a.length?","+a.splice(1).join(","):"")+")"});return d},safe:function(b){return this._super.safe.call(this,b.replace(/\$([a-z][a-z0-9_]*)/ig,function(a,b){return"(typeof "+b+'==="undefined"?ctx.'+b+":"+b+")"}))}},statics:{fn:function(d){b.each(d,function(a,b){g+=" "+b;this.fns[b]=
a},this);return this},modifiers:function(d){b.each(d,function(a,b){this.mods[b]=function(){return a.apply(this,arguments)}},this);return this}}};j.fn.fns=j.statics.fns={};j.fn.mods=j.statics.mods={};j.statics.fn({assign:function(b,a){a[b["var"]]=b.value;return""}}).modifiers({upper:function(b){return b.toUpperCase()},lower:function(b){return b.toLowerCase()},capitalize:function(b){return b.charAt(0).toUpperCase()+b.substr(1).toLowerCase()},nl2br:function(b){return b.replace(l,"").replace(i,"<br/>")},
regex_replace:function(b,a,g){a=a.match(f);return b.replace(RegExp(a[1],a[2]),g)}});"undefined"!==typeof n?n("./Smarty",j):module.exports=j})(p("./utils"));E.AsyncTpl=p("AsyncTpl");var u={},v=p("utils");AsyncTpl.fetch=function(b,k,l){"string"!=typeof k&&(l=k,k=w);if(u[b]===w)if("#"==b.charAt(0)){var i=v.$(b)||{innerHTML:"[["+b+" \u2014 not found]]"};u[b]=new this;u[b].loadString(i.innerHTML)}else u[b]=new this(b);var f=v.defer(),g="";u[b].set(l||{}).on("data",function(b){g+=b}).on("end",function(b){f.resolve(b===
w?g:b)}).fetch();k&&f.done(function(b){var d=v.$(k);if(d)d.innerHTML=b});return f.promise()};if("undefined"!=typeof jQuery)jQuery.tpl=function(b){AsyncTpl.engine(b);jQuery.tpl=function(){return this};return this},jQuery.fn.tpl=function(b,k){jQuery.tpl("XML").fetch(b,this[0],k);return this}})(this);
